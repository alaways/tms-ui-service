import{an as re,a as se,ar as ne,r,c as T,az as g,s as oe,j as t,F as v,f as o,m as ae,g as _}from"./index-a90aa29c.js";import{S as ie}from"./sweetalert2.all-ca2d1030.js";import{P as L}from"./PDFButton-df4883da.js";import{P as ce}from"./preLoading-b2445d9d.js";import{B as le}from"./breadcrumbs-b9914bbc.js";import{R as de}from"./index.es-edddd9ad.js";import{I as pe}from"./IconDownload-679eea58.js";import{I as me}from"./IconShare-63379a3a.js";import{I as _e}from"./IconCopy-f9046c33.js";/* empty css              */const Ie=()=>{const{uuid:i}=re(),E=se(),a=ie.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,padding:"10px 20px"}),C=ne(),h=new URLSearchParams(C.search).get("type"),I="https://customer-dev.tplus.co.th",[P,x]=r.useState(),[c,O]=r.useState(null),[d,N]=r.useState(null),[p,k]=r.useState(null),[l,j]=r.useState(null),[M,H]=r.useState(!1),[F,ue]=r.useState(""),[B,fe]=r.useState(""),[G,w]=r.useState(!0),[y,V]=r.useState(""),K=[{to:"/apps/contract/list",label:"สัญญา"},{label:"PDF สัญญา",isCurrent:!0}],{mutate:W}=T(_.contractFindData+`${i}/?tab=contract`,{onSuccess:e=>{e.statusCode==200&&x(e.data)},onError:e=>{a.fire({icon:"error",title:"ไม่พบสัญญา"})}}),{mutate:Y,isLoading:A}=g(_.contractPDF+i,{onSuccess:e=>{const s=new Blob([e],{type:"application/pdf"}),n=window.URL.createObjectURL(s);O(n)},onError:e=>{a.fire({icon:"error",title:"ไม่สามารถโหลดไฟล์ PDF ได้"})}}),{mutate:$,isLoading:X}=g(_.contractPDPA+i,{onSuccess:e=>{const s=new Blob([e],{type:"application/pdf"}),n=window.URL.createObjectURL(s);N(n)},onError:e=>{a.fire({icon:"error",title:"ไม่สามารถโหลดไฟล์ PDF ได้"})}}),{mutate:q,isLoading:z}=g(_.contractCardID+i,{onSuccess:e=>{const s=new Blob([e],{type:"application/pdf"}),n=window.URL.createObjectURL(s);k(n)},onError:e=>{a.fire({icon:"error",title:"ไม่สามารถโหลดไฟล์ PDF ได้"})}}),{mutate:Z,isLoading:Q}=g(_.contractRC+i,{onSuccess:e=>{const s=new Blob([e],{type:"application/pdf"}),n=window.URL.createObjectURL(s);j(n)},onError:e=>{a.fire({icon:"error",title:"ไม่สามารถโหลดไฟล์ PDF ได้"})}}),{mutateAsync:J,isLoading:u}=T(_.createLinkSignature,{onSuccess:e=>{var s,n,b;if((s=e.data)!=null&&s.token){let f="";h=="refinance"&&(f="&type=refinance");let m;m=`${I}/contract/signature/${e.data.token}?openExternalBrowser=1${f}?business_unit=${(n=P==null?void 0:P.reference)==null?void 0:n.slice(0,3)}`,V(m),a.fire({icon:"success",title:"สร้างลิงก์สำหรับลูกค้าแล้ว!"})}else a.fire({icon:"error",title:((b=e.data)==null?void 0:b.message)||"ไม่สามารถสร้างลิงก์ได้"})},onError:e=>a.fire({icon:"error",title:"เกิดข้อผิดพลาดในการสร้างลิงก์"})}),U=()=>{document.documentElement.scrollTop>50&&document.documentElement.scrollTop+window.innerHeight-document.documentElement.scrollHeight>=-50?w(!1):w(!0)};return r.useEffect(()=>{E(oe("PDF สัญญา")),i&&(W({}),Y({}),$({}),q({}),h=="refinance"&&Z({}))},[i,E]),r.useEffect(()=>()=>{c&&window.URL.revokeObjectURL(c)},[c]),r.useEffect(()=>()=>{d&&window.URL.revokeObjectURL(d)},[d]),r.useEffect(()=>()=>{p&&window.URL.revokeObjectURL(p)},[p]),r.useEffect(()=>()=>{l&&window.URL.revokeObjectURL(l)},[l]),r.useEffect(()=>(window.addEventListener("scroll",U),()=>{window.removeEventListener("onscroll",U)}),[]),t(v,{children:o("div",{className:"flex flex-col gap-2.5",children:[(A||u)&&t(ce,{}),M&&t(de,{mainSrc:F,onCloseRequest:()=>H(!1)}),t(le,{items:K}),o("div",{className:"panel",children:[G&&t("div",{className:"fixed bottom-10 ltr:right-6 rtl:left-6 z-50",style:{bottom:"1.5rem",right:"1.5rem"},children:t("a",{href:"#buttom",className:"btn btn-outline-primary rounded-full p-2 animate-pulse bg-[#fafafa] dark:bg-[#060818] dark:hover:bg-primary",children:t("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",style:{width:"2rem",height:"2rem",transform:"rotate(180deg)"},children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7l4-4m0 0l4 4m-4-4v18"})})})}),o("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:[t("h2",{className:"text-2xl font-bold text-themePrimary",children:"PDF สัญญา"}),o("div",{className:"flex flex-wrap items-center gap-2",children:[o("button",{type:"button",className:"btn btn-outline-primary",onClick:async()=>{if(!c||!d||!p||h=="refinance"&&!l){alert("ยังไม่มี PDF ทั้งสองไฟล์");return}try{const e=await L.create(),s=async D=>{const R=await fetch(D);if(!R.ok)throw new Error(`โหลด PDF จาก ${D} ไม่สำเร็จ`);const ee=await R.arrayBuffer(),S=await L.load(ee);(await e.copyPages(S,S.getPageIndices())).forEach(te=>e.addPage(te))};await s(c),await s(d),await s(p),h=="refinance"&&l&&await s(l);const n=await e.save(),b=new Blob([new Uint8Array(n)],{type:"application/pdf"}),f=URL.createObjectURL(b),m=document.createElement("a");m.href=f,m.download=`${B||"contract"}_${ae().utc().format("DD-MM-yyyy")}.pdf`,m.click(),URL.revokeObjectURL(f)}catch(e){console.error("เกิดข้อผิดพลาดในการรวม PDF:",e),alert("เกิดข้อผิดพลาดในการรวม PDF")}},disabled:u||!c,children:[t(pe,{className:"w-5 h-5 ltr:mr-2 rtl:ml-2"})," Download"]}),t("button",{type:"button",className:"btn btn-outline-secondary",onClick:async()=>{u||await J({data:{id_contract:i}})},disabled:u,children:u?"กำลังสร้าง...":o(v,{children:[t(me,{className:"w-5 h-5 ltr:mr-2 rtl:ml-2"})," สร้าง Link ให้ลูกค้า"]})}),y&&o("button",{className:"btn btn-outline-danger",onClick:()=>{y&&(navigator.clipboard.writeText(y),a.fire({icon:"success",title:"คัดลอกลิงก์สำหรับลูกค้าแล้ว!"}))},children:[t(_e,{className:"w-5 h-5 ltr:mr-2 rtl:ml-2"}),"Copy Link"]})]})]}),t("div",{className:"text-center",children:(()=>t("div",{className:"upload-container mb-10",children:A||X||z||Q?t("p",{className:"text-center text-gray-600",children:"กำลังโหลด PDF..."}):c?o("div",{className:"pdf-viewer-container space-y-10",children:[o("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[t("h2",{className:"text-left text-xl font-bold mb-4 text-gray-800",children:"1. รายละเอียดสัญญา"}),t("iframe",{src:`${c}#toolbar=0`,width:"100%",height:"600px",className:"border rounded-xl shadow-md w-full",title:"PDF Preview - Contract"})]}),o("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[t("h2",{className:"text-left text-xl font-bold mb-4 text-gray-800",children:"2. PDPA"}),t("iframe",{src:`${d}#toolbar=0`,width:"100%",height:"600px",className:"border rounded-xl shadow-md w-full",title:"PDF Preview - PDPA"})]}),o("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[t("h2",{className:"text-left text-xl font-bold mb-4 text-gray-800",children:"3. สำเนาบัตรประชาชน"}),t("iframe",{src:`${p}#toolbar=0`,width:"100%",height:"600px",className:"border rounded-xl shadow-md w-full",title:"PDF Preview - PDPA"})]}),h=="refinance"&&o("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[t("h2",{className:"text-left text-xl font-bold mb-4 text-gray-800",children:"4. ใบเสร็จรับเงิน"}),t("iframe",{src:`${l}#toolbar=0`,width:"100%",height:"600px",className:"border rounded-xl shadow-md w-full",title:"PDF Preview - PDPA"})]})]}):t("p",{className:"text-center text-gray-500",children:"ไม่พบไฟล์สัญญา"})}))()})]})]})})};export{Ie as default};
