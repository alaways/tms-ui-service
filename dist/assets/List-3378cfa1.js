import{a as Q,u as Z,r as a,s as J,c as f,f as r,j as t,L as ee,ax as te,g as b}from"./index-a90aa29c.js";import{Q as se}from"./index-2f30bf27.js";import{I as ae}from"./IconPlus-4c7e79c8.js";import{I as ie}from"./IconEye-eb8ead5b.js";import{b as re}from"./formatNumeric-862380d6.js";import{t as ne,b as oe,r as le}from"./constant-e85f1578.js";import{S as ce}from"./react-select.esm-b46d9623.js";import{F as P,a as C}from"./formik.esm-c4fd04ca.js";import{P as pe}from"./preLoading-b2445d9d.js";import{P as I}from"./config-8de56c22.js";import{S as de}from"./sweetalert2.all-ca2d1030.js";import{I as me}from"./IconX-54a3093e.js";import{S as _e}from"./SelectField-917481a8.js";import{q as g,_ as R}from"./transition-d4ca4cfa.js";import"./floating-ui.dom-0aeb9e8a.js";import"./createSuper-98fcd92d.js";import"./lodash-f7ec5310.js";import"./keyboard-f171a3e5.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const ue="admin",ke=()=>{const y=Q(),v=Z(),[n,U]=a.useState([]),c=localStorage.getItem(ue),p=c?JSON.parse(c).role:null,A=c?JSON.parse(c??"{}").access_level:null,_=de.mixin(ne);p!="admin"&&p!="business_unit"&&v("/"),a.useEffect(()=>{y(J("รายการพนักงาน"))});const[S,D]=a.useState(!1);a.useEffect(()=>{D(!0)},[]);const[L,O]=a.useState([]),[u,E]=a.useState(1),[l,M]=a.useState(I[0]),[k,w]=a.useState(0);a.useState(""),a.useState(null);const[j,H]=a.useState([]),[T,h]=a.useState(!1),[F,G]=a.useState({columnAccessor:"",direction:"asc"}),x=e=>{y(te(e)),v("/apps/employee/edit/"+e.id)},{mutate:V,isLoading:K}=f(b.contractFilter,{onSuccess:e=>{H([{value:null,label:"ทั้งหมด"},...e.data.business_unit.map(s=>({value:s,label:s.name}))])},onError:()=>{console.error("Failed to fetch bu data")}});a.useEffect(()=>{p==="admin"&&V({})},[]);const[d,B]=a.useState({}),{mutate:m,isLoading:W}=f(b.employeeFindAll,{onSuccess:e=>{O(e.data.list),w(e.data.total)},onError:()=>{console.error("Failed to fetch bu data")}});a.useEffect(()=>{const e={data:{...d,page:1,page_size:l}};m(e)},[]),a.useEffect(()=>{if(!S)return;const e={data:{...d,page:1,page_size:l}};m(e)},[l]),a.useEffect(()=>{S&&m({data:{...d,page:u,page_size:l}})},[u]);const Y=oe.reduce((e,s)=>(e[`${s.value}`]=s.label,e),{}),q=le.reduce((e,s)=>(e[`${s.value}`]=s.label,e),{}),{mutate:N,isLoading:z}=f(b.employeeUpdateActive,{onSuccess:e=>{e.statusCode===200||e.code===200?(_.fire({icon:"success",title:"บันทึกสำเร็จ",padding:"10px 20px"}),setTimeout(()=>{window.location.reload()},2e3)):_.fire({icon:"error",title:e.message,padding:"10px 20px"})},onError:()=>{_.fire({icon:"error",title:"เกิดข้อผิดพลาด",padding:"10px 20px"})}}),[X,he]=a.useState({is_active:!0}),$=a.useCallback(e=>{const s=n.map(i=>i==null?void 0:i.id);N({data:{uuid:s,is_active:e==null?void 0:e.is_active}})},[n,N]);return r("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[W||K||z&&t(pe,{}),r("div",{className:"invoice-table ",children:[r("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:[r("div",{className:"flex items-center gap-2",children:[r(ee,{to:"/apps/employee/add",className:"btn btn-primary gap-2",children:[t(ae,{}),"เพิ่มพนักงาน"]}),(A=="A"||A=="B")&&t("button",{type:"button",className:"btn btn-success gap-2",onClick:()=>{h(!0)},disabled:!((n==null?void 0:n.length)>0),children:"ปรับปรุง เปิด-ปิดใช้งาน"})]}),t("div",{className:"flex flex-row ltr:ml-auto rtl:mr-auto gap-5",children:t(P,{initialValues:d,onSubmit:e=>{var i,o;const s={query:(e==null?void 0:e.query)??"",id_business_unit:((o=(i=e==null?void 0:e.id_business_unit)==null?void 0:i.value)==null?void 0:o.id)??null};B(s),m({data:s})},children:({setFieldValue:e,handleReset:s,values:i})=>t(C,{className:"w-full",children:t("div",{className:"flex flex-col gap-3 w-full",children:r("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-4",children:[p==="admin"&&t(ce,{id:"id_business_unit",name:"id_business_unit",value:i.id_business_unit,placeholder:"เลือก หน่วยธุรกิจ",className:"z-10 w-[200px]",options:j,isSearchable:!0,onChange:o=>{e("id_business_unit",o)}}),t("div",{className:"relative",children:t("input",{type:"text",id:"query",name:"query",placeholder:"ค้นหา",className:"form-input py-2 ltr:pr-11 rtl:pl-11 peer",value:i.query,onChange:o=>{e("query",o.target.value)}})}),r("div",{className:"flex gap-4",children:[t("button",{type:"submit",className:"btn btn-primary w-[100px] gap-2",children:"ค้นหา"}),t("button",{type:"reset",className:"btn btn-info gap-2 w-[100px]",onClick:()=>{location.reload()},children:"ล้างค่า"})]})]})})})})})]}),t("div",{className:"datatables pagination-padding",children:t(se,{className:"whitespace-nowrap table-hover invoice-table",records:L,columns:[{accessor:"id",title:"ลำดับ",sortable:!1,textAlignment:"center",render:(e,s)=>t("div",{children:s+1})},{accessor:"name",title:"ชื่อพนักงาน",sortable:!1,render:e=>t("div",{className:"flex items-center justify-start font-normal",children:t("a",{className:"flex cursor-pointer active",onClick:()=>x(e),children:t("div",{children:e.title+" "+e.name})})})},{accessor:"email",title:"อีเมล",sortable:!1,render:e=>t("div",{className:"flex items-center justify-start font-normal",children:t("div",{children:e.email})})},{accessor:"phone_number",title:"เบอร์โทรศัพท์",sortable:!1,render:({phone_number:e})=>t("div",{className:"flex items-center justify-start font-normal",children:t("div",{children:re(e??"-")})})},{accessor:"line_id",title:"Line ID",sortable:!1,render:e=>t("div",{className:"flex items-center justify-start font-normal",children:t("div",{children:e.line_id})})},{accessor:"business_unit",title:"หน่วยธุรกิจ",sortable:!1,render:e=>{var s;return t("div",{className:"flex items-center justify-start font-normal",children:t("div",{children:((s=e==null?void 0:e.business_unit)==null?void 0:s.name)||"TMS"})})}},{accessor:"role",title:"ตำแหน่ง",textAlignment:"center",sortable:!1,render:e=>t("div",{className:"flex items-center justify-center font-normal",children:t("div",{children:q[e.role]||"-"})})},{accessor:"access_level",title:"ระดับสิทธิ์",textAlignment:"center",sortable:!1,render:e=>t("div",{className:"flex items-center justify-center font-normal",children:t("div",{children:Y[e.access_level]||"-"})})},{accessor:"is_active",title:"เปิดปิดการใช้งาน",textAlignment:"center",sortable:!1,render:({is_active:e})=>t("span",{className:`badge ${e?"badge-outline-success":"badge-outline-danger"}`,children:e?"เปิดใช้งาน":"ปิดใช้งาน"})},{accessor:"action",title:"Actions",textAlignment:"center",sortable:!1,render:e=>t("div",{className:"flex gap-4 items-center w-max mx-auto",children:t("a",{className:"flex cursor-pointer active",onClick:()=>x(e),children:t(ie,{})})})}],page:u,totalRecords:k,recordsPerPage:l,highlightOnHover:!0,onPageChange:e=>E(e),recordsPerPageOptions:I,onRecordsPerPageChange:e=>{E(1),M(e)},selectedRecords:n,onSelectedRecordsChange:U,sortStatus:F,onSortStatusChange:G,paginationText:({from:e,to:s,totalRecords:i})=>`โชว์ ${e} ถึง ${s} ของ ${i} หน้าทั้งหมด`})})]}),t(g,{appear:!0,show:T,as:a.Fragment,children:r(R,{as:"div",open:T,onClose:()=>h(!1),className:"relative z-[51]",children:[t(g.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(g.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:r(R.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[t("button",{type:"button",onClick:()=>h(!1),className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(me,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"ปรับปรุงข้อมูล"}),t("div",{className:"p-5",children:t(P,{initialValues:X,onSubmit:$,enableReinitialize:!0,autoComplete:"off",children:e=>r(C,{className:"space-y-5 mb-7 dark:text-white custom-select",children:[t(_e,{label:"สถานะการใช้งาน",id:"is_active",name:"is_active",options:[{value:!0,label:"เปิดใช้งาน"},{value:!1,label:"ปิดใช้งาน"}],placeholder:"กรุณาเลือก",onChange:s=>{e.setFieldValue("is_active",s.value)},isSearchable:!1}),t("div",{className:"flex justify-center items-center mt-8",children:t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"ตกลง"})})]})})})]})})})})]})})]})};export{ke as default};
