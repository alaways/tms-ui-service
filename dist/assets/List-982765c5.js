import{a as Y,u as q,r as s,s as z,b as X,c as _,j as t,f as o,v as Q,aw as Z,g as u}from"./index-a90aa29c.js";import{c as $,a as C}from"./object-7405de1d.js";import{d as J}from"./debounce-5af6d14d.js";import{P,D as ee}from"./config-8de56c22.js";import{s as p}from"./showNotification-b9615e49.js";import{F as te,a as se}from"./formik.esm-c4fd04ca.js";import{Q as ae}from"./index-2f30bf27.js";import{T as N}from"./tippy-react.esm-150a8dd6.js";import{S as D}from"./SelectField-917481a8.js";import{I as re}from"./IconX-54a3093e.js";import{I as oe}from"./IconEye-eb8ead5b.js";import{I as ie}from"./IconEdit-bf2b08f0.js";import{I as ne}from"./InputField-d7971719.js";/* empty css              */import{q as y,_ as R}from"./transition-d4ca4cfa.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./sweetalert2.all-ca2d1030.js";import"./floating-ui.dom-0aeb9e8a.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./lodash-f7ec5310.js";import"./keyboard-f171a3e5.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const U={id:"",name:"",id_business_unit:null,is_active:!0},le="admin",Le=()=>{const d=Y(),h=q();s.useEffect(()=>{d(z("รายการกลุ่มร้าน")),d(X(["bu","/apps/shop-group/list"]))},[d]);const A=localStorage.getItem(le),m=A?JSON.parse(A).role:null;s.useEffect(()=>{m!=="admin"&&m!=="business_unit"&&h("/")},[m,h]);const[E,i]=s.useState(!1),[b,x]=s.useState(U),[O,M]=s.useState([]),[k,L]=s.useState([]),[n,v]=s.useState(1),[r,w]=s.useState(P[0]),[H,j]=s.useState(0),[l,F]=s.useState(""),{mutate:G}=_(u.businessUnitActiveFindAll,{onSuccess:e=>{L(e.data.map(a=>({value:a.id,label:a.name})))},onError:e=>{}}),{mutate:c}=_(u.shopGroupFindAll,{onSuccess:e=>{M(e.data.list),j(e.data.total)},onError:()=>{console.error("Failed to fetch asset type data")}}),{mutate:S}=_(u.shopGroupCreate,{onSuccess:e=>{e.statusCode===200||e.code===200?(p("เพิ่มข้อมูลสำเร็จ","success"),i(!1),c({data:{page:n,page_size:r,query:l}})):p(e.message,"error")},onError:e=>{p(e.message,"error")}}),{mutate:T}=_(u.shopGroupUpdate,{onSuccess:e=>{e.statusCode===200||e.code===200?(p("แก้ไขข้อมูลสำเร็จ","success"),i(!1),c({data:{page:n,page_size:r,query:l}})):p(e.message,"error")},onError:e=>{p(e.message,"error")}}),g=s.useMemo(()=>J(e=>{c({data:{page:1,page_size:r,query:e}})},ee.FAST),[c,r]),V=(e,a,f)=>{e.setFieldValue(f,a.value)},B=(e=null)=>{x(e?{...e,id_business_unit:e.business_unit.id}:U),i(!0)},I=e=>{d(Z(e)),h("/apps/shop-group/list-bu/"+e.business_unit.id+"/"+e.id)},K=$().shape({name:C().required("กรุณาใส่ข้อมูลให้ครบ"),id_business_unit:C().nullable().required("กรุณาใส่ข้อมูลให้ครบ")}),W=s.useCallback(e=>{const a={...e,active:e.is_active};e.id?T({data:a,id:e.id}):S({data:a})},[S,T]);return s.useEffect(()=>{G({page:n,page_size:r}),c({data:{page:n,page_size:r,query:l}})},[n,r]),s.useEffect(()=>(g(l),()=>{g.cancel()}),[l,g]),t("div",{children:o("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[o("div",{className:"flex items-center justify-between flex-wrap gap-4 mb-4.5 px-5 ",children:[t("h2",{className:"text-xl",children:"ประเภทกลุ่มร้าน"}),t("div",{className:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4 w-full sm:w-auto",children:o("div",{className:"relative",children:[t("input",{type:"text",placeholder:"ค้นหา",className:"form-input py-2 ltr:pr-11 rtl:pl-11 peer",value:l,onChange:e=>F(e.target.value)}),t("button",{type:"button",className:"absolute ltr:right-[11px] rtl:left-[11px] top-1/2 -translate-y-1/2 peer-focus:text-primary",children:t(Q,{className:"mx-auto"})})]})})]}),t("div",{className:"datatables pagination-padding",children:t(ae,{className:"whitespace-nowrap table-hover invoice-table",records:O,columns:[{accessor:"id",title:"ลำดับ",sortable:!1,render:(e,a)=>t("div",{children:a+1})},{accessor:"name",title:"ชื่อกลุ่มร้าน",sortable:!1,render:e=>t("div",{className:"flex items-center font-normal",children:t("a",{className:"flex cursor-pointer active",onClick:()=>I(e),children:e.name})})},{accessor:"is_active",title:"เปิดปิดการใช้งาน",sortable:!1,render:({is_active:e})=>t("span",{className:`badge ${e?"badge-outline-success":"badge-outline-danger"}`,children:e?"เปิดใช้งาน":"ปิดใช้งาน"})},{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:e=>o("div",{className:"flex gap-4 items-center w-max mx-auto",children:[m==="admin"&&t(N,{content:"รายการกลุ่มร้านค้า",theme:"Primary",children:t("a",{className:"flex hover:text-primary cursor-pointer active",onClick:()=>{I(e)},children:t(oe,{})})}),t(N,{content:"แก้ไข",theme:"Primary",children:t("a",{className:"flex hover:text-info cursor-pointer active",onClick:()=>{B(e)},children:t(ie,{className:"w-4.5 h-4.5"})})})]})}],highlightOnHover:!0,totalRecords:H,recordsPerPage:r,page:n,onPageChange:e=>v(e),recordsPerPageOptions:P,onRecordsPerPageChange:e=>{v(1),w(e)},paginationText:({from:e,to:a,totalRecords:f})=>`โชว์ ${e} ถึง ${a} ของ ${f} หน้าทั้งหมด`})}),t(y,{appear:!0,show:E,as:s.Fragment,children:o(R,{as:"div",open:E,onClose:()=>i(!1),className:"relative z-[51]",children:[t(y.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(y.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:o(R.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[t("button",{type:"button",onClick:()=>i(!1),className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(re,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:b.id?"แก้ไข":"เพิ่ม"}),t("div",{className:"p-5",children:t(te,{initialValues:b,onSubmit:W,enableReinitialize:!0,autoComplete:"off",validationSchema:K,children:e=>o(se,{className:"space-y-5 mb-7 dark:text-white custom-select",children:[t(D,{label:"หน่วยธุรกิจ",id:"id_business_unit",name:"id_business_unit",options:k,placeholder:"กรุณาเลือก",onChange:a=>V(e,a,"id_business_unit"),isSearchable:!0}),t(ne,{label:"ชื่อกลุ่มร้าน",name:"name",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),t(D,{require:!0,label:"สถานะ",id:"is_active",name:"is_active",options:[{value:!0,label:"เปิด"},{value:!1,label:"ปิด"}],placeholder:"กรุณาเลือก",onChange:a=>{e.setFieldValue("is_active",a.value)},isSearchable:!1}),o("div",{className:"flex justify-end items-center mt-8",children:[t("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>i(!1),children:"ยกเลิก"}),t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:b.id?"บันทึก":"เพิ่ม"})]})]})})})]})})})})]})})]})})};export{Le as default};
