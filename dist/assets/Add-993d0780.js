import{u as I,a as C,r as o,s as R,c as u,f as r,F as D,j as s,g as h}from"./index-a90aa29c.js";import{c as U,a,d as P}from"./object-7405de1d.js";import{S as O}from"./sweetalert2.all-ca2d1030.js";import{F as N,a as M}from"./formik.esm-c4fd04ca.js";import{I as i}from"./InputField-d7971719.js";import{S as p}from"./SelectField-917481a8.js";import{t as x,a as L,r as k,b as w}from"./constant-e85f1578.js";import{B as H}from"./breadcrumbs-b9914bbc.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";const j="admin",te=()=>{const m=O.mixin(x),c=I(),b=C(),_=localStorage.getItem(j),n=_?JSON.parse(_).role:null;n!="admin"&&n!="business_unit"&&c("/");const A=[{to:"/apps/employee/list",label:"พนักงาน"},{label:"เพิ่ม",isCurrent:!0}];o.useEffect(()=>{b(R("เพิ่มพนักงาน"))});const[d]=o.useState({title:"",name:"",phone_number:"",line_id:"",access_level:"",email:"",role:"",is_active:!0}),[E,y]=o.useState([]),T=U().shape({title:a().required("กรุณาใส่ข้อมูลให้ครบ"),name:a().required("กรุณาใส่ข้อมูลให้ครบ"),phone_number:a().required("กรุณาใส่ข้อมูลให้ครบ"),email:a().email("กรุณาใส่อีเมลที่ถูกต้อง").required("กรุณาใส่ข้อมูลให้ครบ"),role:a().required("กรุณาใส่ข้อมูลให้ครบ"),access_level:a().required("กรุณาใส่ข้อมูลให้ครบ"),password:a().required("กรุณาใส่ข้อมูลให้ครบ"),password_repeat:a().oneOf([P("password"),null],"รหัสผ่านไม่ตรงกัน").required("กรุณาใส่ข้อมูลให้ครบ")}),{mutate:g}=u(h.contractFilter,{onSuccess:t=>{y([{value:"tms",label:"TMS"},...t.data.business_unit.map(e=>({value:e.id,label:e.name}))])},onError:()=>{console.error("Failed to fetch bu data")}});o.useEffect(()=>{n==="admin"&&g({})},[]);const{mutate:S}=u(h.employeeCreate,{onSuccess:t=>{t.statusCode===200||t.code===200?(m.fire({icon:"success",title:"บันทึกสำเร็จ",padding:"10px 20px"}),c("/apps/employee/list")):m.fire({icon:"error",title:t.message,padding:"10px 20px"})},onError:()=>{console.error("Failed to fetch bu data")}}),l=(t,e,f)=>{t.setFieldValue(f,e.value)},v=o.useCallback(t=>{S({data:{...t,is_approved:!0,is_active:!0}})},[d]);return r(D,{children:[s(H,{items:A}),s("div",{className:"flex xl:flex-row flex-col gap-2.5 pt-5",children:s("div",{className:"panel px-6 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6",children:s(N,{initialValues:d,onSubmit:v,enableReinitialize:!0,autoComplete:"off",validationSchema:T,children:t=>r(M,{className:"space-y-5 dark:text-white custom-select",children:[r("div",{className:"input-flex-row",children:[s(p,{label:"คำนำหน้า",id:"title",name:"title",placeholder:"กรุณาเลือก",options:L,isSearchable:!1,onChange:e=>{l(t,e,"title")},require:!0}),s(i,{label:"ชื่อพนักงาน",name:"name",type:"text",require:!0})]}),r("div",{className:"input-flex-row",children:[s(i,{label:"Line ID",name:"line_id",type:"text"}),s(i,{label:"Email",name:"email",require:!0})]}),r("div",{className:"input-flex-row",children:[s(p,{label:"ตำแหน่ง",id:"role",name:"role",placeholder:"กรุณาเลือก",options:k,isSearchable:!1,onChange:e=>{l(t,e,"role")},require:!0}),s(p,{label:"ระดับสิทธิ",id:"access_level",name:"access_level",placeholder:"กรุณาเลือก",isSearchable:!1,options:w,onChange:e=>{l(t,e,"access_level")},require:!0})]}),r("div",{className:"input-flex-row",children:[s(i,{label:"เบอร์โทรศัพท์พนักงาน",name:"phone_number",type:"text",require:!0,maxLength:10,onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()}}),n==="admin"&&s(p,{label:"หน่วยธุรกิจ",id:"id_business_unit",name:"id_business_unit",placeholder:"กรุณาเลือก",className:"w-auto",options:E,isSearchable:!0,onChange:e=>{l(t,e,"id_business_unit")}})]}),r("div",{className:"input-flex-row",children:[s(i,{label:"รหัสผ่าน",name:"password",type:"password"}),s(i,{label:"ยืนยันรหัสผ่าน",name:"password_repeat",type:"password"})]}),s("button",{type:"submit",className:"btn !mt-6 w-full border-0 btn-primary",children:"เพิ่ม"})]})})})})]})};export{te as default};
