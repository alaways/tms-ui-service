import{an as F,u as O,r,ao as U,c as w,f as o,F as Z,j as t,N as q,t as J,g as v}from"./index-a90aa29c.js";import{F as W,a as X,c}from"./formik.esm-c4fd04ca.js";import{S as N}from"./sweetalert2.all-ca2d1030.js";import{I as T}from"./InputField-d7971719.js";import{Q as Y}from"./index-2f30bf27.js";import{P as ee}from"./config-8de56c22.js";import{B as te}from"./breadcrumbs-b9914bbc.js";import{t as ae}from"./constant-e85f1578.js";import{P as ne}from"./preLoading-b2445d9d.js";import{d as ie}from"./formatDate-4e046265.js";import"./floating-ui.dom-0aeb9e8a.js";const xe=()=>{const{id:d}=F(),l=N.mixin(ae),V=O(),[K,k]=r.useState(!1),[C,se]=U(),p=C.get("id_business_unit"),m=C.get("id_shop");r.useState(1),r.useState(ee[0]);const[oe,L]=r.useState(0),[s,j]=r.useState({id_shop:"",id_contract:"",commission_price:"",benefit:"",fee:"",principle:0}),[h,b]=r.useState({old:0,remain:0}),[u,f]=r.useState({old:0,remain:0}),[g,x]=r.useState({old:0,remain:0}),[y,_]=r.useState({old:0,remain:0}),[P,$]=r.useState([]),z=[{to:"/apps/report/pay-to-shop-pv",label:"รายงานค่าตอบแทนร้านค้า"},{to:`/apps/report/pay-to-shop-pv/shop/${m}?id_business_unit=${p}`,label:"รายงานค่าตอบแทน"},{label:"แก้ไข",isCurrent:!0}],{mutate:H}=w(v.contractPVPayload,{onSuccess:e=>{j(i=>{var a,n,S,B,A,D,E,I;return{...i,...e.data,id_shop:(n=(a=e.data)==null?void 0:a.shop)==null?void 0:n.name,id_contract:(B=(S=e.data)==null?void 0:S.contract)==null?void 0:B.reference,commission_price:(A=e.data)==null?void 0:A.commission_price,benefit:(D=e.data)==null?void 0:D.benefit,fee:(E=e.data)==null?void 0:E.fee,principle:(I=e.data)==null?void 0:I.principle}}),f({old:e.data.commission_price,remain:e.data.commission_price}),x({old:e.data.benefit,remain:e.data.benefit}),_({old:e.data.fee,remain:e.data.fee}),$(e.data.history),b({old:e.data.principle,remain:e.data.principle}),L(e.data.history.length)},onError:()=>{console.error("Failed to fetch status data")}}),{mutate:G}=w(v.contractPVUpdate,{onSuccess:e=>{e.code==200||e.statusCode==200?(location.reload(),l.fire({icon:"success",title:"บันทึกสำเร็จ",padding:"10px 20px"})):l.fire({icon:"error",title:e==null?void 0:e.message,padding:"10px 20px"})},onError:()=>{console.error("Failed to fetch status data")}}),{mutate:M}=w(v.contractPVCancel,{onSuccess:e=>{e.code==200||e.statusCode==200?(l.fire({icon:"success",title:"ยกเลิก PV สำเร็จ",padding:"10px 20px"}),V(`/apps/report/pay-to-shop-pv/shop/${m}?id_business_unit=${p}`)):l.fire({icon:"error",title:e==null?void 0:e.message,padding:"10px 20px"})},onError:()=>{console.error("Failed to fetch status data")}}),Q=async e=>{const i={...e.commission_price?{commission_price:+e.commission_price}:{commission_price:u.old},...e.benefit?{benefit:+e.benefit}:{benefit:g.old},...e.fee?{fee:+e.fee}:{fee:y.old},...e.principle?{principle:+e.principle}:{principle:h.old},pv_id:d};k(!0),await G({data:i}),k(!1)},R=()=>{N.fire({title:"ยืนยันการยกเลิก PV",text:"คุณต้องการยกเลิกPVนี้ใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:J.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",reverseButtons:!0,html:`<label for="reason_cancel" style="display: block; text-align: left; margin-bottom: 10px; font-size: 1rem; margin-top: 10px; color: #000000;">เหตุผลการยกเลิก:</label>
            <input id="reason_cancel" type="text" class="swal2-input" style="margin: 0 !important; width: 100%; font-size: 1rem; color: #000000;" placeholder="โปรดระบุ">
            <label for="password" style="display: block; text-align: left; font-size: 1rem; margin-top: 10px; color: #000000;">รหัสผ่านผู้ใช้งาน:</label>
            <input id="password" type="password" type="text" class="swal2-input" style="margin: 0 !important; width: 100%; font-size: 1rem; color: #000000;" placeholder="รหัสผ่านผู้ใช้งาน สำหรับยืนยันการยกเลิก">`,preConfirm:()=>{const e=document==null?void 0:document.getElementById("reason_cancel"),i=document==null?void 0:document.getElementById("password");return!e.value||!i.value?(N.showValidationMessage("กรุณากรอกข้อมูลให้ครบทุกช่อง"),!1):{reason_cancel:e.value,password:i.value}}}).then(e=>{const i={...e.value,pv_id:d};e.isConfirmed&&M({data:i})})};return r.useEffect(()=>{H({data:{pv_id:d}})},[]),o(Z,{children:[t(te,{items:z}),K&&t(ne,{}),o("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:[o("div",{className:"invoice-table flex justify-between",children:[t("div",{className:"my-3 text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center flex flex-row justify-between",children:"แก้ไขค่าตอบแทนร้านค้า"}),t("button",{type:"button",onClick:R,className:"bg-red-500 rounded-lg px-4 active:scale-[0.97] shadow text-white border-0",children:"ยกเลิก PV"})]}),t(W,{initialValues:s,onSubmit:Q,enableReinitialize:!0,children:({setFieldValue:e})=>o(X,{className:"flex flex-col gap-4",children:[o("div",{className:"flex gap-4",children:[t(T,{label:"ร้านค้า",id:"id_shop",name:"id_shop",disabled:!0}),t(T,{label:"เลขที่สัญญา",id:"id_contract",name:"id_contract",disabled:!0})]}),t("h3",{className:"text-[16px] font-semibold",children:"รายการเลขที่"}),t("div",{className:"table-responsive ",children:o("table",{className:"table-striped table-hover",children:[t("thead",{children:o("tr",{children:[t("th",{className:"text-center",children:"ลำดับ"}),t("th",{className:"min-w-[155px]",children:"รายการ"}),t("th",{className:"min-w-[200px]",children:"ยอดปัจจุบัน"}),t("th",{children:"ยอดปรับปรุง"})]})}),o("tbody",{children:[o("tr",{children:[t("td",{className:"text-center",children:"1"}),t("td",{children:"ทุนเช่าซื้อ"}),t("td",{children:h.old}),t("td",{children:t(c,{name:"principle",children:({field:i})=>t("input",{type:"text",...i,disabled:s==null?void 0:s.reason_cancel,onChange:a=>{e("principle",a.target.value),a.target.value==""&&b(n=>({...n,remain:n.old})),b(n=>({...n,remain:+a.target.value}))},className:"outline-none border-b shadow py-2 px-2",onKeyDown:a=>{!/[0-9]/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Tab"&&!(a.ctrlKey&&a.key.toLowerCase()==="a")&&a.preventDefault()}})})})]}),o("tr",{children:[t("td",{className:"text-center",children:"2"}),t("td",{children:"ค่านายหน้า"}),t("td",{children:u.old}),t("td",{children:t(c,{name:"commission_price",children:({field:i})=>t("input",{type:"text",...i,disabled:s==null?void 0:s.reason_cancel,onChange:a=>{e("commission_price",a.target.value),a.target.value==""&&f(n=>({...n,remain:n.old})),f(n=>({...n,remain:+a.target.value}))},className:"outline-none border-b shadow py-2 px-2",onKeyDown:a=>{!/[0-9]/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Tab"&&!(a.ctrlKey&&a.key.toLowerCase()==="a")&&a.preventDefault()}})})})]}),o("tr",{className:"bg-[rgba(224,230,237,0.2)]",children:[t("td",{className:"text-center",children:"3"}),t("td",{children:"ค่าตอบแทนพิเศษ"}),t("td",{children:g.old}),t("td",{children:t(c,{name:"benefit",children:({field:i})=>t("input",{type:"text",...i,disabled:s==null?void 0:s.reason_cancel,onChange:a=>{e("benefit",a.target.value),a.target.value==""&&x(n=>({...n,remain:n.old})),x(n=>({...n,remain:+a.target.value}))},onKeyDown:a=>{!/[0-9\-]/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Tab"&&!(a.ctrlKey&&a.key.toLowerCase()==="a")&&a.preventDefault()},className:"outline-none border-b shadow py-2 px-2"})})})]}),o("tr",{children:[t("td",{className:"text-center",children:"4"}),t("td",{children:"ค่าธรรมเนียมสัญญา"}),t("td",{children:y.old}),t("td",{children:t(c,{name:"fee",children:({field:i})=>t("input",{type:"text",...i,disabled:s==null?void 0:s.reason_cancel,onKeyDown:a=>{!/[0-9]/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Tab"&&!(a.ctrlKey&&a.key.toLowerCase()==="a")&&a.preventDefault()},onChange:a=>{e("fee",a.target.value),a.target.value==""&&_(n=>({...n,remain:n.old})),_(n=>({...n,remain:+a.target.value}))},className:"outline-none border-b shadow py-2 px-2"})})})]}),o("tr",{className:"bg-[rgba(224,230,237)]",children:[t("td",{className:"text-center"}),t("td",{className:"font-semibold",children:"รวมทั้งสิ้น"}),t("td",{}),t("td",{className:"font-semibold",children:h.remain+u.remain+g.remain-y.remain})]})]})]})}),!(s!=null&&s.reason_cancel)&&o("div",{className:"flex gap-4 justify-center",children:[t(q,{to:`/apps/report/pay-to-shop-pv/shop/${m}?id_business_unit=${p}`,className:"px-4 py-2 rounded-md border border-black/50 text-black",children:"ยกเลิก"}),t("button",{type:"submit",className:"px-4 py-2 rounded-md bg-blue-500 text-white ",children:"บันทึก"})]})]})})]}),o("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:[t("h5",{className:"text-lg font-semibold mb-4",children:"ประวัติการทำรายการ"}),t("div",{className:"datatables pagination-padding",children:t(Y,{className:"whitespace-nowrap table-hover invoice-table",records:P,columns:[{accessor:"id",title:"ลำดับ",textAlignment:"center",sortable:!1,render:(e,i)=>t("p",{children:P.length-i})},{accessor:"pv_no",title:"หมายเลขรายการ",textAlignment:"center",sortable:!1},{accessor:"commission_price",title:"ค่านายหน้า",textAlignment:"center",sortable:!1},{accessor:"benefit",title:"ค่าตอบแทนพิเศษ",textAlignment:"center",sortable:!1},{accessor:"fee",title:"ค่าทำเนียม",textAlignment:"center",sortable:!1},{accessor:"commission_price_before",title:"ค่านายหน้า (ปรับปรุง)",textAlignment:"center",sortable:!1},{accessor:"benefit_before",title:"ค่าตอบแทนพิเศษ (ปรับปรุง)",textAlignment:"center",sortable:!1},{accessor:"fee_before",title:"ค่าทำเนียม (ปรับปรุง)",textAlignment:"center",sortable:!1},{accessor:"userChanged",title:"ผู้ดำเนินการ (ปรับปรุง)",textAlignment:"center",sortable:!1},{accessor:"created_at",title:"วันที่ - เวลา",textAlignment:"center",sortable:!1,render:e=>t("p",{children:ie(e==null?void 0:e.created_at)})}],minHeight:160,highlightOnHover:!0})})]})]})};export{xe as default};
