import{r as s}from"./index-a90aa29c.js";const x=8,k=46;function C(){}function I(a,e){return Array.from({length:e},(t,i)=>i+a)}function R(a){try{return(a.webkitMatchesSelector||a.matches).call(a,":focus")}catch{return!1}}const m={length:5,format:a=>a,formatAriaLabel:(a,e)=>`PIN field ${a} of ${e}`,onChange:C,onComplete:C},V={type:"text",inputMode:"text",autoCapitalize:"off",autoCorrect:"off",autoComplete:"off"},$={length:m.length,format:m.format,dir:"ltr",cursor:0,values:Array(m.length),backspace:!1,composition:!1,ready:!1,dirty:!1};function q(a,e){switch(e.type){case"update-props":{const t={...a,...e.props};return t.cursor=Math.min(t.cursor,t.length-1),t.values=t.values.slice(0,t.cursor+1),t.ready=!0,t}case"start-composition":return{...a,dirty:!0,composition:!0};case"end-composition":{const t={...a};e.value?t.values[e.index]=e.value:delete t.values[e.index];const i=t.values[e.index]?1:0;return t.cursor=Math.min(e.index+i,t.length-1),t.composition=!1,t.dirty=!0,t}case"handle-change":{if(a.composition)break;const t={...a};if(e.reset&&t.values.splice(e.index,t.length),e.value){const i=e.value.split("").map(t.format),c=Math.min(t.length-e.index,i.length);t.values.splice(e.index,c,...i.slice(0,c)),t.cursor=Math.min(e.index+c,t.length-1)}else{delete t.values[e.index];const i=t.backspace?0:1;t.cursor=Math.max(0,e.index-i)}return t.backspace=!1,t.dirty=!0,t}case"handle-key-down":{const t=e.key==="Backspace"||e.key==="Delete",i=e.code==="Backspace"||e.code==="Delete",c=e.keyCode===x||e.keyCode===k,h=e.which===x||e.which===k;if(!(t||i||c||h)||a.values[e.index])break;{const d={...a};return d.cursor=Math.max(0,e.index-1),d.backspace=!0,d.dirty=!0,d}}}return a}function z(){const a=s.useRef([]),[e,t]=s.useReducer(q,$),i=s.useMemo(()=>{let h="";for(let d=0;d<e.length;d++)h+=d in e.values?e.values[d]:"";return h},[e]),c=s.useCallback(h=>{t({type:"handle-change",index:0,value:h,reset:!0})},[t,e.cursor]);return s.useMemo(()=>({refs:a,state:e,dispatch:t,value:i,setValue:c}),[a,e,t,i,c])}const H=s.forwardRef(({length:a=m.length,format:e=m.format,formatAriaLabel:t=m.formatAriaLabel,onChange:i=m.onChange,onComplete:c=m.onComplete,handler:h,autoFocus:d,...y},b)=>{const w=z(),{refs:f,state:n,dispatch:l}=h||w;s.useImperativeHandle(b,()=>f.current,[f]);function E(r){return o=>{o&&(f.current[r]=o)}}function M(r){return o=>{const{key:u,code:p,keyCode:v,which:F}=o;l({type:"handle-key-down",index:r,key:u,code:p,keyCode:v,which:F})}}function A(r){return o=>{if(o.nativeEvent instanceof InputEvent){const u=o.nativeEvent.data;l({type:"handle-change",index:r,value:u})}else{const{value:u}=o.target;l({type:"handle-change",index:r,value:u,reset:!0})}}}function L(r){return()=>{l({type:"start-composition",index:r})}}function D(r){return o=>{l({type:"end-composition",index:r,value:o.data})}}if(s.useEffect(()=>{var r,o;if(n.ready)return;const u=((r=y.dir)==null?void 0:r.toLowerCase())||((o=document.documentElement.getAttribute("dir"))==null?void 0:o.toLowerCase());l({type:"update-props",props:{length:a,format:e,dir:u}})},[n.ready,l,a,e]),s.useEffect(()=>{n.ready&&a!==n.length&&l({type:"update-props",props:{length:a}})},[n.ready,a,n.length,l]),s.useEffect(()=>{n.ready&&e!==n.format&&l({type:"update-props",props:{format:e}})},[n.ready,e,n.format,l]),s.useEffect(()=>{var r,o;if(!n.ready)return;const u=((r=y.dir)==null?void 0:r.toLowerCase())||((o=document.documentElement.getAttribute("dir"))==null?void 0:o.toLowerCase());u!==n.dir&&l({type:"update-props",props:{dir:u}})},[n.ready,y.dir,n.dir,l]),s.useEffect(()=>{if(!f.current||!n.ready||!n.dirty)return;let r=!1,o=n.values.length==n.length,u="";for(let p=0;p<n.length;p++){const v=p in n.values?n.values[p]:"";f.current[p].value=v,r=r||R(f.current[p]),o=o&&p in n.values&&f.current[p].checkValidity(),u+=v}r&&f.current[n.cursor].focus(),i&&i(u),c&&o&&c(u)},[f,n,i,c]),!n.ready)return null;const g=I(0,n.length).map(r=>s.createElement("input",{...V,...y,key:r,ref:E(r),value:r in n.values?n.values[r]:"",autoFocus:r===0&&d,onKeyDown:M(r),onChange:A(r),onCompositionStart:L(r),onCompositionEnd:D(r),"aria-label":t(r+1,n.length),"aria-required":y.required?"true":void 0,"aria-disabled":y.disabled?"true":void 0,"aria-readonly":y.readOnly?"true":void 0}));return n.dir==="rtl"&&g.reverse(),g});export{H as W};
