import{an as H,u as j,a as F,r,s as V,b as G,i as K,c as m,j as s,f as o,F as T,t as q,g as _}from"./index-a90aa29c.js";import{c as B,a as n,d as W}from"./object-7405de1d.js";import{S as Y}from"./sweetalert2.all-ca2d1030.js";import{F as X,a as J}from"./formik.esm-c4fd04ca.js";import{I as l}from"./InputField-d7971719.js";import{S as p}from"./SelectField-917481a8.js";import{t as Z,a as z,r as Q,b as $}from"./constant-e85f1578.js";import{B as ee}from"./breadcrumbs-b9914bbc.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";const se="admin",u=Y.mixin(Z),Ae=()=>{const{id:h}=H(),b=j(),y=F(),i=localStorage.getItem(se),c=i?JSON.parse(i).role:null,v=i?JSON.parse(i).uuid:null,A=i?JSON.parse(i??"{}").access_level:null,E=i?JSON.parse(i).email:null;let f=!1;(E=="dev@tplus.co.th"||E=="admin258@tplus.co.th")&&(f=!0);const[I,P]=r.useState(!1);c!=="admin"&&c!=="business_unit"&&b("/");const D=[{to:"/apps/employee/list",label:"พนักงาน"},{label:"แก้ไข",isCurrent:!0}];r.useEffect(()=>{y(V("แก้ไขพนักงาน")),y(G(["employee","/apps/employee/list"]))},[]);const[U,R]=r.useState([]),S=K(t=>t.dataStore.employees),[C,N]=r.useState({}),{mutate:O,isLoading:x}=m(_.employeeFind,{onSuccess:t=>{var a;const e=t.data;e.password="",e.password_repeat="",e.pin="",N({...e,id_business_unit:e.account_type==="admin"?"tms":e.id_business_unit}),(e.role=="executive"&&e.access_level=="A"||f||v==h)&&((a=q.features)==null?void 0:a.payment_transfer)==!0&&P(!0)},onError:()=>{console.error("Failed to fetch bu data")}});r.useEffect(()=>{O({data:{},id:h||S.id})},[]);const{mutate:L}=m(_.contractFilter,{onSuccess:t=>{R([{value:"tms",label:"TMS"},...t.data.business_unit.map(e=>({value:e.id,label:e.name}))])},onError:()=>{console.error("Failed to fetch bu data")}});r.useEffect(()=>{c==="admin"&&L({})},[]);const{mutate:M}=m(_.employeeUpdate,{onSuccess:t=>{t.statusCode===200||t.code===200?(u.fire({icon:"success",title:"แก้ไขสำเร็จ",padding:"10px 20px"}),b("/apps/employee/list")):u.fire({icon:"error",title:t.message,padding:"10px 20px"})},onError:()=>{console.error("Failed to fetch bu data")}}),d=(t,e,a)=>{t.setFieldValue(a,e.value)},w=r.useCallback(t=>{var g;const{id:e,...a}=t;if(a!=null&&a.pin&&((g=a==null?void 0:a.pin)==null?void 0:g.length)!=6)return u.fire({icon:"error",title:"PIN ต้องมีความยาว 6 ตัวเท่านั้น",padding:"10px 20px"}),!1;M({data:a,id:e||S.id})},[]),k=B().shape({title:n().required("กรุณาใส่ข้อมูลให้ครบ"),name:n().required("กรุณาใส่ข้อมูลให้ครบ"),phone_number:n().required("กรุณาใส่ข้อมูลให้ครบ"),email:n().email("กรุณาใส่อีเมลที่ถูกต้อง").required("กรุณาใส่ข้อมูลให้ครบ"),role:n().required("กรุณาใส่ข้อมูลให้ครบ"),access_level:n().required("กรุณาใส่ข้อมูลให้ครบ"),password_repeat:n().oneOf([W("password"),null],"รหัสผ่านไม่ตรงกัน")});return x?s("div",{children:"Loading..."}):o(T,{children:[s(ee,{items:D}),s("div",{className:"flex xl:flex-row flex-col gap-2. pt-5",children:s("div",{className:"panel px-6 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6",children:s(X,{initialValues:C,onSubmit:w,enableReinitialize:!0,autoComplete:"off",validationSchema:k,children:t=>o(J,{className:"space-y-5 dark:text-white custom-select",children:[o("div",{className:"input-flex-row",children:[s(p,{label:"คำนำหน้า",id:"title",name:"title",options:z,placeholder:"กรุณาเลือก",onChange:e=>d(t,e,"title"),isSearchable:!1,require:!0}),s(l,{label:"ชื่อพนักงาน",name:"name",type:"text",placeholder:"กรุณาใส่ข้อมูล",require:!0})]}),o("div",{className:"input-flex-row",children:[s(l,{label:"Line ID",name:"line_id",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),s(l,{label:"Email",name:"email",type:"text",placeholder:"กรุณาใส่ข้อมูล",require:!0})]}),o("div",{className:"input-flex-row",children:[s(p,{label:"ตำแหน่ง",id:"role",name:"role",options:Q,placeholder:"กรุณาเลือก",onChange:e=>d(t,e,"role"),isSearchable:!1,require:!0}),s(p,{label:"ระดับสิทธิ",id:"access_level",name:"access_level",options:$,placeholder:"กรุณาเลือก",onChange:e=>d(t,e,"access_level"),isSearchable:!1,require:!0})]}),o("div",{className:"input-flex-row",children:[s(l,{label:"เบอร์โทรศัพท์พนักงาน",name:"phone_number",type:"text",maxLength:10,onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},require:!0}),c==="admin"&&s(p,{label:"หน่วยธุรกิจ",id:"id_business_unit",name:"id_business_unit",placeholder:"กรุณาเลือก",className:"w-auto",options:U,isSearchable:!0,onChange:e=>{d(t,e,"id_business_unit")}})]}),(A=="A"||A=="B")&&s("div",{className:"input-flex-row",children:s(p,{label:"เปิดใช้งาน",id:"is_active",name:"is_active",placeholder:"กรุณาเลือก",options:[{value:!0,label:"เปิดการใช้งาน"},{value:!1,label:"ปิดการใช้งาน"}]})}),o("div",{className:"input-flex-row",children:[s(l,{label:"รหัสผ่าน",name:"password",type:"password",require:!0}),s(l,{label:"ยืนยันรหัสผ่าน",name:"password_repeat",type:"password",require:!0})]}),I&&s(T,{children:s("div",{className:"input-flex-row",children:s(l,{label:"PIN",name:"pin",type:"password",maxLength:6,onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()}})})}),s("button",{type:"submit",className:"btn !mt-6 w-full border-0 btn-primary",children:"บันทึก"})]})})})})]})};export{Ae as default};
