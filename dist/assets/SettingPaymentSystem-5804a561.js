import{u as F,r as a,c as o,h as b,f as n,j as t,g as r}from"./index-a90aa29c.js";import{c as g,a as y}from"./object-7405de1d.js";import{S as V}from"./sweetalert2.all-ca2d1030.js";import{F as f,a as T}from"./formik.esm-c4fd04ca.js";import{I as Y}from"./InputField-d7971719.js";import{S as l}from"./SelectField-917481a8.js";import{t as B}from"./constant-e85f1578.js";import{F as A}from"./DatePicker-5cf5930a.js";import{d as S,f as E,g as v}from"./formatDate-4e046265.js";import{I as G}from"./IconX-54a3093e.js";import{q as c,_ as C}from"./transition-d4ca4cfa.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";import"./flatpickr-2301360e.js";import"./keyboard-f171a3e5.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const K="admin",ge=()=>{const I=F(),m=localStorage.getItem(K),i=V.mixin(B),[d,p]=a.useState(!1);(m?JSON.parse(m).role:null)!=="admin"&&I("/");const[D,x]=a.useState([]),{mutate:R}=o(r.contractFilter,{onSuccess:e=>{x(e.data.business_unit.map(s=>({value:s,label:s.name})))},onError:()=>{console.error("Failed to fetch status data")}}),[U,P]=a.useState({start_at:`${b.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`,end_at:`${b.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`,is_active:!0,message:""}),[k,q]=a.useState({type:"",id_business_unit:null}),{mutate:_}=o(r.getConfigTMS,{onSuccess:e=>{P({start_at:v(e.data.date_start),end_at:v(e.data.date_end),message:e.data.message,is_active:e.data.status,type:e.data.type})}}),{mutate:u,isLoading:N}=o(r.updateConfigTMS,{onSuccess:e=>{e.statusCode===200||e.code===200?(i.fire({icon:"success",title:"บันทึกสำเร็จ",padding:"10px 20px"}),window.location.reload()):i.fire({icon:"error",title:e.message,padding:"10px 20px"})},onError:()=>{}}),{mutate:M}=o(r.clearAllCache,{onSuccess:e=>{e.statusCode===200||e.code===200?i.fire({icon:"success",title:"สำเร็จ",padding:"10px 20px"}):i.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),{mutate:O}=o(r.reminderLine,{onSuccess:e=>{e.statusCode===200||e.code===200?i.fire({icon:"success",title:"สำเร็จ",padding:"10px 20px"}):i.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),{mutate:h}=o(r.clearToken,{onSuccess:e=>{e.statusCode===200||e.code===200?i.fire({icon:"success",title:"สำเร็จ",padding:"10px 20px"}):i.fire({icon:"error",title:e.message,padding:"10px 20px"})}});a.useEffect(()=>{_({}),R({})},[_]);const L=a.useCallback(e=>{const s={...e,start_at:S(e.start_at),end_at:S(e.end_at)};u({data:s})},[u]),w=a.useCallback(e=>{var s;h({data:{type:e==null?void 0:e.type,id_business_unit:((s=e==null?void 0:e.business_unit)==null?void 0:s.id)??null}})},[h]),H=g().shape({message:y().required("กรุณาใส่ข้อมูลให้ครบ")}),j=g().shape({type:y().required("กรุณาใส่ข้อมูลให้ครบ")});return n("div",{className:"flex xl:flex-col flex-col gap-2.5",children:[n("div",{className:"flex justify-end",style:{marginRight:25},children:[t("button",{type:"submit",className:"btn !mt-6 mr-2 border-0 btn-info",onClick:()=>{O({})},children:"ส่งแจ้งเตือนชำระเงิน"}),t("button",{type:"submit",className:"btn !mt-6 mr-2 border-0 btn-danger",onClick:()=>{p(!0)},children:"Clear Token"}),t("button",{type:"submit",className:"btn !mt-6 border-0 btn-warning",onClick:()=>{M({})},children:"Clear Cache"})]}),t("div",{className:"panel px-6 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6",children:t(f,{initialValues:U,onSubmit:L,enableReinitialize:!0,autoComplete:"off",validationSchema:H,children:({setFieldValue:e})=>n(T,{className:"space-y-5 dark:text-white ",children:[t("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"ระบบ ปิดใช้งานระบบชั่วคราว"}),n("div",{children:[t(A,{label:"วันที่เริ่ม",name:"start_at",enableTime:!0,onChange:s=>{e("start_at",E(s))}}),t(A,{label:"วันที่สิ้นสุด",name:"end_at",enableTime:!0,onChange:s=>{e("end_at",E(s))}}),t(Y,{require:!0,label:"คำอธิบาย",name:"message",as:"textarea",rows:"10"}),t(l,{label:"หน้าที่แจ้งเปิด",id:"type",name:"type",isMulti:!0,options:[{value:"web",label:"เว็บ"},{value:"line",label:"ไลน์"}]}),t(l,{label:"สถานะการปิดใช้งาน",id:"is_active",name:"is_active",options:[{value:!1,label:"ปิด"},{value:!0,label:"เปิด"}]}),n("button",{type:"submit",className:"btn !mt-6 w-full border-0 btn-primary",children:[N&&t("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-5 h-5 ltr:mr-4 rtl:ml-4 inline-block align-middle"}),"บันทึก"]})]})]})})}),t(c,{appear:!0,show:d,as:a.Fragment,children:n(C,{as:"div",open:d,onClose:()=>p(!1),className:"relative z-[51]",children:[t(c.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(c.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:n(C.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",style:{height:500},children:[t("button",{type:"button",onClick:()=>p(!1),className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(G,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"Clear Token"}),t("div",{className:"p-5",children:t(f,{initialValues:k,onSubmit:w,enableReinitialize:!0,autoComplete:"off",validationSchema:j,children:e=>n(T,{className:"space-y-5 mb-7 dark:text-white custom-select",children:[t(l,{label:"ประเภท*",id:"type",name:"type",options:[{value:"admin",label:"Admin"},{value:"business_unit",label:"BU"},{value:"shop",label:"Shop"},{value:"customer",label:"Customer"}],placeholder:"กรุณาเลือก",onChange:s=>{e.setFieldValue("type",s.value)},isSearchable:!1}),e.values.type==="business_unit"&&t(l,{label:"Business Unit*",id:"business_unit",name:"business_unit",options:[{value:null,label:"ทั้งหมด"},...D],placeholder:"กรุณาเลือก BU",onChange:s=>{e.setFieldValue("business_unit",s.value)},isSearchable:!0}),t("div",{className:"flex justify-center items-center mt-8",children:t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"ตกลง"})})]})})})]})})})})]})})]})};export{ge as default};
