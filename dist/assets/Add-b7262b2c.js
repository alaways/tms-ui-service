import{r,u as q,c as d,f as n,F as X,j as t,N as z,g as m,t as T}from"./index-a90aa29c.js";import{F as Z,a as $}from"./formik.esm-c4fd04ca.js";import{c as J}from"./formatDate-4e046265.js";import{c as Q,a as _}from"./object-7405de1d.js";import{I as c}from"./InputField-d7971719.js";import{S as h}from"./SelectField-917481a8.js";import{B as ee}from"./breadcrumbs-b9914bbc.js";import{t as te}from"./constant-e85f1578.js";import{P as ae}from"./preLoading-b2445d9d.js";import{S as u}from"./sweetalert2.all-ca2d1030.js";import{I as se}from"./IconX-54a3093e.js";import{W as ne}from"./react-pin-field-c38d4b32.js";import{q as b,_ as E}from"./transition-d4ca4cfa.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";import"./keyboard-f171a3e5.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const oe="admin",re=[{label:"ประวัติการโอนเงิน",to:"/apps/finance/transfer-history"},{label:"โอนเงิน",isCurrent:!0}],De=()=>{const f=localStorage.getItem(oe),[x,i]=r.useState(!1),[S,v]=r.useState(""),N=r.useRef(null),C=u.mixin(te),I=q(),P=f?JSON.parse(f).name:null,[R,k]=r.useState([]),[U,D]=r.useState([]),[O,ie]=r.useState([{label:"TMS",value:"tms"},{label:"ITmoney",value:"itm"},{label:"Rub Phone",value:"rph"}]),[g,l]=r.useState(!1),[L,M]=r.useState([]),[w,le]=r.useState({id_shop:"",type:"",id_shop_bank:"",userChanged:P,created_at:J([new Date]),note:"",amount:"",company:""}),[o,j]=r.useState({}),F=Q().shape({id_shop:_().required("กรุณาเลือกข้อมูล"),id_shop_bank:_().required("กรุณาใส่ข้อมูลให้ครบ"),amount:_().required("กรุณาใส่ข้อมูลให้ครบ").max(15,"จำนวนไม่ควรเกิน 15 ตัวอักษร").matches(/^\d{1,13}(\.\d{1,2})?$/,"รูปแบบจำนวนเงินไม่ถูกต้อง (ทศนิยมไม่เกิน 2 ตำแหน่ง)").test("is-greater-than-zero","จำนวนต้องมากกว่า 0",e=>{const a=parseFloat(e||"");return!isNaN(a)&&a>0})}),{mutate:H}=d(m.shopFind,{onSuccess:e=>{var a,p;(a=e==null?void 0:e.data)!=null&&a.shop_banks&&k((p=e==null?void 0:e.data)==null?void 0:p.shop_banks.map(s=>{var y,A;return{value:s.id,label:`${(y=s==null?void 0:s.bank)==null?void 0:y.name} - ${s==null?void 0:s.bank_account_number} (${s==null?void 0:s.bank_account_name})`,type:s.id!=19?"bank":((A=s==null?void 0:s.bank_account_number)==null?void 0:A.length)==13?"pp_cardid":"pp_phone"}}))},onError:()=>{console.error("Failed to fetch data comission")}}),{mutate:V}=d(m.shopFindAll,{onSuccess:e=>{D(e.data.list.map(a=>({value:a.id,label:a.name})))},onError:()=>{console.error("Failed to fetch asset type data")}});r.useEffect(()=>{V({})},[]);const{mutate:B,isLoading:G}=d(m.bblValidate,{onSuccess:e=>{e.statusCode===200||e.code===200?(i(!1),j(e==null?void 0:e.data),l(!0)):(i(!1),C.fire({icon:"error",title:e.message,padding:"10px 20px"}))},onError:()=>{console.error("Failed to fetch asset type data")}}),{mutate:K,isLoading:W}=d(m.bblConfirm,{onSuccess:e=>{e.statusCode===200||e.code===200?(l(!1),u.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px",confirmButtonColor:T.color.themePrimary,confirmButtonText:"ยืนยัน"}).then(a=>{a.isConfirmed&&I("/apps/finance/transfer-history")})):(l(!1),u.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:e.message,padding:"10px 20px",confirmButtonColor:T.color.themePrimary,confirmButtonText:"ยืนยัน"}).then(a=>{a.isConfirmed&&window.location.reload()}))},onError:()=>{console.error("Failed to fetch asset type data")}}),Y=r.useCallback(e=>{i(!0);const a={id_shop:e==null?void 0:e.id_shop,note:e==null?void 0:e.note,id_shop_bank:e==null?void 0:e.id_shop_bank,amount:+(e==null?void 0:e.amount),additionalRef:e.additionalRef,company:e.company};M(a)},[]);return n(X,{children:[t(ee,{items:re}),(G||W)&&t(ae,{}),x&&t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n("div",{className:"relative bg-white p-6 rounded-lg shadow-lg text-center",children:[t("button",{onClick:()=>i(!1),className:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",children:"×"}),t("h2",{className:"text-xl font-semibold mb-4",children:"Enter PIN Code"}),t(ne,{ref:N,length:6,onChange:e=>{e.toUpperCase().replace(/[^A-Z0-9]/g,"")},onComplete:e=>{i(!1),setTimeout(()=>{v(e),B({data:{...L,pin:e}})},1e3)},inputMode:"text",autoFocus:!0,className:"w-12 h-14 mx-1 text-2xl text-center border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"})]})}),n("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:[t("h5",{className:"my-3 text-2xl font-semibold ltr:sm:text-left rtl:sm:text-right text-center flex flex-row justify-between",children:"โอนเงิน"}),t(Z,{initialValues:w,onSubmit:Y,validationSchema:F,enableReinitialize:!0,children:e=>n($,{className:"flex flex-col gap-4",children:[t("div",{className:"flex gap-4",children:t(h,{label:"โอนจากบัญชี",id:"company",name:"company",options:O,placeholder:"กรุณาเลือก",isSearchable:!0,require:!0,onChange:a=>{e.setFieldValue("company",a.value)}})}),n("div",{className:"flex gap-4",children:[t(c,{name:"userChanged",label:"ผู้ดำเนินการ",disabled:!0}),t(c,{name:"created_at",label:"วันที่สร้าง",disabled:!0})]}),t("hr",{}),n("div",{className:"flex gap-4",children:[t(c,{name:"additionalRef",label:"เลขที่ชำระเงิน"}),t(h,{label:"ร้านค้า",id:"id_shop",name:"id_shop",options:U,placeholder:"กรุณาเลือก",isSearchable:!0,require:!0,onChange:a=>{H({data:{},id:a.value}),e.setFieldValue("id_shop",a.value)}})]}),n("div",{className:"flex gap-4",children:[t(h,{label:"บัญชีธนาคาร",id:"id_shop_bank",name:"id_shop_bank",require:!0,options:R,placeholder:"กรุณาเลือก",isSearchable:!0}),t(c,{require:!0,name:"amount",label:"ยอดชำระเงิน",onKeyDown:a=>{a.ctrlKey&&a.key==="a"||(!/[0-9]/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Tab"&&a.key!=="."&&a.preventDefault(),a.key==="."&&(a.target.value===""||a.target.value.includes("."))&&a.preventDefault())},onChange:a=>{if(a.target.value.includes(".")){let[p,s]=a.target.value.split(".");s.length>2&&(s=s.slice(0,2)),e.setFieldValue("amount",p+"."+s)}else e.setFieldValue("amount",a.target.value)}})]}),t("div",{className:"flex gap-4",children:t("div",{className:"w-full",children:t(c,{label:"บันทึกช่วยจำ",name:"note",as:"textarea",rows:"5",className:"form-textarea ltr:rounded-l-none rtl:rounded-r-none resize-none","default-value":"-"})})}),n("div",{className:"flex gap-4 justify-center",children:[t(z,{to:"/apps/finance/transfer-history",className:"px-4 py-2 rounded-md border border-black/50 text-black",children:"ยกเลิก"}),t("button",{type:"submit",className:"px-4 py-2 rounded-md bg-themePrimary text-white ",children:"ตรวจสอบข้อมูล"})]})]})})]}),t(b,{appear:!0,show:g,as:r.Fragment,children:n(E,{as:"div",open:g,onClose:()=>{l(!1)},className:"relative z-[51]",children:[t(b.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(b.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:n(E.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[t("button",{type:"button",onClick:()=>{l(!1)},className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(se,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px] text-center",children:"ตรวจสอบข้อมูล"}),t("div",{className:"p-5",children:n("div",{className:"p-5",children:[n("div",{className:"mb-5 space-y-1",children:[n("div",{className:"flex items-center justify-between",children:[t("p",{className:"text-[#515365] font-semibold",children:"ธนาคาร "}),t("p",{className:"text-base",children:t("span",{className:"font-semibold",children:(o==null?void 0:o.bankName)??0})})]}),n("div",{className:"flex items-center justify-between",children:[t("p",{className:"text-[#515365] font-semibold",children:"ชื่อผู้รับ"}),t("p",{className:"text-base",children:t("span",{className:"font-semibold",children:(o==null?void 0:o.receiverName)??0})})]}),n("div",{className:"flex items-center justify-between",children:[t("p",{className:"text-[#515365] font-semibold",children:"หมายเลขบัญชี"}),t("p",{className:"text-base",children:t("span",{className:"font-semibold",children:(o==null?void 0:o.bankAccount)??0})})]}),n("div",{className:"flex items-center justify-between",children:[t("p",{className:"text-[#515365] font-semibold",children:"จำนวนเงิน "}),n("span",{className:"font-semibold ",children:[(o==null?void 0:o.amount)??0," บาท"]})]})]}),t("div",{className:"text-center px-2 flex justify-around",children:t("button",{type:"button",className:"btn btn-success",onClick:()=>{K({data:{reference:o==null?void 0:o.reference,pin:S}})},children:"ยืนยันการโอนเงิน"})})]})})]})})})})]})})]})};export{De as default};
