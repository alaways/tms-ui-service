import{ak as ae,r as a,a as re,u as ie,i as pe,c as L,s as M,f as i,j as s,L as le,I as ce,al as k,am as de,t as _e,g as S}from"./index-a90aa29c.js";import{b as me,c as he}from"./formatNumeric-862380d6.js";import{Q as ue}from"./index-2f30bf27.js";import{T as w}from"./tippy-react.esm-150a8dd6.js";import{I as ge}from"./IconPlus-4c7e79c8.js";import{I as Ae}from"./IconEye-eb8ead5b.js";/* empty css              */import{S as H}from"./sweetalert2.all-ca2d1030.js";import{t as Ee}from"./constant-e85f1578.js";import{F as be,a as ye}from"./formik.esm-c4fd04ca.js";import{S as Te}from"./react-select.esm-b46d9623.js";import{u as b,w as Se}from"./xlsx-9a117414.js";import{P as fe}from"./preLoading-b2445d9d.js";import{P as j}from"./config-8de56c22.js";import"./floating-ui.dom-0aeb9e8a.js";import"./createSuper-98fcd92d.js";const ve="admin",Ve=()=>{const{t}=ae(),y=H.mixin(Ee),[f,v]=a.useState([]),m=re(),I=ie(),G=pe(e=>e.dataStore.provinces),g=localStorage.getItem(ve),A=g?JSON.parse(g).role:null,V=g?JSON.parse(g).access_token:null,[h,E]=a.useState(1),[p,B]=a.useState(j[0]),[K,F]=a.useState(0),[P,C]=a.useState([]),[R,W]=a.useState(!1);a.useEffect(()=>{W(!0)},[]);const[c,Y]=a.useState({}),{mutate:u}=L(S.shopFindAll,{onSuccess:e=>{C(e.data.list),F(e.data.total),v(e.data.list.filter(o=>o.is_create_customer))},onError:e=>{}}),{mutate:q}=L(S.updateCreateCustomer,{onSuccess:e=>{e.statusCode!==400?(u({data:{page:1,page_size:p}}),y.fire({icon:"success",title:t("save_success"),padding:"10px 20px"})):y.fire({icon:"warning",title:e.message,padding:"10px 20px"})},onError:e=>{y.fire({icon:"warning",title:e.message,padding:"10px 20px"})}}),D=e=>{m(k(e)),m(de("preview")),I("/apps/shop/edit/"+e.id)},z=e=>{m(k(e)),I("/apps/shop/report/"+e.id)};a.useEffect(()=>{m(M("รายการร้านค้า"))},[]),a.useEffect(()=>{m(M("รายการลูกค้า")),u({data:{page:1,page_size:p}})},[]),a.useEffect(()=>{R&&(E(h),C([]),u({data:{...c,page:h,page_size:p}}))},[h]),a.useEffect(()=>{R&&u({data:{...c,page:1,page_size:p}})},[p]);const X=()=>{H.fire({title:t("confirm_update_title"),text:t("confirm_update_text"),icon:"warning",showCancelButton:!0,confirmButtonColor:_e.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:t("confirm"),cancelButtonText:t("cancel"),reverseButtons:!0}).then(e=>{if(e.isConfirmed){const o=P.map(n=>({id_shop:n.id,is_create_customer:f.some(r=>n.id===r.id)}));q({data:{shops:o}})}})},$=[{id:"uuid",displayName:"uuid"}],[U,N]=a.useState(!1),Z="https://dev-tms-admin.gsrental.cn:7443/api/v1",Q=async()=>{var r;const e=new Headers;e.append("Content-Type","application/json"),e.append("Authorization",`Bearer ${V}`);const o=JSON.stringify({...c,id_province:((r=c==null?void 0:c.id_province)==null?void 0:r.value)??null}),n={method:"POST",headers:e,body:o,redirect:"follow"};return fetch(Z+S.shopExport,n).then(l=>l.json()).then(l=>l.data).catch(l=>[])},J=async e=>{var o;if(!U){N(!0);const n=await Q(),r=(o=n==null?void 0:n.list)==null?void 0:o.map(({uuid:_,province:T,...ne})=>({...ne,province:(T==null?void 0:T.name_th)||""})),l=$.filter(_=>_.id!=="uuid"),O=b.json_to_sheet(r,{header:l.map(_=>_.id)}),x=b.book_new();b.book_append_sheet(x,O,"Sheet1");const ee=l.map(_=>_.displayName);b.sheet_add_aoa(O,[ee],{origin:"A1"});const te=Se(x,{bookType:"xlsx",type:"array"}),se=new Blob([te],{type:"application/octet-stream"}),d=document.createElement("a"),oe=URL.createObjectURL(se);d.setAttribute("href",oe),d.setAttribute("download",e+".xlsx"),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),N(!1)}};return i("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[U&&s(fe,{}),i("div",{className:"invoice-table ",children:[i("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:[i("div",{className:"flex items-center gap-2",children:[i(le,{to:"/apps/shop/add",className:"btn btn-primary gap-2",children:[s(ge,{}),t("add_shop")]}),s("button",{type:"button",className:"btn btn-success gap-2",onClick:()=>{X()},children:t("toggle_create_customer")})]}),s("div",{className:"ml-auto",children:s(be,{initialValues:{id_province:"",query:""},onSubmit:e=>{var n;E(1);const o={page:1,page_size:p,id_province:((n=e==null?void 0:e.id_province)==null?void 0:n.value)||null,query:e.query};u({data:o}),Y({...o})},children:({setFieldValue:e,handleReset:o,values:n})=>s(ye,{children:s("div",{className:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4 w-full sm:w-auto",children:i("div",{className:"flex flex-row gap-3",style:{zIndex:9999},children:[(A==="admin"||A==="business_unit")&&s(Te,{id:"id_province",name:"id_province",value:n.id_province,placeholder:t("province"),className:"z-10 w-[200px] dropdown-custom",options:G,isSearchable:!0,onChange:r=>{e("id_province",r)}}),s("div",{className:"relative",children:s("input",{type:"text",id:"query",name:"query",placeholder:t("search_text"),className:"form-input py-2 ltr:pr-11 rtl:pl-11 peer",value:n.query,onChange:r=>{e("query",r.target.value)}})}),s("div",{className:"flex-1",children:i("button",{type:"submit",className:"btn btn-primary w-[100px] gap-2",children:["  ",t("search"),"     "]})}),s("button",{type:"reset",className:"btn btn-info gap-2 w-[100px]",onClick:()=>{location.reload()},children:t("clear")}),(A==="admin"||A==="business_unit")&&s("button",{type:"button",className:"btn btn-success gap-2 w-[100px]",onClick:()=>{J(`contract_${new Date().toLocaleString()}`)},children:"Export"})]})})})})})]}),s("div",{className:"datatables pagination-padding",children:s(ue,{className:"whitespace-nowrap table-hover invoice-table",records:P,columns:[{accessor:"index",title:t("order"),textAlignment:"center",render:(e,o)=>o+1+(h-1)*p},{accessor:"name",title:t("shop_name"),textAlignment:"left",sortable:!1,render:e=>s("div",{className:"flex items-center font-normal",children:s("a",{className:"flex cursor-pointer active",onClick:()=>D(e),children:e.name})})},{accessor:"phone_number",title:t("shop_phone_number"),textAlignment:"left",sortable:!1,render:({phone_number:e})=>me(e)??"-"},{accessor:"line_id",title:"Line ID",textAlignment:"left",sortable:!1,render:({line_id:e})=>e||"-"},{accessor:"tax_id",title:t("tax_id"),textAlignment:"left",sortable:!1,render:({tax_id:e})=>he(e)??"-"},{accessor:"province",title:t("address"),textAlignment:"left",sortable:!1,render:({province:e})=>(e==null?void 0:e.name_th)||"-"},{accessor:"is_active",title:t("create_customer"),textAlignment:"center",sortable:!1,render:({is_create_customer:e})=>i("span",{className:`badge ${e?"badge-outline-success":"badge-outline-danger"}`,children:[t(e?"create_customer_open":"create_customer_close"),"       // 新 key"]})},{accessor:"action",title:t("actions"),sortable:!1,textAlignment:"center",render:e=>i("div",{className:"flex gap-4 items-center w-max mx-auto",children:[s(w,{content:t("view_data"),theme:"Primary",children:s("a",{className:"flex cursor-pointer active",onClick:()=>D(e),children:s(Ae,{})})}),s(w,{content:t("reward_report"),theme:"Primary",children:s("a",{className:"flex cursor-pointer active",onClick:()=>z(e),children:s(ce,{})})})]})}],highlightOnHover:!0,page:h,totalRecords:K,recordsPerPage:p,recordsPerPageOptions:j,onPageChange:e=>E(e),onRecordsPerPageChange:e=>{E(1),B(e)},paginationText:({from:e,to:o,totalRecords:n})=>`${t("showing")} ${e} ${t("to")} ${o} ${t("of")} ${n} ${t("total_pages")}`,selectedRecords:f,onSelectedRecordsChange:v})})]})]})};export{Ve as default};
