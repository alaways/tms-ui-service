import{a as G,u as V,ar as K,r as a,an as B,c as f,s as W,f as s,F as Y,j as t,L as F,t as S,g as I}from"./index-a90aa29c.js";import{S as d}from"./sweetalert2.all-ca2d1030.js";import{n as Q}from"./formatNumeric-862380d6.js";const X="admin",$=()=>{const h=G(),r=V();K(),localStorage.getItem(X);const[R,u]=a.useState(!0),[v,C]=a.useState(""),[p,P]=a.useState(""),[c,D]=a.useState(""),[m,U]=a.useState({}),[N,O]=a.useState(""),[L,M]=a.useState(""),{id:_}=B(),x="https://dev-tms-admin.gsrental.cn:7443/api/v1",A=()=>{d.fire({title:"ขออภัย!",text:"สร้าง QR Code ไม่สำเร็จ กรุณากด สร้าง QRCode ใหม่อีกครั้ง",icon:"warning",showCancelButton:!0,confirmButtonColor:S.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",reverseButtons:!0}).then(e=>{e.isConfirmed})},{mutate:k,isLoading:q}=f(I.customerGetPaymentClose,{onSuccess:e=>{var o,n,l,y,E,g,T,b;e.data.payment.status==="complete"&&r("/apps/customer-payment/success",{state:{id:_}}),O((l=(n=(o=e.data.installment)==null?void 0:o.contract)==null?void 0:n.business_unit)==null?void 0:l.line_id),M((y=e.data.payment)==null?void 0:y.amount),(g=(E=e==null?void 0:e.data)==null?void 0:E.payment_qr)!=null&&g.image&&(D(e.data.payment_qr.image),P(e.data.payment_qr.expiredate),C(e.data.payment_qr.referenceNo),u(!1)),((b=(T=e==null?void 0:e.data)==null?void 0:T.payment_qr)==null?void 0:b.image)==""&&A()},onError:()=>{console.error("Failed to fetch asset type data")}});a.useEffect(()=>{h(W("ชำระเงิน (Payment)")),(async()=>{try{k({data:{id_contract:_}})}catch{A()}})()},[h]),a.useEffect(()=>{if(!p)return;const e=()=>{const n=+new Date(p)-+new Date;let l={};return n>0&&(l={days:Math.floor(n/(1e3*60*60*24)),hours:Math.floor(n/(1e3*60*60)%24),minutes:Math.floor(n/1e3/60%60),seconds:Math.floor(n/1e3%60)}),l},o=setInterval(()=>{U(e())},1e3);return()=>clearInterval(o)},[p]);const{mutate:H}=f(I.paymentCheckStatus,{onSuccess:e=>{var o,n;e.statusCode===400||e.code===400?d.fire({icon:"error",title:"ยกเลิกชำระเงิน",padding:"10px 20px"}).then(()=>{r("/apps/customer-payment/list")}):((o=e.data)==null?void 0:o.status)=="cancel"?d.fire({icon:"error",title:"ยกเลิกชำระเงิน",padding:"10px 20px"}).then(()=>{r("/apps/customer-payment/list")}):((n=e.data)==null?void 0:n.status)=="complete"&&d.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px"}).then(()=>{r("/apps/customer-payment/list")})},onError:e=>{u(!1)}});a.useEffect(()=>{const e=setInterval(async()=>{try{H({data:{id_contract:_,type:"close_contract"}})}catch(o){console.error("Error checking payment status:",o)}},1e4);return()=>clearInterval(e)},[x,v,r]);const j=()=>{const e=document.createElement("a");e.href=c,e.download="qr_code.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)},w=async()=>{try{window.location.reload()}catch(e){window.location.reload(),console.error("Error regenerating QR code:",e)}},i=[];return Object.keys(m).forEach(e=>{m[e]&&i.push(s("span",{children:[m[e]," ",e," "]},e))}),s(Y,{children:[s("ul",{className:"flex space-x-2 rtl:space-x-reverse",children:[t("li",{children:t(F,{to:"/apps/customer-payment/list",className:"text-primary hover:underline",children:"หน้าหลัก"})}),t("li",{className:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2",children:t("span",{children:"ชำระเงิน (Payment)"})})]}),t("div",{className:"py-10 animate__animated",children:s("div",{className:"panel !px-0",children:[s("div",{className:"flex justify-between flex-wrap gap-4 px-4",children:[t("div",{className:"text-2xl font-semibold uppercase",children:"ชำระเงิน (Payment)"}),t("div",{className:"shrink-0",children:t("img",{src:S.logo.CustomerLogo,alt:"img",className:"w-36 ltr:ml-auto rtl:mr-auto"})})]}),t("div",{className:"ltr:text-left rtl:text-left px-4",children:t("div",{className:"space-y-1 mt-6 text-white-dark"})}),t("div",{className:"my-4"}),s("div",{className:"flex justify-between font-bold text-[22px] mt-4",children:[t("div",{className:"p-6 text-[22px] font-bold dark:border-dark dark:text-white",children:"ยอดที่ต้องชำระ"}),t("div",{className:"p-6 text-[22px] font-bold dark:border-dark dark:text-white",children:s("div",{children:[Q(L)," บาท"]})})]}),s("div",{className:"p-6",children:[R?t("div",{className:"flex justify-center items-center h-full",children:t("span",{className:"animate-spin border-8 border-[#f1f2f3] border-l-primary border-r-primary rounded-full w-14 h-14 inline-block align-middle"})}):t("div",{className:"border-b border-[#ebedf2] dark:border-[#1b2e4b]",children:t("div",{className:"my-4",children:c&&i.length?t("img",{src:c,alt:"QR Code",className:"w-full max-w-xs mx-auto"}):t("div",{children:p})})}),c&&i.length&&t("div",{className:"text-center",children:t("button",{className:"bg-blue-600 text-white py-2 px-4 rounded",onClick:j,children:"บันทึกรูป"})}),t("br",{}),s("div",{className:"text-center",children:[t("div",{className:"py-2",children:"เวลานับถอยหลัง"}),t("div",{children:i.length?i:t("button",{className:"bg-blue-600 text-white py-2 px-4 rounded",onClick:w,children:"สร้าง QR Code ใหม่"})})]}),s("div",{className:"mt-6",children:[t("div",{className:"text-lg font-bold mb-2",children:"ขั้นตอนดำเนินการ"}),s("ol",{className:"list-decimal list-inside text-white-dark text-sm",children:[t("li",{children:'บันทึกรูป QR Code โดยกดปุ่ม "บันทึกรูป"'}),t("li",{children:"เปิดแอปธนาคาร และเลือกวิธีสแกน QR Code"}),t("li",{children:"เปิดรูปที่บันทึกไว้ และสแกน ตกลง เพื่อยืนยันการชำระ"}),t("li",{children:"เมื่อชำระผ่านแอปธนาคารแล้ว กลับมาหน้านี้ และอัปเดต"}),t("li",{children:"เมื่อระบบยืนยันการชำระเรียบร้อยแล้ว จะขึ้นว่า ยืนยันการชำระเรียบร้อย"}),s("li",{children:["หากมีปัญหาการชำระเงิน สามารถติดต่อเจ้าหน้าที่ Line: ",N]})]})]})]})]})})]})};export{$ as default};
