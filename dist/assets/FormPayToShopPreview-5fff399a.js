import{an as G,ao as V,u as B,r as i,c as g,f as s,F as f,j as e,m as K,q as W,g as y}from"./index-a90aa29c.js";import{F as Y,a as q,c as $,u as X,E as z}from"./formik.esm-c4fd04ca.js";import{I as l}from"./InputField-d7971719.js";import{S as J}from"./SelectField-917481a8.js";import{S as Z}from"./sweetalert2.all-ca2d1030.js";import{c as A,a as v,f as Q}from"./object-7405de1d.js";import{S as ee}from"./react-select.esm-b46d9623.js";import{r as te}from"./helpFunction-19eb552d.js";import{_ as ae}from"./index-f89ea186.js";import{t as se}from"./constant-e85f1578.js";import{c as re}from"./formatDate-4e046265.js";import{B as ne}from"./breadcrumbs-b9914bbc.js";import{P as oe}from"./preLoading-b2445d9d.js";import{F as ie}from"./DatePickerTime-6f9990ef.js";import"./lodash-f7ec5310.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./flatpickr-2301360e.js";const le=[{to:"/apps/report/account-creditor",label:"บัญชีเจ้าหนี้ร้านค้า"},{label:"ชำระเงินให้ร้านค้า",isCurrent:!0}],pe="admin",Me=()=>{const E=Z.mixin(se),{id:S}=G(),[c,me]=V(),T=c.get("id_shop");c.get("start_at"),c.get("end_at"),B();const h=localStorage.getItem(pe),I=h?JSON.parse(h).name:null,[P,ce]=i.useState(!1),[D,de]=i.useState(!1),[N,b]=i.useState([]),[R,x]=i.useState({shop_name:"",bank_account_number:null,admin_name:I,created_at:re([new Date]),remark:"",amount:"",payed_at:null,reference:"",payment_type:""}),[C,U]=i.useState([]),k=A().shape({bank_account_number:A().nullable().shape({value:v().required("กรุณาใส่ข้อมูลให้ครบ")}).required("กรุณาใส่ข้อมูลให้ครบ"),amount:v().required("กรุณาใส่ข้อมูลให้ครบ"),payed_at:Q().nullable().required("กรุณาใส่ข้อมูลให้ครบ")}),O=({field:t,form:a,options:n,className:d,disabled:o})=>{const[_,p]=X(t.name),m=p.touched&&p.error,u=r=>{const F=r?r.value:"";a.setFieldValue(t.name,F)};return s("div",{className:"flex flex-col w-full",children:[e(ee,{options:n,value:n.find(r=>r.value===t.value)||null,onChange:u,components:{DropdownIndicator:o?()=>null:W},placeholder:"เลือกธนาคาร",isSearchable:!1,className:`w-full ${d} ${o?"form-select bg-[#eee] !text-black":null}`,classNames:{control:({isFocused:r})=>`${r?"!border-blue-500":null} ${m?"!border-red-500":"border"}   !rounded-xl shadow-sm p-4 w-full !cursor-pointer`,menu:()=>"bg-white border rounded-lg shadow-md mt-1 !cursor-pointer",option:({isFocused:r})=>r?"bg-gray-100 p-2 !cursor-pointer":"p-2 !cursor-pointer"}}),e(z,{name:t.name,component:"div",className:"text-red-500 text-sm mt-1"})]})},{mutate:M}=g(y.shopPaymentPreview,{onSuccess:t=>(x(t.data),b(t.data.slip),t),onError:()=>{}}),{mutate:w}=g(y.shopPaymentPayload,{onSuccess:t=>{if(t.code==200&&t.statusCode==200){const a=t.data.banks.map(n=>{const o=n.name.split(" -"),_=o[0].trim(),p=o[1].trim().split(" ")[0],m=o[1].trim().split(" (")[1].replace(")","");return{value:n.name,label:s("div",{className:"flex items-center gap-10",children:[s("div",{className:"",children:[e("p",{children:"ธนาคาร"}),e("p",{className:"text-gray-800 font-medium",children:_})]}),s("div",{children:[e("p",{children:"เลขที่บัญชี"}),e("p",{className:"text-sm text-gray-800",children:p})]}),s("div",{children:[e("p",{children:"ชื่อบัญชี"}),e("p",{className:"text-sm text-gray-800",children:m})]})]})}});U(a)}},onError:t=>{}}),L=async(t,a)=>{const n=await te(t);b(n)},H=()=>{E.fire({icon:"error",title:"รูปภาพเกิน 10 รูป",padding:"10px 20px"})},j=async t=>{};return i.useEffect(()=>{w({data:{id_shop:T}}),M({data:{id_payment:S}})},[]),s(f,{children:[e(ne,{items:le}),(P||D)&&e(oe,{}),s("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:[e("h5",{className:"my-3 text-2xl font-semibold ltr:sm:text-left rtl:sm:text-right text-center flex flex-row justify-between",children:"แบบฟอร์มชำระเงินให้ร้านค้า"}),e(Y,{initialValues:R,onSubmit:j,validationSchema:k,enableReinitialize:!0,children:({setFieldValue:t})=>s(q,{className:"flex flex-col gap-4",children:[e("div",{className:"flex gap-4",children:e(l,{name:"shop_name",label:"ร้านค้า",disabled:!0})}),s("div",{className:"flex gap-4",children:[e(l,{name:"admin_name",label:"ผู้ดำเนินการ",disabled:!0}),e(l,{name:"created_at",label:"วันที่สร้าง",disabled:!0})]}),e("hr",{}),e("h5",{className:"text-lg font-semibold",children:"รับชำระเงิน"}),s("div",{className:"flex gap-4",children:[e(l,{name:"amount",label:"ยอดชำระเงิน",onKeyDown:a=>{!/[0-9]/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Tab"&&a.preventDefault()},disabled:!0}),e(J,{name:"payment_method",id:"payment_method",label:"ช่องทางการชำระเงิน",options:[{value:"cash",label:"เงินสด"},{value:"promptpay",label:"พร้อมเพย์"}],disabled:!0})]}),s("div",{className:"flex gap-4",children:[e(l,{name:"reference",label:"หมายเลขอ้างอิง",disabled:!0}),e(ie,{label:"วันที่และเวลาที่ชำระ",name:"payed_at",onChange:a=>{t("payed_at",K(a[0]).tz("Asia/Bangkok").format())},disabled:!0})]}),s("div",{className:"w-full flex gap-4 custom-select",children:[e($,{name:"bank_account_number",component:O,options:C,disabled:!0}),e("div",{className:"w-full"})]}),s("div",{className:"w-full flex gap-4",children:[e("div",{className:"w-full",children:e(l,{name:"remark",label:"หมายเหตุ",disabled:!0})}),e("div",{className:"w-full"})]}),s("div",{className:"flex flex-col gap-2",children:[e("p",{children:"หลักฐานการโอนเงิน"}),e(ae,{multiple:!0,value:N,onChange:L,onError:H,maxNumber:1,children:({imageList:a,onImageUpload:n,onImageRemoveAll:d,onImageUpdate:o,onImageRemove:_,isDragging:p,dragProps:m})=>e("div",{className:"relative",children:s("div",{className:`${a.length==0?"cursor-pointer":null} border min-h-[200px] bg-violet-100/40 rounded-xl  flex flex-col items-center justify-center gap-2`,onClick:a.length==0?n:void 0,...m,children:[a.length==0&&s(f,{children:[s("p",{children:[e("span",{className:"text-violet-500 font-semibold",children:"Click to Upload"})," or drug and drop"]}),e("p",{children:"SVG, PNG, JPG OR GIF"})]}),e("div",{className:"flex flex-wrap gap-4",children:a==null?void 0:a.map((u,r)=>e("div",{className:"relative",children:e("img",{src:u.image_url,alt:"img",className:"w-auto h-[180px]"})},r))})]})})})]})]})})]})]})};export{Me as default};
