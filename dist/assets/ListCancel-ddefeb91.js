import{a as oe,r as o,s as re,c as j,f as i,j as s,F as T,g as v}from"./index-a90aa29c.js";import{u as y,w as ie}from"./xlsx-9a117414.js";import{Q as pe}from"./index-2f30bf27.js";import{F as le,a as ce}from"./formik.esm-c4fd04ca.js";import{S}from"./react-select.esm-b46d9623.js";import{e as V}from"./constant-e85f1578.js";import{b as G,c as K}from"./formatDate-4e046265.js";import{I as _e}from"./IconOpenBook-4986b63e.js";import{P as de}from"./preLoading-b2445d9d.js";import{D as F}from"./DateRangeAntd-92e3cf4d.js";import{I as B}from"./IconChecks-e4ba7579.js";import"./floating-ui.dom-0aeb9e8a.js";import"./createSuper-98fcd92d.js";import"./buddhistEra-a2d9672b.js";import"./index-8d8bdff8.js";const W={start_at:"",end_at:"",query:"",status_code:"",stats_type:"",id_business_unit:"",contract_date:"",approved_at:""},ue="admin",fe=()=>{const I=oe();o.useEffect(()=>{I(re("รายการสัญญาที่ถูกยกเลิก"))},[I]);const[me,R]=o.useState(!1),[Y,q]=o.useState([]),[l,z]=o.useState([]),[C,X]=o.useState([]),P=[10,20,30,50,100],[d,u]=o.useState(1),[c,Z]=o.useState(P[0]),Q="https://dev-tms-admin.gsrental.cn:7443/api/v1",m=localStorage.getItem(ue),n=m?JSON.parse(m).role:null,$=m?JSON.parse(m).access_token:null,[J,ee]=o.useState(0),[D,U]=o.useState(!1),[f,N]=o.useState(W),{mutate:x,isLoading:se}=j(v.contractCancelFindAll,{onSuccess:e=>{X(e.data.list),ee(e.data.total)},onError:e=>{console.error(e)}}),h=(e,t)=>{N(r=>({...r,[t]:e}))},O=e=>{open("/apps/contract/"+e.id+"/"+e.uuid,"_blank")},{mutate:te}=j(v.contractFilter,{onSuccess:e=>{z(e.data.business_unit.map(t=>({value:t,label:t.name}))),q(e.data.status.slice(5,8).map(t=>({value:t,label:t.name,status_code:t.status_code,status_type:t.status_type})))},onError:()=>{console.error("Failed to fetch asset type data")}});o.useEffect(()=>{te({})},[]);const ae=async()=>{const e=new Headers;e.append("Content-Type","application/json"),e.append("Authorization",`Bearer ${$}`);const t=JSON.stringify({...f,page:1,page_size:999999,format:"excel"}),r={method:"POST",headers:e,body:t,redirect:"follow"};return fetch(Q+v.contractCancelFindAll,r).then(a=>a.json()).then(a=>a.data).catch(a=>[])},ne=async e=>{if(!D){U(!0);const t=await ae(),r=y.json_to_sheet(t,{header:V.map(_=>_.id)}),a=y.book_new();y.book_append_sheet(a,r,"Sheet1");const g=V.map(_=>_.displayName);y.sheet_add_aoa(r,[g],{origin:"A1"});const A=ie(a,{bookType:"xlsx",type:"array"}),b=new Blob([A],{type:"application/octet-stream"}),p=document.createElement("a"),E=URL.createObjectURL(b);p.setAttribute("href",E),p.setAttribute("download",e+".xlsx"),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),U(!1)}},L=(e,t,r)=>{var g,A,b,p,E,_,M,k,w,H;R(!0);const a={page:t,page_size:r,start_at:K(e.start_at),end_at:K(e.end_at),contract_date:e==null?void 0:e.contract_date[0],contract_end_date:e==null?void 0:e.contract_date[1],approved_at:e==null?void 0:e.approved_at[0],approved_end_at:e==null?void 0:e.approved_at[1],query:e.query,status_type:(A=(g=e==null?void 0:e.status_code)==null?void 0:g.value)!=null&&A.status_type?(p=(b=e==null?void 0:e.status_code)==null?void 0:b.value)==null?void 0:p.status_type:"contract",status_code:(_=(E=e==null?void 0:e.status_code)==null?void 0:E.value)!=null&&_.status_code?(k=(M=e==null?void 0:e.status_code)==null?void 0:M.value)==null?void 0:k.status_code:"",id_business_unit:((H=(w=e==null?void 0:e.id_business_unit)==null?void 0:w.value)==null?void 0:H.id)||""};x({data:a}),N(a)};return o.useEffect(()=>{x({data:{...f,page:d,page_size:c}})},[d,c]),i("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[(se||D)&&s(de,{}),i("div",{className:"invoice-table",children:[s("div",{className:"flex w-full mb-4.5 px-5 md:items-center md:flex-row flex-col gap-5",children:s(le,{initialValues:W,onSubmit:e=>{R(!0),u(1),L(e,1,c)},enableReinitialize:!0,children:({values:e,setFieldValue:t,resetForm:r})=>i(ce,{className:"flex flex-col flex-auto gap-2",children:[i("div",{className:"flex flex-col sm:flex-row md:flex-row gap-5",children:[i("div",{className:"flex-1",children:[s("label",{children:"หน่วยธุรกิจ"}),n==="business_unit"?s(S,{defaultValue:l.length===0?null:{label:l[0].label,value:l[0].value.id},value:l.length===0?null:{label:l[0].label,value:l[0].value.id},placeholder:"เลือก หน่วยธุรกิจ",className:"z-10 w-auto",options:l.map(a=>({label:a.label,value:a.value.id})),isDisabled:!0}):s(S,{value:e.id_business_unit,placeholder:"เลือก หน่วยธุรกิจ",className:"z-10 w-auto",options:l,isSearchable:!0,onChange:a=>{t("id_business_unit",a),h(a.value.id,"id_business_unit")}})]}),i("div",{className:"flex-1",children:[s("label",{children:"สถานะการยกเลิก"}),s(S,{value:e.status_code,placeholder:"เลือก สถานะ",className:"z-10 w-auto",options:Y,isSearchable:!0,onChange:a=>{t("status_code",a),h(a.value.status_code,"status_code"),h(a.value.status_type,"status_type")}})]})]}),i("div",{className:"flex flex-col sm:flex-row md:flex-row gap-5 pt-3",children:[s(F,{label:"วันที่ทำสัญญา",name:"contract_date"}),s(F,{label:"วันที่อนุมัติ",name:"approved_at"})]}),i("div",{className:"flex flex-col sm:flex-row md:flex-row gap-5",children:[i("div",{className:"flex-1",children:[s("label",{children:"ค้นหา"}),s("input",{type:"text",name:"query",className:"form-input",placeholder:"ค้นหา...",onChange:a=>{t("query",a.target.value),h(a.target.value,"query")}})]}),i("div",{className:"flex flex-col sm:flex-row md:flex-row gap-5 justify-center items-end",children:[s("button",{type:"submit",className:"btn btn-primary gap-2 w-[100px] h-[40px]",children:"ค้นหา"}),s("button",{type:"reset",className:"btn btn-info gap-2 w-[100px]",onClick:()=>{const a={start_at:"",end_at:"",query:"",status_code:"",stats_type:"",id_business_unit:"",contract_date:"",approved_at:""};u(1),L(a,1,c)},children:"ล้างค่า"}),(n==="admin"||n==="business_unit")&&s("button",{type:"button",className:"btn btn-success gap-2 w-[100px] h-[40px]",onClick:()=>{ne(`contract_${new Date().toLocaleString()}`)},children:"Export"})]})]})]})})}),s("div",{className:"datatables pagination-padding",children:C.length===0?s("div",{className:"my-10 text-center text-gray-500",children:"ไม่พบข้อมูล"}):s(pe,{className:"whitespace-nowrap table-hover invoice-table",records:C,columns:[{accessor:"index",title:"ลำดับ",textAlignment:"center",render:(e,t)=>t+1+(d-1)*c},{accessor:"id",title:"เลขสัญญา",textAlignment:"center",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s(T,{children:s("div",{className:"pointer flex items-center space-x-2 active",onClick:()=>O(e),children:s("span",{children:e.reference})})}):s(T,{children:s("div",{className:"flex items-center space-x-2",children:s("span",{children:e.reference})})})},{accessor:"business_unit",title:"หน่วยธุรกิจ",textAlignment:"left",sortable:!1,render:e=>{var t;return s("div",{className:"pointer",children:(t=e==null?void 0:e.business_unit)==null?void 0:t.name})}},{accessor:"shop",title:"ร้านค้า",textAlignment:"left",sortable:!1,render:e=>s("div",{children:e.shop.name})},{accessor:"contract_type",title:"ประเภทสัญญา",textAlignment:"left",sortable:!1,render:e=>{var t;return s("p",{children:(t=e==null?void 0:e.contract_type)==null?void 0:t.name})}},{accessor:"contract_date",title:"วันที่ทำสัญญา",textAlignment:"left",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s("p",{className:"pointer",children:G(e==null?void 0:e.contract_date)??"-"}):"-"},{accessor:"approved_at",title:"วันที่อนุมัติ",textAlignment:"left",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s("p",{className:"pointer",children:G(e==null?void 0:e.approved_at)??"-"}):"-"},{accessor:"customer",title:"ชื่อลูกค้า",textAlignment:"left",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s("p",{children:e.customer.name}):"-"},{accessor:"price",title:"ราคา",textAlignment:"right",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s("p",{children:e.price?e.price.toLocaleString("en-US"):"-"}):"-"},{accessor:"down_payment",title:"ชำระเงินดาวน์",textAlignment:"right",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s("p",{children:e.down_payment?e.down_payment.toLocaleString("en-US"):"-"}):"-"},{accessor:"principle",title:"ทุนเช่าซื้อ",textAlignment:"right",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s("p",{children:e.principle?e.principle.toLocaleString("en-US"):"-"}):"-"},{accessor:"ins_period",title:"จำนวนงวด",textAlignment:"center",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s("p",{children:(e==null?void 0:e.ins_period)??"-"}):"-"},{accessor:"customer_signature_at",title:"ลงนามออนไลน์",textAlignment:"center",sortable:!1,render:e=>n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop"?s("span",{className:`${e!=null&&e.customer_signature_at?"badge-outline-success":"badge-outline-danger"}`,children:e!=null&&e.customer_signature_at?s(B,{className:"w-6 h-6"}):""}):s(T,{})},{accessor:"e_contract_status",title:"ลงนาม Ekyc",textAlignment:"center",sortable:!1,render:e=>s("span",{className:`${e!=null&&e.e_contract_status?"badge-outline-success":"badge-outline-danger"}`,children:e!=null&&e.e_contract_status?s(B,{className:"w-6 h-6"}):""})},{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:e=>(n=="shop"&&(e==null?void 0:e.is_view)==1||n!="shop")&&s("div",{className:"flex gap-4 items-center w-max mx-auto",children:s("a",{className:"flex cursor-pointer active",onClick:()=>O(e),children:s(_e,{})})})}],page:d,totalRecords:J,recordsPerPage:c,onPageChange:e=>u(e),recordsPerPageOptions:P,onRecordsPerPageChange:e=>{u(1),Z(e)},highlightOnHover:!0,paginationText:({from:e,to:t,totalRecords:r})=>`โชว์ ${e} ถึง ${t} ของ ${r} หน้าทั้งหมด`})})]})]})};export{fe as default};
