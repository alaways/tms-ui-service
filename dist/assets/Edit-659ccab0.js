import{ak as oe,an as de,u as ce,a as me,r as u,s as pe,b as _e,i as z,au as ue,av as he,f as r,j as t,F as ge}from"./index-a90aa29c.js";import{c as fe,a as v,b as be}from"./object-7405de1d.js";import{S as ve}from"./sweetalert2.all-ca2d1030.js";import{_ as O}from"./index-f89ea186.js";import{a as M}from"./helpFunction-19eb552d.js";import{F as ye,a as Ae}from"./formik.esm-c4fd04ca.js";import{I as h}from"./InputField-d7971719.js";import{S as N}from"./SelectField-917481a8.js";import{t as Ee,v as Ie}from"./constant-e85f1578.js";import{a as Se}from"./useUploadMutation-785f6dd6.js";import{u as Te,a as Ne}from"./useProvincesMutation-f0b4cb29.js";import{B as Ue}from"./breadcrumbs-b9914bbc.js";/* empty css              */import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";const Ce="admin",Ze=()=>{const{t:s}=oe(),{id:k}=de(),w=ve.mixin(Ee),X=ce(),U=me(),Z=[{to:"/apps/business-unit/list",label:s("business_unit")},{to:"/apps/business-unit/preview/"+k,label:s("business_unit_info")},{label:s("edit"),isCurrent:!0}];u.useEffect(()=>{U(pe(s("edit_business_unit"))),U(_e(["bu","/apps/business-unit/list"]))},[U]);const H=z(i=>i.dataStore.businessUnits),Q=z(i=>i.dataStore.provinces),[J,C]=u.useState([]),[ee,j]=u.useState([]),[y,R]=u.useState([]),[A,x]=u.useState([]),[E,D]=u.useState([]),q=localStorage.getItem(Ce),F=q?JSON.parse(q).role:null;F!=="admin"&&F!=="business_unit"&&X("/");const[B,te]=u.useState({name:"",tax_id:"",phone:"",address:"",id_province:"",id_district:"",id_subdistrict:"",email:"",line_id:"",website:"",zip_code:"",has_vat:"",contract_email:""}),ie=fe().shape({name:v().required(s("required_field")),tax_id:v().required(s("required_field")),phone:v().required(s("required_field")),address:v().required(s("required_field")),id_province:v().nullable().required(s("required_field")),id_district:v().nullable().required(s("required_field")),id_subdistrict:v().nullable().required(s("required_field")),has_vat:be().required(s("required_field")),email:v().email(s("invalid_email")).required(s("required_field"))}),{mutate:ae,isLoading:Re}=ue({async onSuccess(i){var l,o,d;const e={...B,...i.data};if(G({id:e==null?void 0:e.id_province,type:"id_province"}),V({id:e==null?void 0:e.id_district,type:"id_district"}),e!=null&&e.logo_image_url&&R([{dataURL:e.logo_image_url}]),e!=null&&e.qr_code_image_url&&x([{dataURL:e.qr_code_image_url}]),e!=null&&e.signature&&D([{dataURL:e.signature}]),((l=e.tax_id)==null?void 0:l.length)==13){var a=e.tax_id.replace(/(\d{1})(\d{4})(\d{5})(\d{3})/,"$1-$2-$3-$4");e.tax_id=a}if(((o=e.phone)==null?void 0:o.length)==9){var n=e.phone.replace(/(\d{2})(\d{3})(\d{4})/,"$1-$2-$3");e.phone=n}if(((d=e.phone)==null?void 0:d.length)==10){var n=e.phone.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3");e.phone=n}te(e)},onError(i){}}),{mutate:$,isLoading:P}=he({onSuccess:async(i,e)=>{i.statusCode===200||i.code===200?w.fire({icon:"success",title:s("save_success"),padding:"10px 20px"}):w.fire({icon:"error",title:i.message,padding:"10px 20px"})},onError:i=>{}}),{mutate:G}=Te({onSuccess:(i,e)=>{const a=i.data.map(n=>({value:n.id,label:n.name_th}));e.type==="id_province"&&j(a)},onError:i=>{}}),{mutate:V}=Ne({onSuccess:(i,e)=>{const a=i.data.map(n=>({value:n.id,label:n.name_th,zipCode:n.zip_code}));e.type==="id_district"&&C(a)},onError:i=>{}}),{mutateAsync:I}=Se({onSuccess:i=>{},onError:i=>{}}),S=(i,e,a)=>{const n=(o,d)=>{o.forEach(_=>i.setFieldValue(_,null)),d.forEach(_=>_([]))},l={id_province:()=>{G({id:e.value,type:a}),n(["id_district","id_subdistrict"],[j,C])},id_district:()=>{V({id:e.value,type:a}),n(["id_subdistrict"],[C])},id_subdistrict:()=>{i.setFieldValue("zip_code",parseInt(e.zipCode))}};l[a]&&l[a]()},se=async(i,e)=>{const a=await M(i,150);a.length>0&&R(a)},ne=async(i,e)=>{const a=await M(i,150);a.length>0&&x(a)},re=async(i,e)=>{const a=await M(i,150);a.length>0&&D(a)};u.useEffect(()=>{ae({data:{id:k||H.id}})},[H.id]);const le=u.useCallback(async i=>{var e,a,n,l,o,d,_,g,f,K,W,Y;if(!P){const b=[];(e=y[0])!=null&&e.file?b.push(I({data:{file:y[0].file,type:"business_unit"}})):b.push(Promise.resolve({})),(a=A[0])!=null&&a.file?b.push(I({data:{file:A[0].file,type:"business_unit"}})):b.push(Promise.resolve({})),(n=E[0])!=null&&n.file?b.push(I({data:{file:E[0].file,type:"business_unit"}})):b.push(Promise.resolve({}));let c,m,p;if(b.length>0){const L=await Promise.all(b);c=L[0],m=L[1],p=L[2]}let T={data:{...i,is_active:!0,...((l=c==null?void 0:c.data)==null?void 0:l.file_name)&&{logo_image_url:((o=c==null?void 0:c.data)==null?void 0:o.file_name)??""},...((d=m==null?void 0:m.data)==null?void 0:d.file_name)&&{qr_code_image_url:((_=m==null?void 0:m.data)==null?void 0:_.file_name)??""},...((g=p==null?void 0:p.data)==null?void 0:g.file_name)&&{signature:((f=p==null?void 0:p.data)==null?void 0:f.file_name)??""},phone:i.phone.replaceAll("-",""),tax_id:i.tax_id.replaceAll("-","")}};((K=c==null?void 0:c.data)==null?void 0:K.file_name)===void 0&&delete T.data.logo_image_url,((W=m==null?void 0:m.data)==null?void 0:W.file_name)===void 0&&delete T.data.qr_code_image_url,((Y=p==null?void 0:p.data)==null?void 0:Y.file_name)===void 0&&delete T.data.signature,$(T)}},[$,y,A,E,P,I]);return r("div",{className:"pt-1",children:[t(Ue,{items:Z}),t("div",{className:"grid pt-5 lg:grid-cols gap-6 mb-6",children:t("div",{className:"h-full",children:t("div",{className:"flex xl:flex-row flex-col gap-2.5",children:t("div",{className:"panel px-6 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6",children:t(ye,{initialValues:B,onSubmit:le,enableReinitialize:!0,autoComplete:"off",validationSchema:ie,children:i=>t(Ae,{className:"space-y-5 dark:text-white custom-select",children:r(ge,{children:[t("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"หน่วยธุรกิจ"}),t("div",{className:"input-flex-row",children:t(h,{require:!0,label:"เลขประจำตัวผู้เสียภาษี",name:"tax_id",type:"text",placeholder:"กรุณาใส่ข้อมูล",onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},onClick:e=>{var a;((a=i.values.tax_id)==null?void 0:a.length)===16&&i.setFieldValue("tax_id",i.values.tax_id.replaceAll("-",""))},onBlur:e=>{var n;if(((n=i.values.tax_id)==null?void 0:n.length)==13){var a=i.values.tax_id.replace(/(\d{1})(\d{4})(\d{5})(\d{3})/,"$1-$2-$3-$4");i.setFieldValue("tax_id",a)}},maxLength:13})}),r("div",{className:"input-flex-row",children:[t(h,{require:!0,label:s("business_name"),name:"name",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),t(h,{require:!0,label:s("phone_number"),name:"phone",type:"text",placeholder:"กรุณาใส่ข้อมูล",maxLength:10,onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},onClick:e=>{var a,n,l;(((a=i.values.phone)==null?void 0:a.length)==11||((n=i.values.phone)==null?void 0:n.length)==12)&&i.setFieldValue("phone",(l=i.values.phone)==null?void 0:l.replaceAll("-",""))},onBlur:e=>{var n,l;if(((n=i.values.phone)==null?void 0:n.length)==9){var a=i.values.phone.replace(/(\d{2})(\d{3})(\d{4})/,"$1-$2-$3");i.setFieldValue("phone",a)}if(((l=i.values.phone)==null?void 0:l.length)==10){var a=i.values.phone.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3");i.setFieldValue("phone",a)}}})]}),r("div",{className:"input-flex-row",children:[t(h,{label:s("email"),name:"email",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),t(h,{label:s("contract_email"),name:"contract_email",type:"text",placeholder:"กรุณาใส่ข้อมูล"})]}),r("div",{className:"input-flex-row",children:[t(h,{label:s("website"),name:"website",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),t(h,{require:!0,label:s("address"),name:"address",as:"textarea",rows:"1"})]}),r("div",{className:"input-flex-row",children:[t(N,{require:!0,label:s("province"),id:"id_province",name:"id_province",options:Q,placeholder:"กรุณาเลือก",onChange:e=>S(i,e,"id_province"),isSearchable:!0}),t(N,{require:!0,label:s("district"),id:"id_district",name:"id_district",options:ee,placeholder:"กรุณาเลือก",onChange:e=>S(i,e,"id_district"),isSearchable:!0})]}),r("div",{className:"input-flex-row",children:[t(N,{require:!0,label:s("subdistrict"),id:"id_subdistrict",name:"id_subdistrict",options:J,placeholder:"กรุณาเลือก",onChange:e=>S(i,e,"id_subdistrict"),isSearchable:!0}),t(h,{label:s("zip_code"),name:"zip_code",type:"text",readOnly:!0})]}),r("div",{className:"input-flex-row",children:[t(h,{label:s("line_id"),name:"line_id",type:"text"}),t(N,{require:!0,label:s("has_vat"),id:"has_vat",name:"has_vat",placeholder:"กรุณาเลือก",options:Ie,onChange:e=>{S(i,e,"has_vat")}})]}),r("div",{className:"input-flex-row",children:[t("div",{className:"input-container",children:r("div",{className:"custom-file-container","data-upload-id":"myFirstImage",children:[r("div",{className:"label-container",children:["Line QR code",t("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>{x([])},children:"×"})]}),t("label",{className:"custom-file-container__custom-file hidden"}),t("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input hidden",accept:"image/*"}),t("input",{type:"hidden",name:"MAX_FILE_SIZE1",value:"10485760"}),t("br",{}),t(O,{value:A,onChange:ne,children:({imageList:e,onImageUpload:a,onImageRemoveAll:n,onImageUpdate:l,onImageRemove:o,isDragging:d,dragProps:_})=>r("div",{className:"upload__image-wrapper",children:[t("button",{className:"custom-file-container__custom-file__custom-file-control",onClick:a,type:"button",children:"เลือกไฟล์..."})," ",e.map((g,f)=>t("div",{className:"custom-file-container__image-preview relative",children:t("img",{src:g.dataURL,alt:"img",className:"m-auto mt-5"})},f))]})})]})}),t("div",{className:"flex-1 upload-container",children:r("div",{className:"custom-file-container","data-upload-id":"myFirstImage",children:[r("div",{className:"label-container",children:["LOGO",t("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>{R([])},children:"×"})]}),t("label",{className:"custom-file-container__custom-file hidden"}),t("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input hidden",accept:"image/*"}),t("input",{type:"hidden",name:"MAX_FILE_SIZE1",value:"10485760"}),t("br",{}),t(O,{value:y,onChange:se,children:({imageList:e,onImageUpload:a,onImageRemoveAll:n,onImageUpdate:l,onImageRemove:o,isDragging:d,dragProps:_})=>r("div",{className:"upload__image-wrapper",children:[t("button",{className:"custom-file-container__custom-file__custom-file-control",onClick:a,type:"button",children:"เลือกไฟล์..."})," ",e.map((g,f)=>t("div",{className:"custom-file-container__image-preview relative mt-5",children:t("img",{src:g.dataURL,alt:"img",className:"m-auto"})},f))]})})]})})]}),r("div",{className:"input-flex-row",children:[t("div",{className:"input-container",children:r("div",{className:"custom-file-container","data-upload-id":"myFirstImage",children:[r("div",{className:"label-container",children:["ลายเซ็นต์",t("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>{D([])},children:"×"})]}),t("label",{className:"custom-file-container__custom-file hidden"}),t("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input hidden",accept:"image/*"}),t("input",{type:"hidden",name:"MAX_FILE_SIZE1",value:"10485760"}),t("br",{}),t(O,{value:E,onChange:re,children:({imageList:e,onImageUpload:a,onImageRemoveAll:n,onImageUpdate:l,onImageRemove:o,isDragging:d,dragProps:_})=>r("div",{className:"upload__image-wrapper",children:[t("button",{className:"custom-file-container__custom-file__custom-file-control",onClick:a,type:"button",children:"เลือกไฟล์..."})," ",e.map((g,f)=>t("div",{className:"custom-file-container__image-preview relative",children:t("img",{src:g.dataURL,alt:"img",className:"m-auto mt-5"})},f))]})})]})}),t("div",{className:"input-container"})]}),r("button",{type:"submit",className:"btn !mt-6 w-full border-0 btn-primary",children:[P&&t("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-5 h-5 ltr:mr-4 rtl:ml-4 inline-block align-middle"}),s("save")]})]})})})})})})})]})};export{Ze as default};
