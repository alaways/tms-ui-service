import{ak as H,u as W,a as J,r as m,s as Y,b as ee,i as ae,c as te,f as l,F as U,j as e,g as ie}from"./index-a90aa29c.js";import{c as se,a as h,b as le}from"./object-7405de1d.js";import{S as ne}from"./sweetalert2.all-ca2d1030.js";import{_ as F}from"./index-f89ea186.js";import{a as L}from"./helpFunction-19eb552d.js";import{F as re,a as ce}from"./formik.esm-c4fd04ca.js";import{I as d}from"./InputField-d7971719.js";import{S as y}from"./SelectField-917481a8.js";import{t as oe,v as de}from"./constant-e85f1578.js";import{a as me}from"./useUploadMutation-785f6dd6.js";import{u as ue,a as pe}from"./useProvincesMutation-f0b4cb29.js";import{B as he}from"./breadcrumbs-b9914bbc.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";const $e=()=>{const{t:I}=H(),S=ne.mixin(oe),P=W(),q=J(),$=[{to:"/apps/business-unit/list",label:I("business_unit")},{label:I("add"),isCurrent:!0}];m.useEffect(()=>{q(Y(I("add_business_unit"))),q(ee(["bu","/apps/business-unit/list"]))});const[R,_e]=m.useState({id:"",name:"",tax_id:"",phone:"",address:"",email:"",line_id:"",website:"",id_province:"",id_district:"",id_subdistrict:"",zip_code:"",has_vat:"",is_active:!0,contract_email:""}),V=ae(a=>a.dataStore.provinces),[z,_]=m.useState([]),[M,B]=m.useState([]),[f,k]=m.useState([]),[g,E]=m.useState([]),[b,D]=m.useState([]),T=se().shape({name:h().required("กรุณาใส่ข้อมูลให้ครบ"),tax_id:h().required("กรุณาใส่ข้อมูลให้ครบ"),phone:h().required("กรุณาใส่ข้อมูลให้ครบ"),address:h().required("กรุณาใส่ข้อมูลให้ครบ"),id_province:h().nullable().required("กรุณาใส่ข้อมูลให้ครบ"),id_district:h().nullable().required("กรุณาใส่ข้อมูลให้ครบ"),id_subdistrict:h().nullable().required("กรุณาใส่ข้อมูลให้ครบ"),has_vat:le().required("กรุณาใส่ข้อมูลให้ครบ")}),{mutate:A,isLoading:C}=te(ie.businessUnitCreate,{onSuccess:async(a,t)=>{a.statusCode===200||a.code===200?(S.fire({icon:"success",title:"บันทึกสำเร็จ",padding:"10px 20px"}),P("/apps/business-unit/list")):S.fire({icon:"error",title:a.message,padding:"10px 20px"})},onError:a=>{S.fire({icon:"error",title:a.massage,padding:"10px 20px"})}}),{mutate:j}=ue({onSuccess:(a,t)=>{const i=a.data.map(s=>({value:s.id,label:s.name_th}));switch(t.type){case"id_province":B(i);break}},onError:a=>{}}),{mutate:Q}=pe({onSuccess:(a,t)=>{const i=a.data.map(s=>({value:s.id,label:s.name_th,zipCode:s.zip_code}));switch(t.type){case"id_district":_(i);break}},onError:a=>{}}),{mutateAsync:v}=me({onSuccess:a=>{},onError:a=>{}}),X=m.useCallback(async a=>{var t,i,s,r,u,p;if(!C){const n=[];(t=f[0])!=null&&t.file?n.push(v({data:{file:f[0].file,type:"business_unit"}})):n.push(Promise.resolve({})),(i=g[0])!=null&&i.file?n.push(v({data:{file:g[0].file,type:"business_unit"}})):n.push(Promise.resolve({})),(s=b[0])!=null&&s.file?n.push(v({data:{file:b[0].file,type:"business_unit"}})):n.push(Promise.resolve({}));let c,o,N;if(n.length>0){const w=await Promise.all(n);c=w[0],o=w[1],N=w[2]}let O={data:{...a,is_active:!0,logo_image_url:((r=c==null?void 0:c.data)==null?void 0:r.file_name)||"",qr_code_image_url:((u=o==null?void 0:o.data)==null?void 0:u.file_name)||"",signature:((p=N==null?void 0:N.data)==null?void 0:p.file_name)||"",phone:a.phone.replaceAll("-",""),tax_id:a.tax_id.replaceAll("-","")}};A(O)}},[A,f,g,b,C,v]),Z=async(a,t)=>{const i=await L(a,150);i.length>0&&k(i)},G=async(a,t)=>{const i=await L(a,150);i.length>0&&E(i)},K=async(a,t)=>{const i=await L(a,150);i.length>0&&D(i)},x=(a,t,i)=>{const s=(u,p)=>{u.forEach(n=>a.setFieldValue(n,null)),p.forEach(n=>n([]))},r={id_province:()=>{j({id:t.value,type:i}),s(["id_district","id_subdistrict"],[_,_])},id_district:()=>{Q({id:t.value,type:i}),s(["id_subdistrict"],[_])},id_subdistrict:()=>{a.setFieldValue("zip_code",parseInt(t.zipCode))}};r[i]&&r[i]()};return l(U,{children:[e(he,{items:$}),e("div",{className:"flex xl:flex-row flex-col gap-2.5 pt-5",children:e("div",{className:"panel px-6 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6",children:e(re,{initialValues:R,onSubmit:X,enableReinitialize:!0,autoComplete:"off",validationSchema:T,children:a=>e(ce,{className:"space-y-5 dark:text-white custom-select",children:l(U,{children:[e("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"หน่วยธุรกิจ"}),e("div",{className:"input-flex-row",children:e(d,{require:!0,label:"เลขประจำตัวผู้เสียภาษี",name:"tax_id",type:"text",placeholder:"กรุณาใส่ข้อมูล",onKeyPress:t=>{/[0-9]/.test(t.key)||t.preventDefault()},onClick:t=>{var i;((i=a.values.tax_id)==null?void 0:i.length)===16&&a.setFieldValue("tax_id",a.values.tax_id.replaceAll("-",""))},onBlur:t=>{var s;if(((s=a.values.tax_id)==null?void 0:s.length)==13){var i=a.values.tax_id.replace(/(\d{1})(\d{4})(\d{5})(\d{3})/,"$1-$2-$3-$4");a.setFieldValue("tax_id",i)}},maxLength:13})}),l("div",{className:"input-flex-row",children:[e(d,{require:!0,label:"ชื่อธุรกิจ",name:"name",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),e(d,{require:!0,label:"เบอร์โทรศัพท์",name:"phone",type:"text",placeholder:"กรุณาใส่ข้อมูล",maxLength:10,onKeyPress:t=>{/[0-9]/.test(t.key)||t.preventDefault()},onClick:t=>{var i,s,r;(((i=a.values.phone)==null?void 0:i.length)==11||((s=a.values.phone)==null?void 0:s.length)==12)&&a.setFieldValue("phone",(r=a.values.phone)==null?void 0:r.replaceAll("-",""))},onBlur:t=>{var s,r;if(((s=a.values.phone)==null?void 0:s.length)==9){var i=a.values.phone.replace(/(\d{2})(\d{3})(\d{4})/,"$1-$2-$3");a.setFieldValue("phone",i)}if(((r=a.values.phone)==null?void 0:r.length)==10){var i=a.values.phone.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3");a.setFieldValue("phone",i)}}})]}),l("div",{className:"input-flex-row",children:[e(d,{label:"Email",name:"email",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),e(d,{label:"Email รับสำเนา",name:"contract_email",type:"text",placeholder:"กรุณาใส่ข้อมูล"})]}),l("div",{className:"input-flex-row",children:[e(d,{label:"Website",name:"website",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),e(d,{require:!0,label:"ที่อยู่",name:"address",as:"textarea",rows:"1"})]}),l("div",{className:"input-flex-row",children:[e(y,{require:!0,label:"จังหวัด",id:"id_province",name:"id_province",placeholder:"กรุณาเลือก",options:V,onChange:t=>{x(a,t,"id_province")},isSearchable:!0}),e(y,{require:!0,label:"อำเภอ/เขต",id:"id_district",name:"id_district",placeholder:"กรุณาเลือก",options:M,onChange:t=>{x(a,t,"id_district")},isSearchable:!0})]}),l("div",{className:"input-flex-row",children:[e(y,{require:!0,label:"ตำบล/แขวง",id:"id_subdistrict",name:"id_subdistrict",placeholder:"กรุณาเลือก",options:z,onChange:t=>{x(a,t,"id_subdistrict")},isSearchable:!0}),e(d,{label:"รหัสไปรษณีย์",name:"zip_code",type:"text",disabled:!0})]}),l("div",{className:"input-flex-row",children:[e(d,{label:"LINE ID",name:"line_id",type:"text"}),e(y,{require:!0,label:"จดภาษีมูลค่าเพิ่ม (VAT)",id:"has_vat",name:"has_vat",placeholder:"กรุณาเลือก",options:de,onChange:t=>{x(a,t,"has_vat")}})]}),l("div",{className:"input-flex-row",children:[e("div",{className:"input-container",children:l("div",{className:"custom-file-container","data-upload-id":"myFirstImage",children:[l("div",{className:"label-container",children:["Line QR code",e("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>E([]),children:"×"})]}),e("label",{className:"custom-file-container__custom-file hidden"}),e("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input hidden",accept:"image/*"}),e("input",{type:"hidden",name:"MAX_FILE_SIZE1",value:"10485760"}),e("br",{}),e(F,{value:g,onChange:G,children:({imageList:t,onImageUpload:i,onImageRemoveAll:s,onImageUpdate:r,onImageRemove:u,isDragging:p,dragProps:n})=>l("div",{className:"upload__image-wrapper",children:[e("button",{type:"button",className:"custom-file-container__custom-file__custom-file-control",onClick:i,children:"เลือกไฟล์..."})," ",t.map((c,o)=>e("div",{className:"custom-file-container__image-preview relative",children:e("img",{className:"m-auto mt-10",alt:"img",src:c.dataURL})},o))]})})]})}),e("div",{className:"flex-1 upload-container",children:l("div",{className:"custom-file-container","data-upload-id":"myFirstImage",children:[l("div",{className:"label-container",children:["LOGO",e("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>k([]),children:"×"})]}),e("label",{className:"custom-file-container__custom-file hidden"}),e("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input hidden",accept:"image/*"}),e("input",{type:"hidden",name:"MAX_FILE_SIZE1",value:"10485760"}),e("br",{}),e(F,{value:f,onChange:Z,children:({imageList:t,onImageUpload:i,onImageRemoveAll:s,onImageUpdate:r,onImageRemove:u,isDragging:p,dragProps:n})=>l("div",{className:"upload__image-wrapper",children:[e("button",{type:"button",className:"custom-file-container__custom-file__custom-file-control",onClick:i,children:"เลือกไฟล์..."})," ",t.map((c,o)=>e("div",{className:"custom-file-container__image-preview relative",children:e("img",{className:"m-auto mt-10",alt:"img",src:c.dataURL})},o))]})})]})})]}),l("div",{className:"input-flex-row",children:[e("div",{className:"input-container",children:l("div",{className:"custom-file-container","data-upload-id":"myFirstImage",children:[l("div",{className:"label-container",children:["ลายเซ็นต์",e("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>{D([])},children:"×"})]}),e("label",{className:"custom-file-container__custom-file hidden"}),e("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input hidden",accept:"image/*"}),e("input",{type:"hidden",name:"MAX_FILE_SIZE1",value:"10485760"}),e("br",{}),e(F,{value:b,onChange:K,children:({imageList:t,onImageUpload:i,onImageRemoveAll:s,onImageUpdate:r,onImageRemove:u,isDragging:p,dragProps:n})=>l("div",{className:"upload__image-wrapper",children:[e("button",{className:"custom-file-container__custom-file__custom-file-control",onClick:i,type:"button",children:"เลือกไฟล์..."})," ",t.map((c,o)=>e("div",{className:"custom-file-container__image-preview relative",children:e("img",{src:c.dataURL,alt:"img",className:"m-auto mt-5"})},o))]})})]})}),e("div",{className:"input-container"})]}),l("button",{type:"submit",className:"btn !mt-6 w-full border-0 btn-primary",children:[C&&e("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-5 h-5 ltr:mr-4 rtl:ml-4 inline-block align-middle"}),"บันทึก"]})]})})})})})]})};export{$e as default};
