import{a as k,u as H,r as o,s as j,c as y,j as s,f as a,o as w,g as b}from"./index-a90aa29c.js";/* empty css              */const G="admin",Y=()=>{const h=k();H();const i=localStorage.getItem(G);i&&JSON.parse(i).role,i&&JSON.parse(i).id_shop,o.useEffect(()=>{h(j("การแจ้งเตือน"))},[h]);const[u,T]=o.useState([]),[V,g]=o.useState(0),[S,I]=o.useState(()=>{const e=localStorage.getItem("readNotifications");return e?JSON.parse(e):[]}),[p,N]=o.useState(10),[A,l]=o.useState(!1),[v,R]=o.useState(!0),{mutate:D}=y(b.readNotify,{onSuccess:e=>{I(t=>[...t,e.data.notificationId]),g(t=>t-1)},onError:e=>{console.error("Failed to mark notification as read:",e)}}),P=e=>{e!=null&&e.id&&!S.includes(e.id)&&D({id:e.id})},{mutate:C}=y(b.getNotify+"?all=1",{onSuccess:e=>{const t=e.data.sort((r,d)=>new Date(d.activity_at).getTime()-new Date(r.activity_at).getTime());T(t.slice(0,p)),R(p<t.length);const n=t.filter(r=>!r.read).length;g(n),l(!1)},onError:e=>{console.error(e),l(!1)}});o.useEffect(()=>{l(!0),C({})},[p]);const U=e=>{open("/apps/contract/"+e.contract_id+"/"+e.contract_uuid,"_blank")},M=e=>{const t=new Date;t.setHours(t.getHours()+7);const n=t.toISOString(),r=new Date(n),d=new Date(e),f=r.getTime()-d.getTime();if(f>0){const x=Math.floor(f/1e3),_=Math.floor(x/60),m=Math.floor(_/60),c=Math.floor(m/24),E=Math.floor(c/7),L=Math.floor(c/30);return _<60?`${_} นาทีที่ผ่านมา`:m<24?`${m} ชั่วโมงที่ผ่านมา`:c<7?`${c} วันที่ผ่านมา`:E<4?`${E} สัปดาห์ที่ผ่านมา`:`${L} เดือนที่ผ่านมา`}else return"1 นาทีที่ผ่านมา"},O=()=>{l(!0),N(e=>e+10)};return s("div",{children:s("div",{className:"panel px-0 ",children:a("div",{className:"mb-4.5 px-5 md:items-center md:flex-row flex-col gap-5",children:[a("div",{className:"notification-header px-5 py-4 flex items-center justify-between bg-themePrimary text-white",children:[s("h4",{className:"text-lg font-bold",children:"การแจ้งเตือน"}),s("div",{className:"notification-tabs flex gap-4"})]}),s("div",{className:"notification-content px-5 py-4",children:u.length>0?u.map(e=>{if(!(e!=null&&e.id))return null;const t=e.read,n=e.title.split(" ");return a("li",{className:`flex items-center px-4 py-3 border-b border-orange-500 ${t?"":"bg-gray-200 dark:bg-gray-800"}`,onClick:r=>{r.stopPropagation(),t||P(e),U(e)},children:[a("div",{className:"grid place-content-center rounded-full border-2 border-gray-300 w-[50px] h-[50px] relative",children:[s("img",{className:"w-[50%] h-[50%] object-cover mx-auto absolute inset-0 m-auto",alt:"profile",src:"/assets/images/iconDoc.png"}),!t&&s("span",{className:"bg-success w-[15%] h-[15%] rounded-full block absolute right-[6px] bottom-0"})]}),s("div",{className:"ml-3 flex-1",children:a("div",{className:"flex flex-col",children:[a("span",{children:[n[0]+" "+n[1]+" ",s("span",{className:"text-orange-500",children:n[2]})]}),s("span",{className:"text-xs blue font-normal active",children:M(e.activity_at)})]})})]},e.id)}):s("div",{className:"flex items-center justify-center py-8",children:a("div",{className:"flex flex-col items-center",children:[s(w,{fill:!0,className:"w-10 h-10 text-primary mb-4"}),s("p",{className:"text-lg text-center",children:"ไม่พบข้อมูล"})]})})}),s("div",{className:"flex justify-center mt-4 p-4",children:v&&s("button",{className:"btn btn-primary",onClick:O,disabled:A,children:A?"กำลังโหลด...":"ดูการแจ้งเตือนก่อนหน้า"})})]})})})};export{Y as default};
