import{ar as x,a as N,r as n,s as L,c as M,ay as k,f as c,j as t,g as H}from"./index-a90aa29c.js";import{Q as j}from"./index-2f30bf27.js";import{P as u}from"./config-8de56c22.js";import{b as d}from"./formatDate-4e046265.js";import{I as w}from"./IconOpenBook-4986b63e.js";import{P as G}from"./preLoading-b2445d9d.js";import"./floating-ui.dom-0aeb9e8a.js";const V="admin",X=()=>{const A=x(),r=new URLSearchParams(A.search).get("query"),_=N();n.useEffect(()=>{_(L("รายการสัญญา"))},[_]);const o=localStorage.getItem(V);o&&JSON.parse(o).role,o&&JSON.parse(o).access_token;const[m,b]=n.useState([]),[i,h]=n.useState(1),[E,S]=n.useState(1),[y,T]=n.useState(""),[a,P]=n.useState(u[0]),[f,v]=n.useState(0),[p,C]=n.useState([]),{mutate:I,isLoading:R}=M(H.contractSearch,{onSuccess:e=>{var s;b(e.data.list),v(e.data.total),U({data:{contract_list:(s=e.data)==null?void 0:s.ids}})},onError:()=>{console.error("Failed to fetch contract data")}}),{mutate:U}=k("/chat/check-unread",{onSuccess:e=>{C(e==null?void 0:e.data)}});n.useEffect(()=>{I({data:{query:r,page:E!==a||y!==r?1:i,page_size:a}}),S(a),T(r)},[i,a,r]);const g=e=>{open("/apps/contract/"+e.id+"/"+e.uuid,"_blank")},D=[{accessor:"index",title:"ลำดับ",textAlignment:"center",render:(e,s)=>t("p",{children:s+1+(i-1)*a})},{accessor:"credit",title:"สถานะดำเนินการ",textAlignment:"left",sortable:!1,render:e=>t("p",{children:e.credit.code})},{accessor:"id",title:"เลขสัญญา",textAlignment:"center",sortable:!1,render:e=>{var l;const s=(l=p==null?void 0:p.find(O=>O.id_contract===e.id))==null?void 0:l.unread;return c("div",{className:"pointer flex items-center space-x-2 active",onClick:()=>g(e),children:[t("span",{className:`w-3 h-3 rounded-full ${s>0?"bg-red-500":"bg-gray-300"}`}),t("span",{children:e.reference})]})}},{accessor:"business_unit",title:"หน่วยธุรกิจ",textAlignment:"left",sortable:!1,render:e=>{var s;return t("p",{className:"pointer",children:(s=e==null?void 0:e.business_unit)==null?void 0:s.name})}},{accessor:"shop",title:"ร้านค้า",textAlignment:"left",sortable:!1,render:e=>t("p",{children:e.shop.name})},{accessor:"contract_type",title:"ประเภทสัญญา",textAlignment:"left",sortable:!1,render:e=>{var s;return t("p",{children:(s=e==null?void 0:e.contract_type)==null?void 0:s.name})}},{accessor:"ins_due_at",title:"งวดแรกเริ่มเมื่อ",textAlignment:"left",sortable:!1,render:e=>t("p",{className:"pointer",children:d(e==null?void 0:e.ins_due_at)??"-"})},{accessor:"contract_date",title:"วันที่ทำสัญญา",textAlignment:"left",sortable:!1,render:e=>t("div",{children:t("p",{className:"pointer",children:d(e==null?void 0:e.contract_date)??"-"})})},{accessor:"approved_at",title:"วันที่อนุมัติ",textAlignment:"left",sortable:!1,render:e=>t("div",{children:t("p",{className:"pointer",children:d(e==null?void 0:e.approved_at)??"-"})})},{accessor:"customer",title:"ชื่อลูกค้า",textAlignment:"left",sortable:!1,render:e=>t("p",{children:e.customer.name})},{accessor:"ins_pay_day",title:"ชำระทุกวันที่",textAlignment:"center",sortable:!1,render:e=>t("p",{children:e.ins_pay_day})},{accessor:"ins_amount",title:"ค่างวด",textAlignment:"center",sortable:!1,render:({ins_amount:e})=>t("p",{children:e?e.toLocaleString("en-US"):"-"})},{accessor:"price",title:"ราคา",textAlignment:"right",sortable:!1,render:({price:e})=>t("p",{children:e?e.toLocaleString("en-US"):"-"})},{accessor:"down_payment",title:"ชำระเงินดาวน์",textAlignment:"right",sortable:!1,render:({down_payment:e})=>t("p",{children:e?e.toLocaleString("en-US"):"-"})},{accessor:"principle",title:"ทุนเช่าซื้อ",textAlignment:"right",sortable:!1,render:({principle:e})=>t("p",{children:e?e.toLocaleString("en-US"):"-"})},{accessor:"ins_period",title:"จำนวนงวด",textAlignment:"center",sortable:!1},{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:e=>t("div",{className:"flex gap-4 items-center w-max mx-auto",children:t("a",{className:"flex cursor-pointer active",onClick:()=>g(e),children:t(w,{})})})}].filter(Boolean);return c("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[R&&t(G,{}),c("div",{className:"invoice-table",children:[c("h2",{className:"text-center mb-12 text-3xl",children:[" ผลลัพท์การค้นหา : ",r]}),t("div",{className:"datatables pagination-padding",children:m.length===0?t("div",{className:"my-10 text-center text-gray-500",children:"ไม่พบข้อมูล"}):t(j,{className:"whitespace-nowrap table-hover invoice-table",records:m,columns:D,page:i,totalRecords:f,recordsPerPage:a,onPageChange:e=>h(e),recordsPerPageOptions:u,onRecordsPerPageChange:e=>{h(1),P(e)},highlightOnHover:!0,paginationText:({from:e,to:s,totalRecords:l})=>`โชว์ ${e} ถึง ${s} ของ ${l} หน้าทั้งหมด`})})]})]})};export{X as default};
