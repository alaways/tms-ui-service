import{an as H,r,c as k,f as a,j as t,v as j,g as w}from"./index-a90aa29c.js";import{Q as G}from"./index-2f30bf27.js";import{I as V}from"./IconOpenBook-4986b63e.js";import{b}from"./formatDate-4e046265.js";import{P as T}from"./config-8de56c22.js";import{l as B}from"./lodash-f7ec5310.js";import{B as K}from"./breadcrumbs-b9914bbc.js";import"./floating-ui.dom-0aeb9e8a.js";const f="admin",J=()=>{var y,S;const{id:p}=H(),o=localStorage.getItem(f),d=o?JSON.parse(o).id_business_unit:null,_=o?JSON.parse(o).role:null,[m,v]=r.useState([]),[I,P]=r.useState(0),[i,h]=r.useState(1),[n,x]=r.useState(T[0]),[l,C]=r.useState(""),[R,U]=r.useState(!1),[u,F]=r.useState([]),D=[{to:"/apps/customer/list",label:"ลูกค้า"},{to:`/apps/customer/edit/${p}`,label:"ข้อมูล"},{label:"สัญญาที่ดำเนินการ",isCurrent:!0}],N=[{accessor:"index",title:"ลำดับ",textAlignment:"center",render:(e,s)=>t("p",{children:s+1+(i-1)*n})},{accessor:"credit",title:"สถานะดำเนินการ",textAlignment:"left",sortable:!1,render:e=>{var s;return t("p",{children:(s=e.credit)==null?void 0:s.code})}},{accessor:"id",title:"เลขสัญญา",textAlignment:"center",sortable:!1,render:e=>{var c;const s=(c=u==null?void 0:u.find(M=>M.id_contract===e.id))==null?void 0:c.unread;return a("div",{className:`${(e==null?void 0:e.id_business_unit)==d||_=="admin"?"active pointer":null}  flex items-center space-x-2 `,onClick:()=>E(e),children:[t("span",{className:`w-3 h-3 rounded-full ${s>0?"bg-red-500":"bg-gray-300"}`}),t("span",{children:e.reference})]})}},f==="shop",{accessor:"business_unit",title:"หน่วยธุรกิจ",textAlignment:"left",sortable:!1,render:e=>{var s;return t("p",{className:"pointer",children:(s=e==null?void 0:e.business_unit)==null?void 0:s.name})}},{accessor:"shop",title:"ร้านค้า",textAlignment:"left",sortable:!1,render:e=>t("p",{children:e.shop.name})},{accessor:"ins_due_at",title:"งวดแรกเริ่มเมื่อ",textAlignment:"left",sortable:!1,render:e=>t("p",{className:"pointer",children:b(e==null?void 0:e.ins_due_at)??"-"})},{accessor:"contract_date",title:"วันที่ทำสัญญา",textAlignment:"left",sortable:!1,render:e=>t("p",{className:"pointer",children:b(e==null?void 0:e.contract_date)??"-"})},{accessor:"approved_at",title:"วันที่อนุมัติ",textAlignment:"left",sortable:!1,render:e=>t("div",{className:"pointer",children:e.approved_at!==null?b(e==null?void 0:e.approved_at):"-"})},{accessor:"customer",title:"ชื่อลูกค้า",textAlignment:"left",sortable:!1,render:e=>t("p",{children:e.customer.name})},{accessor:"ins_pay_day",title:"ชำระทุกวันที่",textAlignment:"center",sortable:!1,render:e=>t("p",{children:e.ins_pay_day})},{accessor:"ins_amount",title:"ค่างวด",textAlignment:"center",sortable:!1,render:({ins_amount:e})=>t("p",{children:e?e.toLocaleString("en-US"):"-"})},{accessor:"price",title:"ราคา",textAlignment:"right",sortable:!1,render:({price:e})=>t("p",{children:e?e.toLocaleString("en-US"):"-"})},{accessor:"down_payment",title:"ชำระเงินดาวน์",textAlignment:"right",sortable:!1,render:({down_payment:e})=>t("p",{children:e?e.toLocaleString("en-US"):"-"})},{accessor:"principle",title:"ทุนเช่าซื้อ",textAlignment:"right",sortable:!1,render:({principle:e})=>t("p",{children:e?e.toLocaleString("en-US"):"-"})},{accessor:"ins_period",title:"จำนวนงวด",textAlignment:"center",sortable:!1},{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:e=>t("div",{className:"flex gap-4 items-center w-max mx-auto",children:t("a",{className:`flex ${(e==null?void 0:e.id_business_unit)==d||_=="admin"?"active cursor-pointer":null}`,onClick:()=>E(e),children:t(V,{})})})},f==="shop"].filter(Boolean),{mutate:g}=k(w.contractFindAllHistory,{onSuccess:e=>{v(e.data.list),P(e.data.total)},onError:e=>{}}),E=e=>{(e.id_business_unit==d||_=="admin")&&open("/apps/contract/"+e.id+"/"+e.uuid,"_blank")},O=e=>{h(1),C(e.target.value)},L=()=>{g({data:{page:i,page_size:n,id_customer:p}})},A=r.useMemo(()=>B.debounce(e=>{g({data:{page:1,page_size:n,id_customer:p,query:e}})},500),[g,l]);return r.useEffect(()=>(R&&A(l),()=>{A.cancel()}),[l,A]),r.useEffect(()=>{L(),U(!0)},[i,n]),a("div",{className:"flex flex-col gap-2.5",children:[t("div",{className:"flex items-center justify-between flex-wrap",children:t(K,{items:D})}),a("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[t("div",{className:"flex items-center justify-between flex-wrap gap-4 mb-4.5 px-5 ",children:a("h2",{className:"text-xl",children:["สัญญาที่ดำเนินการ : ",(S=(y=m[0])==null?void 0:y.customer)==null?void 0:S.name]})}),t("div",{className:"flex items-center justify-end flex-wrap gap-4 mb-4.5 px-5 ",children:t("div",{className:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4 w-full sm:w-auto ",children:t("div",{className:"flex flex-row gap-3",children:a("div",{className:"relative",children:[t("input",{type:"text",placeholder:"ค้นหา",className:"form-input py-2 ltr:pr-11 rtl:pl-11 peer",value:l,onChange:O}),t("button",{type:"button",className:"absolute ltr:right-[11px] rtl:left-[11px] top-1/2 -translate-y-1/2 peer-focus:text-primary",children:t(j,{className:"mx-auto"})})]})})})}),t("div",{className:"datatables pagination-padding",children:m.length===0?t("div",{className:"my-10 text-center text-gray-500",children:"ไม่พบข้อมูล"}):t(G,{className:"whitespace-nowrap table-hover invoice-table",records:m,columns:N,page:i,totalRecords:I,recordsPerPage:n,onPageChange:e=>h(e),recordsPerPageOptions:T,onRecordsPerPageChange:e=>{h(1),x(e)},highlightOnHover:!0,paginationText:({from:e,to:s,totalRecords:c})=>`โชว์ ${e} ถึง ${s} ของ ${c} หน้าทั้งหมด`})})]})]})};export{J as default};
