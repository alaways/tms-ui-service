import{u as Q,a as ee,r as l,s as te,b as ie,i as se,c as g,f as r,F as ae,j as t,g as f,al as O,am as H}from"./index-a90aa29c.js";import{c as re,a as d,d as ne}from"./object-7405de1d.js";import{S as oe}from"./sweetalert2.all-ca2d1030.js";import{u as le,G as de,M as pe}from"./esm-fca376a3.js";import{t as ce,d as me,g as _e}from"./constant-e85f1578.js";import{N as ue}from"./regex-a1235873.js";import{F as he,a as be}from"./formik.esm-c4fd04ca.js";import{u as ge,a as fe}from"./useProvincesMutation-f0b4cb29.js";import{I as n}from"./InputField-d7971719.js";import{S as m}from"./SelectField-917481a8.js";import{B as Se}from"./breadcrumbs-b9914bbc.js";import{P as ye}from"./preLoading-b2445d9d.js";import{$ as _}from"./tabs-dd3b1363.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";import"./keyboard-f171a3e5.js";import"./use-resolve-button-type-789d628c.js";import"./use-is-mounted-22b05dcc.js";const Ae="admin",Ye=()=>{const p=oe.mixin(ce),S=Q(),c=ee(),F=[{to:"/apps/shop/list",label:"ร้านค้า"},{label:"เพิ่ม",isCurrent:!0}];l.useEffect(()=>{c(te("เพิ่มร้านค้า")),c(ie(["shop","/apps/shop/add"])),Y({})},[]);const u=localStorage.getItem(Ae),v=u?JSON.parse(u).role:null,j=se(e=>e.dataStore.provinces),T=u?JSON.parse(u??"{}").id_business_unit:null;l.useState("Shop"),v!=="admin"&&v!=="business_unit"&&S("/");const[C,xe]=l.useState({username:"",password:"",password_repeat:"",tax_id:"",name:"",contact_name:"",phone_number:"",line_id:"",facebook_id:"",website:"",email:"",address:"",id_province:"",id_district:"",id_subdistrict:"",zip_code:"",latitude:"",longitude:"",is_active:!0,is_approved:!0,id_business_unit:"",is_create_customer:!0}),[y,V]=l.useState(null),[D,G]=l.useState([]),[I,h]=l.useState([]),[a,P]=l.useState(0),[q,N]=l.useState(C),[K,B]=l.useState([]),{mutate:R}=g(f.shopSearch,{onSuccess:(e,i)=>{var s,o;e.code===200||e.statusCode===200?(N(b=>({...b,...e.data,password:""})),k({id:(s=e.data)==null?void 0:s.id_province,type:"id_province"}),w({id:(o=e.data)==null?void 0:o.id_district,type:"id_district"}),P(1)):(N({...C,tax_id:i.props.values.tax_id}),P(2))}}),{mutate:U,isLoading:A}=g(f.shopCreate,{onSuccess:(e,i)=>{e.code===200||e.statusCode===200?(p.fire({icon:"success",title:"บันทึกสำเร็จ",padding:"10px 20px"}),c(O(e.data)),c(H("edit")),S("/apps/shop/edit/"+e.data.id)):p.fire({icon:"error",title:e==null?void 0:e.message,padding:"10px 20px"})}}),{mutate:L,isLoading:W}=g(f.shopAddBu,{onSuccess:e=>{e.code===200||e.statusCode===200?(p.fire({icon:"success",title:"บันทึกสำเร็จ",padding:"10px 20px"}),c(O(e.data)),c(H("edit")),S("/apps/shop/edit/"+e.data.id)):p.fire({icon:"error",title:e==null?void 0:e.message,padding:"10px 20px"})}}),{mutate:k}=ge({onSuccess:(e,i)=>{const s=e.data.map(o=>({value:o.id,label:o.name_th}));switch(i.type){case"id_province":G(s);break}},onError:e=>{}}),{mutate:w}=fe({onSuccess:(e,i)=>{const s=e.data.map(o=>({value:o.id,label:o.name_th,zipCode:o.zip_code}));switch(i.type){case"id_district":h(s);break}},onError:e=>{}}),{mutate:Y}=g(f.contractFilter,{onSuccess:e=>{B(e.data.business_unit.map(i=>({value:i.id,label:i.name})))},onError:()=>{console.error("Failed to fetch status data")}}),{isLoaded:M}=le({googleMapsApiKey:_e}),x=(e,i,s)=>{const o=(J,Z)=>{J.forEach(E=>e.setFieldValue(E,null)),Z.forEach(E=>E([]))},b={id_province:()=>{k({id:i.value,type:s}),o(["id_district","id_subdistrict"],[h,h])},id_district:()=>{w({id:i.value,type:s}),o(["id_subdistrict"],[h])},id_subdistrict:()=>{e.setFieldValue("zip_code",parseInt(i.zipCode))}};b[s]&&b[s]()},z=l.useCallback(e=>{A||(a===1?L({data:{id_business_unit:T||e.id_business_unit,id_shop:e==null?void 0:e.uuid}}):U({data:{...e,tax_id:e.tax_id,id_business_unit:e.id_business_unit}}))},[a,L,U]),X=(e,i)=>{e.setFieldValue("latitude",i.latLng.lat().toString()),e.setFieldValue("longitude",i.latLng.lng().toString()),V({lat:i.latLng.lat(),lng:i.latLng.lng()})},$=re().shape({name:d().required("กรุณาใส่ข้อมูลให้ครบ"),tax_id:d().required("กรุณาใส่ข้อมูลให้ครบ").matches(ue,"ใส่ได้เฉพาะตัวเลขเท่านั้น").length(13,"กรุณาใส่ข้อมูลให้ครบ 13 หลัก"),contact_name:d().required("กรุณาใส่ข้อมูลให้ครบ"),id_province:d().required("กรุณาใส่ข้อมูลให้ครบ"),id_district:d().required("กรุณาใส่ข้อมูลให้ครบ"),id_subdistrict:d().required("กรุณาใส่ข้อมูลให้ครบ"),email:d().email("กรุณาใส่อีเมลที่ถูกต้อง").required("กรุณาใส่ข้อมูลให้ครบ"),id_business_unit:d().required("กรุณาใส่ข้อมูลให้ครบ"),...a===2&&{username:d().required("กรุณาใส่ข้อมูลให้ครบ"),password:d().required("กรุณาใส่ข้อมูลให้ครบ"),password_repeat:d().oneOf([ne("password"),null],"รหัสผ่านไม่ตรงกัน").required("กรุณาใส่ข้อมูลให้ครบ")}});return r(ae,{children:[(!M&&!W||A)&&t(ye,{}),t(Se,{items:F}),t("div",{className:"flex xl:flex-row flex-col gap-2.5 mt-3",children:t("div",{className:"panel px-6 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6",children:r("div",{className:"space-y-5 dark:text-white",children:[t("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"ตั้งค่าจัดการร้านค้า"}),t(he,{initialValues:q,onSubmit:z,enableReinitialize:!0,autoComplete:"off",validationSchema:$,children:e=>r(be,{children:[t("div",{className:"",children:r("div",{className:"check-container",children:[t(n,{label:"เลขประจำตัวผู้เสียภาษี",name:"tax_id",type:"text",onChange:i=>{let s=i.target.value.replace(/\D/g,"");s=s.slice(0,13),e.setFieldValue("tax_id",s)},onKeyPress:i=>{var s;if(i.key==="Enter"){i.preventDefault(),((s=e.values.tax_id)==null?void 0:s.length)===13?R({data:{tax_id:e.values.tax_id},props:e}):p.fire({icon:"error",title:"กรุณากรอกเลขประจำตัวผู้เสียภาษีให้ครบก่อนค้นหา",padding:"10px 20px"});return}/[0-9]/.test(i.key)||i.preventDefault()}}),t("button",{type:"button",className:"btn btn-dark mt-2 w-full border-0 uppercase shadow-[0_10px_20px_-10px_rgba(67,97,238,0.44)]",onClick:()=>{var i;((i=e.values.tax_id)==null?void 0:i.length)===13?R({data:{tax_id:e.values.tax_id},props:e}):p.fire({icon:"error",title:"กรุณากรอกเลขประจำตัวผู้เสียภาษีให้ครบก่อนค้นหา",padding:"10px 20px"})},children:"ตรวจสอบ"}),t("p",{className:"mt-4 text-[11px] text-white-dark",children:"หากพบจะแสดงบัญชีร้านค้า หากไม่พบจะแสดงแบบฟอร์มให้สร้างบัญชีใหม่ได้"})]})}),a===1||a===2?t("div",{children:r(_.Group,{children:[t(_.List,{className:"mt-3 flex flex-wrap border-b border-white-light dark:border-[#191e3a]",children:t(_,{as:l.Fragment,children:({selected:i})=>t("button",{className:`${i?"!border-white-light !border-b-white text-themePrimary !outline-none dark:!border-[#191e3a] dark:!border-b-black":""} dark:hover:border-b-black' -mb-[1px] block border border-transparent p-3.5 py-2 hover:text-themePrimary`,children:"บัญชีร้านค้า"})})}),t(_.Panels,{children:r(_.Panel,{children:[r("div",{className:"mt-6",children:[t("div",{className:"input-flex-row mt-4",children:t(m,{require:!0,id:"id_business_unit",label:"หน่วยธุรกิจ",name:"id_business_unit",placeholder:"เลือก หน่วยธุรกิจ",options:K,isSearchable:!0})}),r("div",{className:"input-flex-row mt-4",children:[t(n,{require:!0,label:"ชื่อร้าน",name:"name",type:"text",disabled:a==1}),t(n,{require:!0,label:"ชื่อผู้ติดต่อ",name:"contact_name",type:"text",disabled:a==1})]}),r("div",{className:"input-flex-row",children:[t(n,{label:"เบอร์โทรศัพท์",name:"phone_number",type:"text",disabled:a==1,maxLength:10,onKeyPress:i=>{/[0-9]/.test(i.key)||i.preventDefault()}}),t(n,{label:"Line ID",name:"line_id",type:"text",disabled:a==1})]}),r("div",{className:"input-flex-row",children:[t(n,{label:"Facebook ID",name:"facebook_id",type:"text",disabled:a==1}),t(n,{label:"เว็บไซต์",name:"website",type:"text",disabled:a==1})]}),t("div",{className:"input-flex-row",children:t(n,{require:!0,label:"อีเมล",name:"email",type:"text",disabled:a==1})}),t("div",{className:"input-flex-row",children:t(n,{label:"ที่อยู่",name:"address",as:"textarea",rows:"1",placeholder:"กรุณาใส่ข้อมูล",className:"form-textarea ltr:rounded-l-none rtl:rounded-r-none resize-none",disabled:a==1})}),r("div",{className:"input-flex-row",children:[t(m,{require:!0,label:"จังหวัด",id:"id_province",name:"id_province",placeholder:"กรุณาเลือก",isSearchable:!0,options:j,onChange:i=>{x(e,i,"id_province")},disabled:a==1}),t(m,{require:!0,label:"อำเภอ/เขต",id:"id_district",name:"id_district",placeholder:"กรุณาเลือก",isSearchable:!0,options:D,disabled:a==1||D.length===0,onChange:i=>{x(e,i,"id_district")}})]}),r("div",{className:"input-flex-row",children:[t(m,{require:!0,label:"ตำบล/แขวง",id:"id_subdistrict",name:"id_subdistrict",placeholder:"กรุณาเลือก",isSearchable:!0,options:I,disabled:a==1||I.length===0,onChange:i=>{x(e,i,"id_subdistrict")}}),t(n,{label:"รหัสไปรษณีย์",name:"zip_code",as:"textarea",rows:"1",disabled:!0})]}),r("div",{className:"input-flex-row",children:[t(n,{label:"Latitude",name:"latitude",type:"text",disabled:!0}),t(n,{label:"Longitude",name:"longitude",type:"text",disabled:!0})]}),t("div",{className:"input-flex-row",children:t(m,{require:!0,label:"สร้างลูกค้า",id:"is_create_customer",name:"is_create_customer",placeholder:"กรุณาเลือก",options:[{value:!1,label:"ปิด"},{value:!0,label:"เปิด"}],isSearchable:!1})}),t("div",{className:"input-flex-row mb-3",children:M&&t(de,{zoom:13,center:me,mapContainerStyle:{marginTop:"15px",height:"400px",width:"100%"},onClick:i=>X(e,i),children:y&&t(pe,{position:{lat:y.lat,lng:y.lng}})})})]}),a===2&&r("div",{className:"pt-2",children:[t("div",{className:"input-flex-row",children:t(n,{require:!0,label:"ชื่อผู้ใช้งาน",name:"username",type:"text"})}),r("div",{className:"input-flex-row",children:[t(n,{label:"รหัสผ่าน",name:"password",type:"password"}),t(n,{label:"ยืนยันรหัสผ่าน",name:"password_repeat",type:"password"})]})]}),r("button",{type:"submit",className:"btn !mt-6 w-full border-0 btn-primary",children:[A&&t("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-5 h-5 ltr:mr-4 rtl:ml-4 inline-block align-middle"}),"บันทึก"]})]})})]})}):""]})})]})})})]})};export{Ye as default};
