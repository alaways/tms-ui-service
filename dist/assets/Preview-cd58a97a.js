import{ak as Me,an as Oe,u as je,a as Ge,i as He,r as i,s as Fe,b as Ve,au as Be,c as p,f as a,j as e,aw as J,at as Q,g as m}from"./index-a90aa29c.js";import{c as ee,a as P}from"./object-7405de1d.js";import{S as te}from"./sweetalert2.all-ca2d1030.js";import{T as k}from"./tippy-react.esm-150a8dd6.js";import{d as We}from"./debounce-5af6d14d.js";import{t as Ke}from"./constant-e85f1578.js";import{c as se,b as Ye}from"./formatNumeric-862380d6.js";import{F as L,a as D}from"./formik.esm-c4fd04ca.js";import{I as ae}from"./InputField-d7971719.js";import{S as b}from"./SelectField-917481a8.js";import{B as ze}from"./breadcrumbs-b9914bbc.js";import{I as ie}from"./IconX-54a3093e.js";import{I as qe}from"./IconEye-eb8ead5b.js";import{I as re}from"./IconPlus-4c7e79c8.js";import{I as U}from"./IconEdit-bf2b08f0.js";import{I as Xe}from"./IconLink-e59a7f13.js";import{I as $e}from"./IconMail-ccee7844.js";import{I as Ze}from"./IconLine-2b703383.js";import{I as Je}from"./IconMapPin-780fe235.js";import{I as Qe}from"./IconSettings-49e5d033.js";import{I as et}from"./IconPhoneCall-d077c5b2.js";import{I as tt}from"./IconCreditCard-26c6e5da.js";import{I as ne}from"./IconChecks-e4ba7579.js";/* empty css              */import{q as g,_ as E}from"./transition-d4ca4cfa.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";import"./keyboard-f171a3e5.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const st="admin",Yt=()=>{const{t:T}=Me(),{id:c}=Oe(),S=je(),u=Ge(),M=te.mixin(Ke),O=localStorage.getItem(st),j=O?JSON.parse(O).role:null,o=He(t=>t.dataStore.businessUnits),oe=[{to:"/apps/business-unit/list",label:T("business_unit")},{label:T("business_unit_info"),isCurrent:!0}];j!=="admin"&&j!=="business_unit"&&S("/"),i.useEffect(()=>{u(Fe(T("business_unit_info"))),u(Ve(["bu","/apps/business-unit/list"]))},[]);const[G,le]=i.useState([]),[ce,C]=i.useState([]),[h,H]=i.useState([]),[de,f]=i.useState([]),[pe,me]=i.useState([]),[I,F]=i.useState([]),[v,V]=i.useState(""),[B,at]=i.useState(""),[he,ue]=i.useState([]),[r,_e]=i.useState({name:"",tax_id:"",phone:"",full_address:"",id_province:"",id_district:"",id_subdistrict:"",email:"",website:"",zip_code:"",logo_image_url:""}),be=ee().shape({name:P().required("กรุณาใส่ข้อมูลให้ครบ")});i.useEffect(()=>{const t=setTimeout(()=>{v.trim()!==""?ge():h&&f(h)},500);return()=>clearTimeout(t)},[v,h]);const ge=()=>{if(v.trim()!==""){const t=v.toLowerCase(),s=h==null?void 0:h.filter(n=>{const y=n.tax_id??"",d=n.name??"",N=n.shop_group_name??"";return y.toString().toLowerCase().includes(t)||d.toLowerCase().includes(t)||N.toLowerCase().includes(t)});f(s)}else f(h)},{mutate:fe,isLoading:it}=Be({async onSuccess(t){const s=t.data;_e(s),u(Q(s))},onError(t){}}),{mutate:ve}=p(m.buRelationUpdate,{onSuccess:t=>{t.statusCode===200||t.code===200?(V(""),l("แก้ไขข้อมูลสำเร็จ","success"),x(!1),w({data:{id_business_unit:o.id}})):l(t.message,"error")},onError:t=>{l(t.message,"error")}}),{mutate:A,isLoading:rt}=p(m.buGetShopGroup,{onSuccess:t=>{const s=t.data.filter((n,y,d)=>y===d.findIndex(N=>N.id===n.id)).map(n=>n);C(s),le(s.map(n=>({value:n.id,label:n.name}))),F(s)},onError:()=>{W("ไม่พบข้อมูล กลุ่มร้านในหน่วยธุรกิจ"),C([]),F([])}}),{mutate:w}=p(m.buGetShopV2,{onSuccess:t=>{const s=t.data;H(s),f(s)},onError:()=>{W("ไม่พบข้อมูล ร้านค้าในกลุ่มร้าน"),H([]),f([])}}),W=t=>{l(t,"error")},l=(t,s)=>{te.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3}).fire({icon:s,title:t,padding:"10px 20px"})},{mutate:xe}=p(m.buCheckList,{onSuccess:t=>{ue(t.data)},onError:t=>{l(t.message,"error")}});i.useEffect(()=>{xe({data:{id_business_unit:Number(c)||+((o==null?void 0:o.id)??0)}}),fe({data:{id:c||o.id}}),A({data:{id_business_unit:o.id}}),w({data:{id_business_unit:o.id}})},[o.id,A,w]),i.useEffect(()=>{const t=We(s=>{s.trim()===""?C(I):C(I.filter(n=>n.name&&n.name.toLowerCase().includes(s.toLowerCase())))},200);return t(B),()=>{t.cancel()}},[B,I]);const ye=t=>{u(J(t)),S("/apps/business-unit/setting/"+t.id+"?business_id="+c)},K={id:"",name:"",id_business_unit:null,is_active:!0},Ne={id:"",name:"",id_shop_group:0,is_active:!0},[R,Se]=i.useState(K),[Ce,Ae]=i.useState(Ne),[Y,_]=i.useState(!1),[z,x]=i.useState(!1),q=(t=null)=>{Se(t?{...t,id_business_unit:t.business_unit.id}:K),_(!0)},Ee=(t=null)=>{Ae({...t,id_shop_group:t.id_shop_group}),x(!0)},{mutate:X}=p(m.shopGroupCreate,{onSuccess:t=>{t.statusCode===200||t.code===200?(l("เพิ่มข้อมูลสำเร็จ","success"),_(!1),A({data:{id_business_unit:o.id}})):l(t.message,"error")},onError:t=>{l(t.message,"error")}}),{mutate:$}=p(m.shopGroupUpdate,{onSuccess:t=>{t.statusCode===200||t.code===200?(l("แก้ไขข้อมูลสำเร็จ","success"),_(!1),A({data:{id_business_unit:o.id}})):l(t.message,"error")},onError:t=>{l(t.message,"error")}}),{mutate:Te,isLoading:nt}=p(m.shopRelation,{onSuccess:t=>{t.statusCode===200||t.code===200?(M.fire({icon:"success",title:"บันทึกสำเร็จ",padding:"10px 20px"}),setTimeout(()=>{location.reload()},1e3)):M.fire({icon:"warning",title:t.message,padding:"10px 20px"})}}),{mutate:Ie,isLoading:ot}=p(m.shopReadyToAddBu,{onSuccess:t=>{me(t.data.map(s=>({value:s.id,label:s.name})))}}),Z=(t,s,n)=>{t.setFieldValue(n,s.value),n==="id_shop_group"&&c!==void 0&&Ie({data:{id_shop_group:s.value,id_business_unit:c!==void 0?parseInt(c):""}})},[we,lt]=i.useState({id_business_unit:c!==void 0?parseInt(c):"",id_shop_group:"",id_shop:""}),Re=i.useCallback(t=>{if(t.id)$({id:t.id,data:{id_business_unit:o.id,name:t.name,is_active:t.is_active}});else{const s={...t,active:t.is_active,id_business_unit:o.id};X({data:s})}},[X,$,o.id]),Pe=i.useCallback(t=>{ve({data:{id_business_unit:o.id,id_shop:t.id,id_shop_group:t.id_shop_group,is_active:t.is_active,is_main:t.is_main}})},[o.id]),ke=i.useCallback(t=>{Te({data:t})},[]),Le=ee().shape({id_shop_group:P().required("กรุณาใส่ข้อมูลให้ครบ"),id_shop:P().required("กรุณาใส่ข้อมูลให้ครบ")}),De=()=>{u(Q(o)),S("/apps/business-unit/edit/"+c)},Ue=()=>{u(J(o)),S("/apps/shop-group/shop-bu-interestrate/"+c)};return a("div",{className:"pt-1",children:[a("div",{className:"flex items-center justify-between flex-wrap",children:[e(ze,{items:oe}),a("div",{className:"flex",children:[a("a",{className:"cursor-pointer btn btn-sm btn-primary mr-1",onClick:()=>De(),children:[e(U,{className:"w-4.5 h-4.5"}),"   แก้ไข"]}),a("a",{className:"cursor-pointer btn btn-sm btn-primary",onClick:()=>Ue(),children:[e(Qe,{}),"   ตั้งค่า"]})]})]}),(t=>{const s=[{label:"กลุ่มร้าน",key:"shop_group"},{label:"ร้านค้าพาร์ทเนอร์",key:"partner"},{label:"การตั้งค่าหน่วยธุรกิจ",key:"business_unit"}],y=s.filter(d=>t[d.key]).length===s.length;return e("div",{className:"flex flex-col items-center",children:a("div",{className:"relative z-[1] flex-1 mt-4 w-[60vw]",children:[e("div",{className:`w-[100%] h-1 absolute ltr:left-0 rtl:right-0 top-[30px] m-auto -z-[1] transition-[width] ${y?"bg-[#19d20c]":"bg-[#f3f2ee]"}`}),e("ul",{className:"mb-5 grid grid-cols-3",children:s.map((d,N)=>a("li",{className:"mx-auto flex flex-col items-center",children:[e("div",{className:`${t[d.key]?"!border-[#19d20c] !bg-[#19d20c] text-white":""} border-[3px] border-[#f3f2ee] bg-white dark:bg-[#253b5c] dark:border-[#1b2e4b] flex justify-center items-center w-16 h-16 rounded-full`,children:e(ne,{})}),e("span",{className:"text-center block mt-2",children:d.label})]},N))})]})})})(he),e("div",{className:"grid lg:grid-cols-1 gap-6 mb-6 pt-5",children:a("div",{className:"p-0 lg:col-span-2",children:[e("div",{className:"flex flex-col gap-2.5",children:e("div",{className:"panel px-12 flex-1 py-12 rtl:xl:ml-6",children:a("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:[e("div",{className:"col-span-1",children:(r==null?void 0:r.logo_image_url)&&e("img",{src:(r==null?void 0:r.logo_image_url)??"",alt:"img",style:{width:"100%",maxWidth:"250px"}})}),a("div",{className:"col-span-2",children:[e("div",{className:"grid grid-cols-1 gap-3 mt-5",children:e("div",{className:"text-2xl font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:(r==null?void 0:r.name)??"-"})}),a("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-5 px-2 py-3",children:[a("div",{className:"col-span-1 flex items-center",children:[e(tt,{className:"mr-2"}),se(r==null?void 0:r.tax_id)??"-"]}),a("div",{className:"col-span-1 flex items-center",children:[e(et,{className:"mr-2"}),Ye(r==null?void 0:r.phone)??"-"]})]}),a("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 px-2 py-3",children:[a("div",{className:"col-span-1 flex items-center",children:[e($e,{className:"mr-2"}),(r==null?void 0:r.email)??"-"]}),a("div",{className:"col-span-1 flex items-center",children:[e(Xe,{className:"mr-2"}),(r==null?void 0:r.website)??"-"]})]}),e("div",{className:"grid grid-cols-1 gap-3 px-2 py-3",children:a("div",{className:"col-span-2 flex items-center",children:[e(Je,{className:"mr-2"}),(r==null?void 0:r.full_address)??"-"]})}),e("div",{className:"grid grid-cols-1 gap-3 px-2 py-3",children:a("div",{className:"col-span-2 flex items-center",children:[e(Ze,{className:"mr-2"}),(r==null?void 0:r.line_id)??"-"]})})]})]})})}),e("br",{}),e("div",{className:"flex xl:flex-row flex-col gap-2.5",children:a("div",{className:"panel px-6 flex-1 py-6 rtl:xl:ml-6",children:[a("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"กลุ่มร้าน"}),e("div",{className:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4 w-full sm:w-auto",children:e("div",{className:"flex gap-3",children:e("div",{children:a("button",{type:"button",className:"btn btn-primary",onClick:()=>q(),children:[e(re,{className:"ltr:mr-2 rtl:ml-2"}),"เพิ่มกลุ่มร้าน"]})})})})]}),e("br",{}),e("div",{className:"table-responsive",children:a("table",{className:"table-striped table-hover",children:[e("thead",{children:a("tr",{children:[e("th",{className:"text-center",style:{width:"100px"},children:"ลำดับ"}),e("th",{children:"ชื่อกลุ่มร้าน"}),e("th",{children:"ตั้งค่า"}),e("th",{className:"!text-center",style:{width:"200px"},children:"Actions"})]})}),e("tbody",{children:ce.map((t,s)=>a("tr",{children:[e("td",{className:"text-center",children:e("div",{className:"flex inline-flex items-center w-max",children:e("div",{children:s+1})})}),e("td",{children:t.name}),e("td",{children:e("span",{className:`badge ${t.is_active?"badge-outline-success":"badge-outline-danger"}`,children:t.is_active?"พร้อมใช้งาน":"ไม่พร้อมใช้งาน"})}),e("td",{children:a("div",{className:"flex gap-4 items-center w-max mx-auto",children:[e(k,{content:"ดูข้อมูล",theme:"Primary",children:e("a",{className:"flex hover:text-info cursor-pointer",onClick:()=>ye(t),children:e(qe,{className:"w-4.5 h-4.5"})})}),e(k,{content:"แก้ไข",theme:"Primary",children:e("a",{className:"flex hover:text-info cursor-pointer",onClick:()=>q(t),children:e(U,{className:"w-4.5 h-4.5"})})})]})})]},t.id))})]})})]})}),e("br",{}),e("div",{className:"flex xl:flex-row flex-col gap-2.5",children:a("div",{className:"panel px-6 flex-1 py-6 rtl:xl:ml-6",children:[a("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"ร้านค้าพาร์ทเนอร์"}),e("div",{className:"flex items-center gap-2 ml-auto",children:e("input",{type:"text",placeholder:"ค้นหา...",value:v,onChange:t=>V(t.target.value),className:"border rounded p-2"})})]}),e(L,{initialValues:we,onSubmit:ke,enableReinitialize:!0,autoComplete:"off",validationSchema:Le,children:t=>e(D,{className:"space-y-5 dark:text-white ",children:a("div",{className:"flex items-center justify-between flex-wrap",children:[e("div",{className:"w-4/6",style:{width:"calc(100% - 210px)"},children:a("div",{className:"input-flex-row",children:[e(b,{label:"กลุ่มร้าน",id:"id_shop_group",name:"id_shop_group",placeholder:"กรุณาเลือก",options:G,isSearchable:!0,onChange:s=>{Z(t,s,"id_shop_group")}}),e(b,{label:"ร้านค้า",id:"id_shop",name:"id_shop",placeholder:"กรุณาเลือก",options:pe,isSearchable:!0,disabled:!t.values.id_shop_group,onChange:s=>{Z(t,s,"id_shop")}})]})}),e("div",{className:"flex justify-end w-2/6",style:{width:"200px"},children:e("div",{className:"pt-10",children:a("button",{type:"submit",className:"btn btn-primary",children:[e(re,{}),"   เพิ่มร้านค้าพาร์ทเนอร์"]})})})]})})}),e("br",{}),e("div",{className:"overflow-x-scroll",children:e("div",{className:"table-responsive ",children:a("table",{className:"table-striped table-hover",children:[e("thead",{children:a("tr",{children:[e("th",{className:"text-center",style:{width:"100px"},children:"ลำดับ"}),e("th",{style:{minWidth:"180px"},children:"เลขผู้เสียภาษี"}),e("th",{style:{minWidth:"150px"},children:"ชื่อร้าน"}),e("th",{style:{minWidth:"90px"},children:"กลุ่มร้าน"}),e("th",{style:{minWidth:"130px"},children:"สถานะ"}),e("th",{style:{minWidth:"130px"},children:"กลุ่มหลัก"}),e("th",{className:"!text-center",style:{width:"200px"},children:"Actions"})]})}),e("tbody",{children:de.map((t,s)=>a("tr",{children:[e("td",{className:"text-center",children:e("div",{className:"flex inline-flex items-center w-max",children:e("div",{children:s+1})})}),e("td",{children:se(t==null?void 0:t.tax_id)??"-"}),e("td",{children:t.name}),e("td",{children:t==null?void 0:t.shop_group_name}),e("td",{children:e("span",{className:`badge ${t.is_active?"badge-outline-success":"badge-outline-danger"}`,children:t.is_active?"พร้อมใช้งาน":"ไม่พร้อมใช้งาน"})}),e("td",{className:"text-center text-green",children:(t==null?void 0:t.is_main)==!0?e(ne,{}):""}),e("td",{children:e("div",{className:"flex gap-4 items-center w-max mx-auto",children:e(k,{content:"แก้ไข",theme:"Primary",children:e("a",{className:"flex hover:text-info cursor-pointer",onClick:()=>Ee(t),children:e(U,{className:"w-4.5 h-4.5"})})})})})]},`${t.id}-${s}`))})]})})})]})})]})}),e(g,{appear:!0,show:Y,as:i.Fragment,children:a(E,{as:"div",open:Y,onClose:()=>_(!1),className:"relative z-[51]",children:[e(g.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0 bg-[black]/60"})}),e("div",{className:"fixed inset-0 overflow-y-auto",children:e("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:e(g.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:a(E.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[e("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>_(!1),children:e(ie,{})}),e("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:R.id?"แก้ไข":"เพิ่ม"}),e("div",{className:"p-5",children:e(L,{initialValues:R,onSubmit:Re,enableReinitialize:!0,autoComplete:"off",validationSchema:be,children:t=>a(D,{className:"space-y-5 mb-7 dark:text-white custom-select",children:[e(ae,{label:"ชื่อกลุ่มร้าน",name:"name",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),e(b,{label:"สถานะ *",id:"is_active",name:"is_active",options:[{value:!0,label:"เปิด"},{value:!1,label:"ปิด"}],placeholder:"กรุณาเลือก",onChange:s=>{t.setFieldValue("is_active",s.value)},isSearchable:!1}),a("div",{className:"flex justify-end items-center mt-8",children:[e("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>_(!1),children:"ยกเลิก"}),e("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:R.id?"บันทึก":"เพิ่ม"})]})]})})})]})})})})]})}),e(g,{appear:!0,show:z,as:i.Fragment,children:a(E,{as:"div",open:z,onClose:()=>x(!1),className:"relative z-[51]",children:[e(g.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0 bg-[black]/60"})}),e("div",{className:"fixed inset-0 overflow-y-auto",children:e("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:e(g.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:a(E.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[e("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>x(!1),children:e(ie,{})}),e("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"แก้ไข"}),e("div",{className:"p-5",children:e(L,{initialValues:Ce,onSubmit:Pe,enableReinitialize:!0,autoComplete:"off",children:t=>a(D,{className:"space-y-5 mb-7 dark:text-white custom-select",children:[e(ae,{label:"ชื่อร้านค้า",name:"name",type:"text",placeholder:"กรุณาใส่ข้อมูล",disabled:!0}),e(b,{label:"กลุ่มร้าน",id:"id_shop_group",name:"id_shop_group",placeholder:"กรุณาเลือก",options:G,isSearchable:!0,disabled:!0}),e(b,{label:"กลุ่มหลัก",id:"is_main",name:"is_main",options:[{value:!0,label:"เปิด"},{value:!1,label:"ปิด"}],placeholder:"กรุณาเลือก",onChange:s=>{t.setFieldValue("is_active",s.value)},isSearchable:!1}),e(b,{label:"สถานะ *",id:"is_active",name:"is_active",options:[{value:!0,label:"เปิด"},{value:!1,label:"ปิด"}],placeholder:"กรุณาเลือก",onChange:s=>{t.setFieldValue("is_active",s.value)},isSearchable:!1}),a("div",{className:"flex justify-end items-center mt-8",children:[e("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>x(!1),children:"ยกเลิก"}),e("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"บันทึก"})]})]})})})]})})})})]})})]})};export{Yt as default};
