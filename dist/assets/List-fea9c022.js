import{ak as le,r,c as p,f as i,j as s,v as ce,h as x,t as de,g as m}from"./index-a90aa29c.js";import{Q as pe}from"./index-2f30bf27.js";import{c as P,a as u,f as N,b as R}from"./object-7405de1d.js";import{S as me}from"./sweetalert2.all-ca2d1030.js";import{P as U}from"./config-8de56c22.js";import{I as ue}from"./IconPlus-4c7e79c8.js";import{T as f}from"./tippy-react.esm-150a8dd6.js";import{I as _e}from"./IconEdit-bf2b08f0.js";import{I as he}from"./IconTrash-95ccc529.js";import{I as be}from"./IconEye-eb8ead5b.js";import{F as w,a as D}from"./formik.esm-c4fd04ca.js";import{I as M}from"./InputField-d7971719.js";import{S as g}from"./SelectField-917481a8.js";import{F as k}from"./DatePickerTime-6f9990ef.js";import{a as O}from"./formatDate-4e046265.js";import{s as A}from"./showNotification-b9615e49.js";import{I as fe}from"./IconX-54a3093e.js";import{q as y,_ as L}from"./transition-d4ca4cfa.js";import"./floating-ui.dom-0aeb9e8a.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./lodash-f7ec5310.js";import"./flatpickr-2301360e.js";import"./keyboard-f171a3e5.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const ge="admin",Xe=()=>{const{t}=le(),v=localStorage.getItem(ge),c=v?JSON.parse(v).id_business_unit:null,[H,j]=r.useState([]),[E,F]=r.useState([]),[q,V]=r.useState([]),[h,S]=r.useState(1),[d,B]=r.useState(U[0]),[G,Y]=r.useState(0),[K,W]=r.useState(""),[T,l]=r.useState(!1),[a,b]=r.useState({id_business_unit:"",shop_list:[],subject:"",message:"",start_at:null,end_at:null,is_active:!0}),{mutate:_}=p(m.announceFindAll,{onSuccess:e=>{e.statusCode==200&&e.code==200&&(V(e.data.list),Y(e.data.total))},onError:()=>{console.error("Failed to fetch asset type data")}}),{mutate:z}=p(m.announceCreate,{onSuccess:e=>{e.statusCode==200&&e.code==200&&(A(t("announce_create_success"),"success"),setTimeout(()=>{location.reload()},500))},onError:()=>{console.error("Failed to fetch asset type data")}}),{mutate:X}=p(m.announceUpdate,{onSuccess:e=>{e.statusCode==200&&e.code==200&&(A(t("announce_update_success"),"success"),setTimeout(()=>{location.reload()},500))},onError:()=>{console.error("Failed to fetch asset type data")}}),{mutate:Z}=p(m.announceDelete,{onSuccess:e=>{e.statusCode==200&&e.code==200&&(A(t("announce_delete_success"),"success"),setTimeout(()=>{location.reload()},500))},onError:()=>{console.error("Failed to fetch asset type data")}}),{mutate:$}=p(m.contractFilter,{onSuccess:e=>{j(e.data.business_unit.map(n=>({value:n.id,label:n.name})))},onError:()=>{console.error("Failed to fetch asset type data")}}),{mutate:Q}=p(m.shopFindAll,{onSuccess:e=>{F(e.data.list.map(n=>({value:n.id,label:n.name})))},onError:()=>{console.error("Failed to fetch asset type data")}});r.useEffect(()=>{Q({}),$({})},[]),r.useEffect(()=>{_({data:{page:h,page_size:d,...c&&{id_business_unit:c}}})},[h,d]);const J=P().shape({id_business_unit:u().required(t("required_field")),subject:u().required(t("required_field")),message:u().required(t("required_field")),start_at:N().nullable().required(t("required_field")),end_at:N().nullable().required(t("required_field")),is_active:R().required(t("required_field"))}),ee=P().shape({id_business_unit:u().required(t("required_field")),subject:u().required(t("required_field")),message:u().required(t("required_field")),is_active:R().required(t("required_field"))}),te=()=>{l(!0),b({id_business_unit:"",shop_list:[],subject:"",message:"",start_at:null,end_at:null,is_active:!0})},se=e=>{l(!0);const n=new Date(e.start_at),o=new Date(e.end_at);b({...e,start_at:n.setHours(n.getHours()-7),end_at:o.setHours(o.getHours()-7),shop_list:E,preview:!0})},ae=e=>{var C;l(!0);const n=(C=e==null?void 0:e.shops)==null?void 0:C.map(oe=>oe.uuid),o=new Date(e.start_at),I=new Date(e.end_at);b({...e,start_at:o.setHours(o.getHours()-7),end_at:I.setHours(I.getHours()-7),shop_list:n})},ne=async e=>{const n={...e,start_at:x.utc(e.start_at).tz("Asia/Bangkok").format("YYYY-MM-DDTHH:mm:ss")+"Z",end_at:x.utc(e.end_at).tz("Asia/Bangkok").format("YYYY-MM-DDTHH:mm:ss")+"Z",announce_id:e.id,shop_list:["all"]};e.id?await X({data:n}):await z({data:n}),_({data:{page:1,page_size:d,...c&&{id_business_unit:c}}}),l(!1)},re=e=>{const n={announce_id:e.id};me.fire({title:t("delete_announce_title"),text:t("delete_announce_text"),icon:"warning",showCancelButton:!0,confirmButtonColor:de.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:t("confirm"),cancelButtonText:t("cancel"),reverseButtons:!0}).then(async o=>{o.isConfirmed&&(await Z({data:n}),_({data:{page:1,page_size:d}}))})},ie=e=>{const n=e.map(o=>o.value);_({data:{page:1,page_size:d,...c&&{id_business_unit:c},shop_list:n}})};return i("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[i("div",{className:"flex items-start justify-between flex-wrap gap-4 mb-4.5 px-5 ",children:[s("h2",{className:"text-xl",children:t("announce")}),s(w,{initialValues:{},onSubmit:()=>{},enableReinitialize:!0,autoComplete:"off",children:i(D,{className:"flex flex-col sm:items-center sm:gap-3 gap-4 w-full sm:w-auto custom-select max-w-[500px]",children:[i("div",{className:"w-full flex gap-3",children:[i("button",{type:"button",className:"btn btn-primary w-[200px]",onClick:te,children:[s(ue,{className:"ltr:mr-2 rtl:ml-2"}),t("add_announce")]}),i("div",{className:"relative w-full flex items-center",children:[s("input",{type:"text",placeholder:t("search_text"),className:"form-input py-2 ltr:pr-11 rtl:pl-11 peer",value:K,onChange:e=>W(e.target.value)}),s("button",{type:"button",className:"absolute ltr:right-[11px] rtl:left-[11px] top-1/2 -translate-y-1/2 peer-focus:text-primary",children:s(ce,{className:"mx-auto"})})]})]}),s("div",{className:"w-full",children:s(g,{isMulti:!0,id:"shop_list",name:"shop_list",placeholder:t("select_shop"),options:E,onChange:ie})})]})})]}),s("div",{className:"datatables pagination-padding",children:s(pe,{className:"whitespace-nowrap table-hover invoice-table",records:q,columns:[{accessor:"id",title:t("order"),textAlignment:"center",sortable:!1,render:(e,n)=>s("div",{children:n+1})},{accessor:"id_business_unit",title:t("business_unit"),textAlignment:"center",sortable:!1,render:e=>s("p",{children:(e==null?void 0:e.business_unit_name)||"-"})},{accessor:"subject",title:t("announce_subject"),textAlignment:"left",sortable:!1,render:e=>s("p",{children:(e==null?void 0:e.subject)||"-"})},{accessor:"message",title:t("announce_message"),textAlignment:"left",sortable:!1,render:e=>s("p",{children:(e==null?void 0:e.message)||"-"})},{accessor:"start_at",title:t("announce_start_datetime"),textAlignment:"left",sortable:!1,render:e=>i("p",{children:[O(e.start_at)||"-"," "]})},{accessor:"end_at",title:t("announce_end_datetime"),textAlignment:"left",sortable:!1,render:e=>i("p",{children:[O(e.end_at)||"-"," "]})},{accessor:"admin_name",title:t("operator"),textAlignment:"left",sortable:!1},{accessor:"is_active",title:t("active_status"),textAlignment:"center",sortable:!1,render:({is_active:e})=>s("span",{className:`badge ${e?"badge-outline-success":"badge-outline-danger"}`,children:t(e?"open":"close")})},{accessor:"action",title:t("actions"),textAlignment:"center",sortable:!1,render:e=>i("div",{className:"flex gap-4 items-center w-max mx-auto",children:[s(f,{content:t("view_data"),theme:"Primary",children:s("a",{className:"flex cursor-pointer active",onClick:()=>se(e),children:s(be,{className:"w-4.5 h-4.5"})})}),s(f,{content:t("edit"),theme:"Primary",children:s("a",{className:"flex cursor-pointer active",onClick:()=>ae(e),children:s(_e,{className:"w-4.5 h-4.5"})})}),s(f,{content:t("delete"),theme:"Primary",children:s("a",{className:"flex cursor-pointer active",onClick:()=>re(e),children:s(he,{})})})]})}],minHeight:180,page:h,totalRecords:G,recordsPerPage:d,highlightOnHover:!0,onPageChange:e=>S(e),recordsPerPageOptions:U,onRecordsPerPageChange:e=>{S(1),B(e)},paginationText:({from:e,to:n,totalRecords:o})=>`โชว์ ${e} ถึง ${n} ของ ${o} หน้าทั้งหมด`})}),s(y,{appear:!0,show:T,as:r.Fragment,children:i(L,{as:"div",open:T,onClose:()=>l(!1),className:"relative z-[51]",children:[s(y.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:s("div",{className:"fixed inset-0 bg-[black]/60"})}),s("div",{className:"fixed inset-0 overflow-y-auto",children:s("div",{className:"flex min-h-full items-center justify-center px-12 py-8",children:s(y.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:i(L.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-5xl text-black dark:text-white-dark",children:[s("button",{type:"button",onClick:()=>l(!1),className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:s(fe,{})}),s("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:a.preview?t("view_detail"):a.id?t("edit"):t("add")}),s("div",{className:"p-5",children:s(w,{initialValues:a,onSubmit:ne,enableReinitialize:!0,autoComplete:"off",validationSchema:a.id?ee:J,children:e=>i(D,{className:"space-y-5 mb-7 dark:text-white",children:[s(g,{label:t("business_unit")||"",id:"id_business_unit",name:"id_business_unit",isSearchable:!0,options:H,disabled:!!(a!=null&&a.id)}),s(M,{label:t("announce_subject"),name:"subject",type:"text",placeholder:t("required_field"),disabled:!!(a!=null&&a.preview)}),s(M,{label:t("announce_message"),name:"message",type:"text",placeholder:t("required_field"),disabled:!!(a!=null&&a.preview)}),i("div",{className:"flex flex-col sm:flex-row gap-4",children:[s(k,{label:t("from_date"),name:"start_at",disabled:!!(a!=null&&a.preview)}),s(k,{label:t("to_date"),name:"end_at",disabled:!!(a!=null&&a.preview)})]}),s(g,{label:t("status"),id:"is_active",name:"is_active",options:[{value:!0,label:t("open")},{value:!1,label:t("close")}],placeholder:t("please_select"),onChange:n=>{e.setFieldValue("is_active",n.value)},isSearchable:!1,disabled:!!(a!=null&&a.preview)}),!(a!=null&&a.preview)&&i("div",{className:"flex justify-end items-center mt-8",children:[s("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>l(!1),children:"ยกเลิก"}),s("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:a.id?t("save"):t("add")})]})]})})})]})})})})]})})]})};export{Xe as default};
