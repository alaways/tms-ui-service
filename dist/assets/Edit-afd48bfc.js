import{j as e,F as de,f as r,an as De,u as Le,a as Re,r as s,s as Ue,b as Me,i as P,c as v,t as _,am as Oe,g as S}from"./index-a90aa29c.js";import{c as I,a as d,d as Fe,b as He}from"./object-7405de1d.js";import{S as ae}from"./sweetalert2.all-ca2d1030.js";import{T as re}from"./tippy-react.esm-150a8dd6.js";import{u as je,G as Be,M as Ge}from"./esm-fca376a3.js";import{t as Ve,d as qe,g as Ke}from"./constant-e85f1578.js";import{N as ie}from"./regex-a1235873.js";import{F as D,a as L}from"./formik.esm-c4fd04ca.js";import{I as n}from"./InputField-d7971719.js";import{S as h}from"./SelectField-917481a8.js";import{u as We,a as ze}from"./useProvincesMutation-f0b4cb29.js";import{u as se,a as Ye}from"./useShopMutation-084b0c2e.js";import{B as Xe}from"./breadcrumbs-b9914bbc.js";import{P as $e}from"./preLoading-b2445d9d.js";import{I as Je}from"./IconX-54a3093e.js";import{I as ne}from"./IconEdit-bf2b08f0.js";import{I as Ze}from"./IconTrashLines-902954df.js";/* empty css              */import{d as Qe}from"./formatNumeric-862380d6.js";import{L as et}from"./List-d89e4870.js";import{$ as c}from"./tabs-dd3b1363.js";import{q as R,_ as oe}from"./transition-d4ca4cfa.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./lodash-f7ec5310.js";import"./index-2f30bf27.js";import"./IconPlus-4c7e79c8.js";import"./config-8de56c22.js";import"./keyboard-f171a3e5.js";import"./use-resolve-button-type-789d628c.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const tt=({className:f,fill:p=!1,duotone:u=!0})=>e(de,{children:p?r("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:f,style:{display:"inline-block"},children:[e("circle",{opacity:"0.5",cx:"12",cy:"12",r:"10",stroke:u?"currentColor":"white",strokeWidth:"1.5"}),e("path",{d:"M8.5 12.5L10.5 14.5L15.5 9.5",stroke:u?"currentColor":"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:u?"currentColor":"white"})]}):r("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:f,style:{display:"inline-block"},children:[e("circle",{opacity:"0.5",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"1.5"}),e("path",{d:"M8.5 12.5L10.5 14.5L15.5 9.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),le={id_bank:"",bank_account_name:"",bank_account_number:"",is_main_account:!1},at="admin",Bt=()=>{var J,Z,Q,ee;const{id:f}=De(),p=ae.mixin(Ve),u=Le(),A=Re(),g=localStorage.getItem(at),E=g?JSON.parse(g).role:null,U=g?JSON.parse(g).email:null;let M=!1;(U=="dev@tplus.co.th"||U=="admin258@tplus.co.th")&&(M=!0);const[O,b]=s.useState(!1);E!=="admin"&&E!=="business_unit"&&u("/"),s.useEffect(()=>{A(Ue("ข้อมูลร้านค้า")),A(Me(["shop","/apps/shop/list"]))});const i=P(t=>t.pageStore.pageAction)!=="edit",ce=[{to:"/apps/shop/list",label:"ร้านค้า"},{label:i?"ข้อมูล":"แก้ไข",isCurrent:!0}],[pe,rt]=s.useState({username:"",password:"",password_repeat:"",tax_id:"",name:"",contact_name:"",phone_number:"",line_id:"",facebook_id:"",website:"",email:"",address:"",id_province:"",id_district:"",id_subdistrict:"",zip_code:"",latitude:"",longitude:"",is_active:!0,is_approved:!0,is_create_customer:!0,is_create_refinance:!1}),[y,F]=s.useState(qe),me=P(t=>t.dataStore.provinces),m=P(t=>t.dataStore.shop),[H,ue]=s.useState([]),[j,k]=s.useState([]),[B,he]=s.useState(pe),[x,G]=s.useState(le),[be,V]=s.useState([]),[_e,fe]=s.useState([]),{isLoaded:q}=je({googleMapsApiKey:Ke}),{mutate:ge,isLoading:ye,isError:ke}=se({onSuccess:t=>{const a=t.data;a.password="",a.password_repeat="",V((a==null?void 0:a.shop_banks)??[]),K({id:a==null?void 0:a.id_province,type:"id_province"}),W({id:a==null?void 0:a.id_district,type:"id_district"}),he(l=>({...l,...a,id:m.id})),a.latitude&&a.longitude&&F({lat:parseFloat(a.latitude),lng:parseFloat(a.longitude)})}}),{mutate:N}=se({onSuccess:t=>{const a=t.data;V((a==null?void 0:a.shop_banks)??[])}}),{mutate:K}=We({onSuccess:(t,a)=>{const l=t.data.map(o=>({value:o.id,label:o.name_th}));switch(a.type){case"id_province":ue(l);break}},onError:t=>{}}),{mutate:W}=ze({onSuccess:(t,a)=>{const l=t.data.map(o=>({value:o.id,label:o.name_th,zipCode:o.zip_code}));switch(a.type){case"id_district":k(l);break}},onError:t=>{}}),{mutate:z,isLoading:w}=Ye({onSuccess:t=>{t.statusCode===200||t.code===200?(p.fire({icon:"success",title:"แก้ไขสำเร็จ",padding:"10px 20px"}),u("/apps/shop/list")):p.fire({icon:"error",title:t.error,padding:"10px 20px"})}}),{mutate:xe}=v(S.bankFindAll,{onSuccess:t=>{fe(t.data.map(a=>({value:a.id,label:a.name})))}}),{mutate:Y}=v(S.shopAddBank,{onSuccess:t=>{t.statusCode===200||t.code===200?(p.fire({icon:"success",title:"เพิ่มสำเร็จ",padding:"10px 20px"}),N({data:{id:m.id}})):p.fire({icon:"error",title:t.message,padding:"10px 20px"})}}),{mutate:X}=v(S.shopUpdateBank,{onSuccess:t=>{t.statusCode===200||t.code===200?(p.fire({icon:"success",title:"แก้ไขสำเร็จ",padding:"10px 20px"}),N({data:{id:m.id}})):p.fire({icon:"error",title:t.message,padding:"10px 20px"})}}),{mutate:ve}=v(S.shopDeleteBank,{onSuccess:t=>{t.statusCode===200||t.code===200?(p.fire({icon:"success",title:"ลบสำเร็จ",padding:"10px 20px"}),N({data:{id:m.id}})):p.fire({icon:"error",title:t.message,padding:"10px 20px"})}});s.useEffect(()=>{xe({data:{page:1,pageSize:-1}}),ge({data:{id:f||m.id}})},[]);const C=(t,a,l)=>{const o=(Pe,Ie)=>{Pe.forEach(T=>t.setFieldValue(T,null)),Ie.forEach(T=>T([]))},te={id_province:()=>{K({id:a.value,type:l}),o(["id_district","id_subdistrict"],[k,k])},id_district:()=>{W({id:a.value,type:l}),o(["id_subdistrict"],[k])},id_subdistrict:()=>{t.setFieldValue("zip_code",parseInt(a.zipCode))}};te[l]&&te[l]()},$=s.useCallback(t=>{w||z({data:t,tax_id:t.tax_id})},[z]),Se=s.useCallback(t=>{t!=null&&t.id?X({data:{id:t.id,id_bank:t.id_bank,id_shop:m.id,bank_account_name:t.bank_account_name,bank_account_number:t.bank_account_number,is_main_account:t.is_main_account||!1,is_active:!0}}):Y({data:{id_bank:t.id_bank,id_shop:m.id,bank_account_name:t.bank_account_name,bank_account_number:t.bank_account_number,is_main_account:t.is_main_account||!1,is_active:!0}}),b(!1)},[X,Y,m]),Ae=(t,a)=>{t.setFieldValue("latitude",a.latLng.lat().toString()),t.setFieldValue("longitude",a.latLng.lng().toString()),F({lat:a.latLng.lat(),lng:a.latLng.lng()})},Ee=I().shape({username:d().required("กรุณาใส่ข้อมูลให้ครบ"),name:d().required("กรุณาใส่ข้อมูลให้ครบ"),tax_id:d().required("กรุณาใส่ข้อมูลให้ครบ").matches(ie,"ใส่ได้เฉพาะตัวเลข").length(13,"กรุณาใส่ข้อมูลให้ครบ 13 หลัก"),contact_name:d().required("กรุณาใส่ข้อมูลให้ครบ"),id_province:d().required("กรุณาใส่ข้อมูลให้ครบ"),id_district:d().required("กรุณาใส่ข้อมูลให้ครบ"),id_subdistrict:d().required("กรุณาใส่ข้อมูลให้ครบ"),email:d().email("กรุณาใส่อีเมลที่ถูกต้อง").required("กรุณาใส่ข้อมูลให้ครบ")}),Ne=I().shape({password_repeat:d().oneOf([Fe("password"),null],"รหัสผ่านไม่ตรงกัน")}),we=I().shape({bank_account_name:d().required("กรุณาใส่ข้อมูลให้ครบ"),id_bank:d().required("กรุณาใส่ข้อมูลให้ครบ"),bank_account_number:d().required("กรุณาใส่ข้อมูลให้ครบ").matches(ie,"ใส่ได้เฉพาะตัวเลข"),is_main_account:He().required("กรุณาใส่ข้อมูลให้ครบ")}),Ce=()=>{A(Oe("edit"))},Te=()=>{u("/apps/shop/report/"+m.id)};return r(de,{children:[(!q||ye||ke)&&e($e,{}),r("div",{className:"flex items-center justify-between flex-wrap",children:[e(Xe,{items:ce}),r("div",{className:"flex",children:[i&&e("a",{className:"hover:text-info cursor-pointer btn btn-success mr-1",onClick:()=>Te(),children:"รายงานผลตอบแทน"}),i&&r("a",{className:"hover:text-info cursor-pointer btn btn-primary mr-1",onClick:()=>Ce(),children:[e(ne,{className:"w-4.5 h-4.5"}),"   แก้ไข"]})]})]}),e("div",{className:"flex xl:flex-row flex-col gap-2.5 mt-3",children:r("div",{className:"panel px-6 flex-1 py-6 rtl:xl:ml-6",children:[e("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"บัญชีร้านค้า"}),e("div",{children:r(c.Group,{children:[r(c.List,{className:"mt-3 flex flex-wrap border-b border-white-light dark:border-[#191e3a]",children:[e(c,{as:s.Fragment,children:({selected:t})=>e("button",{className:`${t?"!border-white-light !border-b-white  text-themePrimary !outline-none dark:!border-[#191e3a] dark:!border-b-black":""} dark:hover:border-b-black' -mb-[1px] block border border-transparent p-3.5 py-2 hover:text-themePrimary`,children:"บัญชีร้านค้า"})}),!((J=_.features)!=null&&J.shop_user)&&e(c,{as:s.Fragment,children:({selected:t})=>e("button",{className:`${t?"!border-white-light !border-b-white  text-themePrimary !outline-none dark:!border-[#191e3a] dark:!border-b-black":""} dark:hover:border-b-black' -mb-[1px] block border border-transparent p-3.5 py-2 hover:text-themePrimary`,children:"บัญชีผู้ใช้งาน"})}),e(c,{as:s.Fragment,children:({selected:t})=>e("button",{className:`${t?"!border-white-light !border-b-white  text-themePrimary !outline-none dark:!border-[#191e3a] dark:!border-b-black":""} dark:hover:border-b-black' -mb-[1px] block border border-transparent p-3.5 py-2 hover:text-themePrimary`,children:"บัญชีธนาคาร"})}),((Z=_.features)==null?void 0:Z.shop_user)&&e(c,{as:s.Fragment,children:({selected:t})=>e("button",{className:`${t?"!border-white-light !border-b-white  text-themePrimary !outline-none dark:!border-[#191e3a] dark:!border-b-black":""} dark:hover:border-b-black' -mb-[1px] block border border-transparent p-3.5 py-2 hover:text-themePrimary`,children:"พนักงาน"})})]}),r(c.Panels,{children:[e(c.Panel,{children:e(D,{initialValues:B,onSubmit:$,enableReinitialize:!0,autoComplete:"off",validationSchema:Ee,children:t=>r(L,{className:"space-y-5 dark:text-white",children:[r("div",{className:"mt-6",children:[e("div",{className:"input-flex-row",children:e("div",{className:"check-container",children:e(n,{label:"เลขประจำตัวผู้เสียภาษี",name:"tax_id",type:"text",disabled:i,maxLength:13,onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()}})})}),e("hr",{className:"mt-4"}),r("div",{className:"input-flex-row mt-4",children:[e(n,{label:"ชื่อร้าน",name:"name",type:"text",disabled:i}),e(n,{label:"ชื่อผู้ติดต่อ",name:"contact_name",type:"text",disabled:i})]}),r("div",{className:"input-flex-row",children:[e(n,{label:"เบอร์โทรศัพท์",name:"phone_number",type:"text",disabled:i}),e(n,{label:"Line ID",name:"line_id",type:"text",disabled:i})]}),r("div",{className:"input-flex-row",children:[e(n,{label:"Facebook ID",name:"facebook_id",type:"text",disabled:i}),e(n,{label:"เว็บไซต์",name:"website",type:"text",disabled:i})]}),e("div",{className:"input-flex-row",children:e(n,{label:"อีเมล",name:"email",type:"text",disabled:i})}),r("div",{className:"input-flex-row",children:[e(n,{label:"ที่อยู่",name:"address",as:"textarea",rows:"1",placeholder:"กรุณาใส่ข้อมูล",className:"form-textarea ltr:rounded-l-none rtl:rounded-r-none resize-none",disabled:i}),e(h,{label:"จังหวัด",id:"id_province",name:"id_province",placeholder:"กรุณาเลือก",isSearchable:!1,disabled:i,options:me,onChange:a=>{C(t,a,"id_province")}})]}),r("div",{className:"input-flex-row",children:[e(h,{require:!0,label:"อำเภอ/เขต",id:"id_district",name:"id_district",placeholder:"กรุณาเลือก",isSearchable:!1,options:H,disabled:H.length===0||i,onChange:a=>{C(t,a,"id_district")}}),e(h,{require:!0,label:"ตำบล/แขวง",id:"id_subdistrict",name:"id_subdistrict",placeholder:"กรุณาเลือก",options:j,isSearchable:!1,disabled:j.length===0||i,onChange:a=>{C(t,a,"id_subdistrict")}})]}),r("div",{className:"input-flex-row",children:[e(n,{label:"รหัสไปรษณีย์",name:"zip_code",as:"textarea",rows:"1",disabled:!0}),e("div",{className:"blank-container"})]}),r("div",{className:"input-flex-row",children:[e(n,{label:"Latitude",name:"latitude",type:"text",disabled:!0}),e(n,{label:"Longitude",name:"longitude",type:"text",disabled:!0})]}),r("div",{className:"input-flex-row",children:[e(h,{require:!0,label:"สร้างลูกค้า",id:"is_create_customer",name:"is_create_customer",placeholder:"กรุณาเลือก",options:[{value:!1,label:"ปิด"},{value:!0,label:"เปิด"}],isSearchable:!1,disabled:i}),E=="admin"&&M==!0&&e(h,{require:!0,label:"สร้างสัญญารีไฟแนนซ์",id:"is_create_refinance",name:"is_create_refinance",placeholder:"กรุณาเลือก",options:[{value:!1,label:"ปิด"},{value:!0,label:"เปิด"}],isSearchable:!1,disabled:i})]}),e("div",{className:"input-flex-row mb-3",children:q&&e(Be,{zoom:13,center:y,mapContainerStyle:{marginTop:"15px",height:"400px",width:"100%"},onClick:a=>i?null:Ae(t,a),children:y&&e(Ge,{position:{lat:y.lat,lng:y.lng}})})})]}),!i&&r("button",{type:"submit",className:"btn !mt-6 w-full border-0 btn-primary",children:[w&&e("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-5 h-5 ltr:mr-4 rtl:ml-4 inline-block align-middle"}),"แก้ไข"]})]})})}),!((Q=_.features)!=null&&Q.shop_user)&&e(c.Panel,{children:e(D,{initialValues:B,onSubmit:$,enableReinitialize:!0,autoComplete:"off",validationSchema:Ne,children:t=>r(L,{children:[e("div",{className:"mt-6",children:e("div",{className:"border border-white-light dark:border-[#1b2e4b] group rounded-md",children:r("div",{className:"px-5 pb-5",children:[e("div",{className:"input-flex-row",children:e(n,{label:"ชื่อผู้ใช้งาน",name:"username",type:"text",disabled:i})}),!i&&r("div",{className:"input-flex-row",children:[e(n,{label:"รหัสผ่าน",name:"password",type:"password"}),e(n,{label:"ยืนยันรหัสผ่าน",name:"password_repeat",type:"password"})]})]})})}),!i&&r("button",{type:"submit",className:"btn !mt-6 w-full border-0 btn-primary",children:[w&&e("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-5 h-5 ltr:mr-4 rtl:ml-4 inline-block align-middle"}),"แก้ไข"]})]})})}),e(c.Panel,{children:e("div",{className:"mt-6 border border-white-light dark:border-[#1b2e4b] group rounded-md",children:r("div",{className:"p-5",children:[e("button",{type:"button",className:"btn bg-[#002a42] text-white w-full border-0 uppercase shadow-[0_10px_20px_-10px_rgba(67,97,238,0.44)]",onClick:()=>{G(le),b(!0)},children:"เพิ่มบัญชีธนาคาร"}),e("div",{className:"panel p-0 mt-5 border-0 overflow-hidden",children:e("div",{className:"table-responsive",children:r("table",{className:"table-striped table-hover",children:[e("thead",{children:r("tr",{children:[e("th",{children:"ลำดับ"}),e("th",{children:"ชื่อบัญชีธนาคาร"}),e("th",{children:"ธนาคาร"}),e("th",{children:"เลขบัญชีธนาคาร"}),e("th",{className:"!text-center",children:"บัญชีหลัก"}),e("th",{className:"!text-center",children:"Actions"})]})}),e("tbody",{children:be.map((t,a)=>{var l;return r("tr",{children:[e("td",{children:e("div",{className:"flex items-center w-max",children:e("div",{children:a+1})})}),e("td",{children:t==null?void 0:t.bank_account_name}),e("td",{children:(l=t==null?void 0:t.bank)==null?void 0:l.name}),e("td",{children:Qe(t==null?void 0:t.bank_account_number)}),e("td",{className:"text-center text-green",children:(t==null?void 0:t.is_main_account)==!0?e(tt,{}):""}),e("td",{children:r("div",{className:"flex gap-4 items-center w-max mx-auto",children:[e(re,{content:"แก้ไข",theme:"Primary",children:e("a",{className:"flex hover:text-info cursor-pointer",onClick:()=>{var o;G({...t,id_bank:(o=t==null?void 0:t.bank)==null?void 0:o.id}),b(!0)},children:e(ne,{className:"w-4.5 h-4.5"})})}),e(re,{content:"ลบ",theme:"Primary",children:e("button",{type:"button",className:"flex hover:text-info cursor-pointer",onClick:()=>{ae.fire({title:"ยืนยันการลบบัญชีธนาคาร",text:"คุณต้องการลบบัญชีธนาคารนี้ใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:_.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",reverseButtons:!0}).then(o=>{o.isConfirmed&&ve({data:{id:t.id}})})},children:e(Ze,{})})})]})})]},t.id)})})]})})})]})})}),((ee=_.features)==null?void 0:ee.shop_user)&&e(c.Panel,{children:e(et,{})})]})]})})]})}),e(R,{appear:!0,show:O,as:s.Fragment,children:r(oe,{as:"div",open:O,className:"relative z-[51]",onClose:()=>b(!1),children:[e(R.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0 bg-[black]/60"})}),e("div",{className:"fixed inset-0 overflow-y-auto",children:e("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:e(R.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:r(oe.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",style:{minHeight:"550px"},children:[e("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>b(!1),children:e(Je,{})}),e("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"บัญชีธนาคาร"}),e("div",{className:"p-5",children:e(D,{initialValues:x,onSubmit:Se,enableReinitialize:!0,autoComplete:"off",validationSchema:we,children:t=>r(L,{className:"space-y-5 dark:text-white custom-select",children:[e(n,{label:"ชื่อบัญชีธนาคาร",name:"bank_account_name",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),e(h,{label:"ธนาคาร",id:"id_bank",name:"id_bank",options:_e,placeholder:"กรุณาเลือก",isSearchable:!0}),e(n,{label:"เลขบัญชีธนาคาร",name:"bank_account_number",type:"text",placeholder:"กรุณาใส่ข้อมูล",maxLength:20,onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()}}),e(h,{label:"บัญชีหลัก",id:"is_main_account",name:"is_main_account",options:[{label:"ใช่",value:!0},{label:"ไม่ใช่",value:!1}],placeholder:"กรุณาเลือก",isSearchable:!0}),r("div",{className:"flex justify-end items-center mt-8",children:[e("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>b(!1),children:"ยกเลิก"}),e("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:x!=null&&x.id?"บันทึก":"เพิ่ม"})]})]})})})]})})})})]})})]})};export{Bt as default};
