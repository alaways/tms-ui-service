import{an as q,ao as z,u as X,r as l,c as h,f as s,F as I,j as t,N as J,q as Z,m as Q,g}from"./index-a90aa29c.js";import{F as ee,a as te,c as ae,u as se,E as ne}from"./formik.esm-c4fd04ca.js";import{I as d}from"./InputField-d7971719.js";import{S as re}from"./SelectField-917481a8.js";import{S as oe}from"./sweetalert2.all-ca2d1030.js";import{c as P,a as D,f as ie}from"./object-7405de1d.js";import{S as le}from"./react-select.esm-b46d9623.js";import{r as pe}from"./helpFunction-19eb552d.js";import{_ as ce}from"./index-f89ea186.js";import{t as de}from"./constant-e85f1578.js";import{c as me}from"./formatDate-4e046265.js";import{B as _e}from"./breadcrumbs-b9914bbc.js";import{a as ue}from"./useUploadMutation-785f6dd6.js";import{P as he}from"./preLoading-b2445d9d.js";import{F as ge}from"./DatePickerTime-6f9990ef.js";import"./lodash-f7ec5310.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./flatpickr-2301360e.js";const be="admin",Ve=()=>{const b=oe.mixin(de),{id:x}=q(),[y,ye]=z(),N=X(),E=localStorage.getItem(be),k=E?JSON.parse(E).name:null,p=y.get("id_shop"),o=y.get("id_business_unit");y.get("price");const C=[{to:`/apps/report/account-creditor?id_business_unit=${o}&id_shop=${p}`,label:"บัญชีเจ้าหนี้ร้านค้า"},{label:"ชำระเงินให้ร้านค้า",isCurrent:!0}],[R,v]=l.useState(!1),[U,fe]=l.useState(!1),[f,O]=l.useState([]);l.useState();const[A,S]=l.useState({shop_name:"",bank_account_number:null,userChanged:k,created_at:me([new Date]),remark:"",amount:"",payed_at:null}),[M,w]=l.useState([]),L=P().shape({bank_account_number:P().nullable().shape({value:D().required("กรุณาใส่ข้อมูลให้ครบ")}).required("กรุณาใส่ข้อมูลให้ครบ"),amount:D().required("กรุณาใส่ข้อมูลให้ครบ"),payed_at:ie().nullable().required("กรุณาใส่ข้อมูลให้ครบ")}),H=({field:a,form:e,options:n,className:r})=>{const[m,c]=se(a.name),u=c.touched&&c.error,_=i=>{e.setFieldValue(a.name,i)};return s("div",{className:"flex flex-col w-full",children:[t(le,{options:n,value:a.value,onChange:_,components:{DropdownIndicator:Z},placeholder:"เลือกธนาคาร",isSearchable:!1,className:`w-full ${r}`,classNames:{control:({isFocused:i})=>`${i?"!border-blue-500":null} ${u?"!border-red-500":"border"}   !rounded-xl shadow-sm p-4 w-full !cursor-pointer`,menu:()=>"bg-white border rounded-lg shadow-md mt-1 !cursor-pointer",option:({isFocused:i})=>i?"bg-gray-100 p-2 !cursor-pointer":"p-2 !cursor-pointer"}}),t(ne,{name:a.name,component:"div",className:"text-red-500 text-sm mt-1"})]})},{mutate:j}=h(g.shopPaymentPayload,{onSuccess:a=>{if(a.code==200&&a.statusCode==200){S(n=>({...n,...a.data}));const e=a.data.banks.map(n=>{const m=n.name.split(" -"),c=m[0].trim(),u=m[1].trim().split(" ")[0],_=m[1].trim().split(" (")[1].replace(")","");return{value:n.name,label:s("div",{className:"flex items-center gap-10",children:[s("div",{className:"",children:[t("p",{children:"ธนาคาร"}),t("p",{className:"text-gray-800 font-medium",children:c})]}),s("div",{children:[t("p",{children:"เลขที่บัญชี"}),t("p",{className:"text-sm text-gray-800",children:u})]}),s("div",{children:[t("p",{children:"ชื่อบัญชี"}),t("p",{className:"text-sm text-gray-800",children:_})]})]})}});w(e)}},onError:a=>{}}),{mutateAsync:F}=h(g.shopMakePayment,{onSuccess:a=>a,onError:a=>{}}),{mutateAsync:G}=ue({onSuccess:a=>a,onError:a=>{}}),{mutateAsync:B}=h(g.addSlipPayment,{onSuccess:a=>{b.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px"}),N(`/apps/report/account-creditor?id_business_unit=${o}&id_shop=${p}`)},onError:a=>{}}),{mutateAsync:V}=h(g.shopPaymentDashboardFindAll,{onSuccess:a=>{S(e=>({...e,amount:a.data.os_balance}))},onError:()=>{console.error("Failed to fetch asset type data")}}),K=async(a,e)=>{const n=await pe(a);O(n)},W=()=>{b.fire({icon:"error",title:"รูปภาพเกิน 10 รูป",padding:"10px 20px"})},Y=async a=>{if(f.length==0)b.fire({icon:"error",title:"กรุณาเพิ่มหลักฐานการโอนเงิน",padding:"10px 20px"});else{v(!0);const e={...a,payment_method:"cash",payment_gateway:"bank",bank_account_number:a.bank_account_number.value,amount:+a.amount,payed_at:Q(a.payed_at[0]).tz("Asia/Bangkok").format(),id_shop:p,...o&&{id_business_unit:+o}},n=await F({data:e}),r=await G({data:{file:f[0].file,type:"slip-pv"}});await B({data:{id_payment:n.data.id,image_url:r.data.file_name}}),v(!1)}};return l.useEffect(()=>{if(j({data:{id_shop:x}}),o&&p){const a=new Date(2022,0,1).toISOString(),e=new Date;e.setHours(23,59,59,999),V({data:{id_business_unit:+o,id_shop:p,start_at:a,end_at:e.toISOString()}})}},[]),s(I,{children:[t(_e,{items:C}),(R||U)&&t(he,{}),s("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:[t("h5",{className:"my-3 text-2xl font-semibold ltr:sm:text-left rtl:sm:text-right text-center flex flex-row justify-between",children:"แบบฟอร์มชำระเงินให้ร้านค้า"}),t(ee,{initialValues:A,onSubmit:Y,validationSchema:L,enableReinitialize:!0,children:({setFieldValue:a})=>s(te,{className:"flex flex-col gap-4",children:[t("div",{className:"flex gap-4",children:t(d,{name:"shop_name",label:"ร้านค้า",disabled:!0})}),s("div",{className:"flex gap-4",children:[t(d,{name:"userChanged",label:"ผู้ดำเนินการ",disabled:!0}),t(d,{name:"created_at",label:"วันที่สร้าง",disabled:!0})]}),t("hr",{}),t("h5",{className:"text-lg font-semibold",children:"รับชำระเงิน"}),s("div",{className:"flex gap-4",children:[t(d,{require:!0,name:"amount",label:"ยอดชำระเงิน",onKeyDown:e=>{e.ctrlKey&&e.key==="a"||(!/[0-9]/.test(e.key)&&e.key!=="Backspace"&&e.key!=="Tab"&&e.key!=="."&&e.preventDefault(),e.key==="."&&(e.target.value===""||e.target.value.includes("."))&&e.preventDefault())},onChange:e=>{if(+e.target.value>A.amount)a("amount",A.amount);else if(e.target.value.includes(".")){let[n,r]=e.target.value.split(".");r.length>2&&(r=r.slice(0,2)),a("amount",n+"."+r)}else a("amount",e.target.value)}}),t(re,{name:"payment_type",id:"payment_type",label:"ช่องทางการชำระเงิน",options:[{value:"cash",label:"เงินสด"}]})]}),s("div",{className:"flex gap-4",children:[t(d,{name:"reference",label:"หมายเลขอ้างอิง"}),t(ge,{require:!0,label:"วันที่และเวลาที่ชำระ",name:"payed_at",onChange:e=>{a("payed_at",e)}})]}),s("div",{className:"w-full flex gap-4 custom-select",children:[t(ae,{name:"bank_account_number",component:H,options:M}),t("div",{className:"w-full"})]}),s("div",{className:"w-full flex gap-4",children:[t("div",{className:"w-full",children:t(d,{name:"remark",label:"หมายเหตุ"})}),t("div",{className:"w-full"})]}),s("div",{className:"flex flex-col gap-2",children:[t("p",{children:"หลักฐานการโอนเงิน"}),t(ce,{multiple:!0,value:f,onChange:K,onError:W,maxNumber:1,children:({imageList:e,onImageUpload:n,onImageRemoveAll:r,onImageUpdate:m,onImageRemove:c,isDragging:u,dragProps:_})=>t("div",{className:"relative",children:s("div",{className:`${e.length==0?"cursor-pointer":null} border min-h-[200px] bg-violet-100/40 rounded-xl  flex flex-col items-center justify-center gap-2`,onClick:e.length==0?n:void 0,..._,children:[e.length==0&&s(I,{children:[s("p",{children:[t("span",{className:"text-violet-500 font-semibold",children:"Click to Upload"})," or drug and drop"]}),t("p",{children:"SVG, PNG, JPG OR GIF"})]}),t("div",{className:"flex flex-wrap gap-4",children:e==null?void 0:e.map((i,T)=>s("div",{className:"relative",children:[t("button",{type:"button",className:"custom-file-container__image-clear bg-dark-light dark:bg-dark dark:text-white-dark rounded-full block w-fit p-1 absolute top-0 right-0 z-10",title:"Clear Image",onClick:$=>{$.stopPropagation(),c(T)},children:"×"}),t("img",{src:i.dataURL,alt:"img",className:"w-auto h-[180px]"})]},T))})]})})})]}),s("div",{className:"flex gap-4 justify-center",children:[t(J,{to:`/apps/report/account-creditor?id_business_unit=${o}&id_shop=${p}`,className:"px-4 py-2 rounded-md border border-black/50 text-black",children:"ยกเลิก"}),t("button",{type:"submit",className:"px-4 py-2 rounded-md bg-violet-600 text-white ",children:"บันทึก"})]})]})})]})]})};export{Ve as default};
