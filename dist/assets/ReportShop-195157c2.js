import{a as X,u as Q,r as o,s as q,c as U,h as c,f as r,F as J,j as s,v as ee,g as M}from"./index-a90aa29c.js";import{Q as te}from"./index-2f30bf27.js";import{u as se}from"./useShopMutation-084b0c2e.js";import{F as ae,a as ne}from"./formik.esm-c4fd04ca.js";import{F as k}from"./DatePicker-5cf5930a.js";import{I as re}from"./IconRefresh-fed8c080.js";import{S as ie}from"./react-select.esm-b46d9623.js";import{S as L}from"./Spinner-5dd45779.js";import{c as O,b as Y}from"./formatDate-4e046265.js";import{n as d}from"./formatNumeric-862380d6.js";import"./floating-ui.dom-0aeb9e8a.js";import"./flatpickr-2301360e.js";import"./createSuper-98fcd92d.js";import"./index-8d8bdff8.js";const oe="admin",Te=()=>{var y,N,I,P,C,R;const A=X(),w=Q(),v=localStorage.getItem(oe),h=v?JSON.parse(v).id_shop:null,[u,b]=o.useState(null),[S,j]=o.useState([]);o.useEffect(()=>{A(q("ข้อมูลร้านค้า"))},[A]);const[l,H]=o.useState(null),[f,le]=o.useState(!1),[m,B]=o.useState({count_item:0,total_commission:0,total_down_payment:0,total_price:0,total_amount:0,total_fee:0}),[i,G]=o.useState([]),E=[10,20,30,50,100],[p,T]=o.useState(1),[_,z]=o.useState(E[0]),[F,V]=o.useState(0),{mutate:x,isLoading:K}=se({onSuccess:e=>{H(e.data)},onError:e=>{}}),[D,W]=o.useState([]),{mutate:Z}=U(M.announceShopGetData,{onSuccess:e=>{W(e.data)},onError:e=>{}});o.useEffect(()=>{x({data:{id:h}})},[x]);const{mutate:g}=U(M.getCommissionPV,{onSuccess:e=>{e.data!==void 0&&(G(e.data.list),B(e.data.summary),V(e.data.total))},onError:()=>{console.error("Failed to fetch status data")}});o.useEffect(()=>{l&&(Z({}),j(l.shop_group_relations.map(e=>({value:e.business_unit.id,label:e.business_unit.name}))))},[l]),o.useEffect(()=>{var e,t,a;if(l){const n=((a=(t=(e=l.shop_group_relations)==null?void 0:e[0])==null?void 0:t.business_unit)==null?void 0:a.id)||null;g({data:{id_shop:h,id_business_unit:n,page:p,page_size:_,start_at:`${c.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`,end_at:`${c.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`}})}},[l,g,p,_]);const $=e=>{w("/apps/contract/"+e.id+"/"+e.uuid)};return K?"...loading...":r(J,{children:[D.length>0&&D.map((e,t)=>r("div",{className:"bg-red-200 text-red-500 p-4 mb-3 rounded-lg",children:[s("p",{className:"font-semibold",children:e==null?void 0:e.subject}),s("p",{children:e==null?void 0:e.message})]},t)),s("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:r("div",{className:"invoice-table",children:[r("div",{className:"ml-10 mt-3 text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center flex flex-row justify-between",children:["ร้านค้า ",l==null?void 0:l.name]}),s("div",{className:"p-10",children:r("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-6 gap-6 mb-6 text-white",children:[r("div",{className:"panel bg-gradient-to-r from-cyan-500 to-cyan-400",children:[s("div",{className:"flex justify-between",children:s("div",{className:"ltr:mr-1 rtl:ml-1 text-md font-semibold text-xl",children:"ทุนเช่าซื้อ"})}),s("div",{className:"flex items-center mt-5",children:s("div",{className:"text-3xl font-bold ltr:mr-3 rtl:ml-3",children:((y=m.total_principle)==null?void 0:y.toLocaleString())||"0"})})]}),r("div",{className:"panel bg-gradient-to-r from-violet-500 to-violet-400",children:[s("div",{className:"flex justify-between",children:s("div",{className:"ltr:mr-1 rtl:ml-1 text-md font-semibold text-xl",children:"ค่านายหน้า"})}),s("div",{className:"flex items-center mt-5",children:s("div",{className:"text-3xl font-bold ltr:mr-3 rtl:ml-3",children:((N=m.total_commission)==null?void 0:N.toLocaleString())||"0"})})]}),r("div",{className:"panel bg-gradient-to-r from-blue-500 to-blue-400",children:[s("div",{className:"flex justify-between",children:s("div",{className:"ltr:mr-1 rtl:ml-1 text-md font-semibold text-xl",children:"รวมเป็นเงิน"})}),s("div",{className:"flex items-center mt-5",children:s("div",{className:"text-3xl font-bold ltr:mr-3 rtl:ml-3",children:((I=m.total_amount)==null?void 0:I.toLocaleString())||"0"})})]}),r("div",{className:"panel bg-gradient-to-r from-fuchsia-500 to-fuchsia-400",children:[s("div",{className:"flex justify-between",children:s("div",{className:"ltr:mr-1 rtl:ml-1 text-md font-semibold text-xl",children:"ค่าทำสัญญา"})}),s("div",{className:"flex items-center mt-5",children:s("div",{className:"text-3xl font-bold ltr:mr-3 rtl:ml-3",children:((P=m.total_fee)==null?void 0:P.toLocaleString())||"0"})})]}),r("div",{className:"panel bg-gradient-to-r from-yellow-500 to-yellow-400",children:[s("div",{className:"flex justify-between",children:s("div",{className:"ltr:mr-1 rtl:ml-1 text-md font-semibold text-xl",children:"คงเหลือให้ร้านค้า"})}),s("div",{className:"flex items-center mt-5",children:s("div",{className:"text-3xl font-bold ltr:mr-3 rtl:ml-3",children:((C=m.total_amount_shop)==null?void 0:C.toLocaleString())||"0"})})]}),r("div",{className:"panel bg-gradient-to-r from-red-500 to-orange-500",children:[s("div",{className:"flex justify-between",children:s("div",{className:"ltr:mr-1 rtl:ml-1 text-md font-semibold text-xl",children:"ราคารวมผ่อน"})}),s("div",{className:"flex items-center mt-5",children:r("div",{className:"text-3xl font-bold ltr:mr-3 rtl:ml-3",children:[" ",((R=m.total_ins_amount)==null?void 0:R.toLocaleString())||"0"]})})]})]})}),s("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:s(ae,{initialValues:{start_at:`${c.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`,end_at:`${c.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`},onSubmit:(e,{resetForm:t})=>{const a=!e.start_at&&!e.end_at;g(a?{data:{id_shop:h,id_business_unit:u,page:p,page_size:_,start_at:`${c.tz(e.start_at,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`,end_at:`${c.tz(e.end_at,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`,status_id:""}}:{data:{id_shop:h,id_business_unit:u,page:p,page_size:_,start_at:`${c.tz(e.start_at,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`,end_at:`${c.tz(e.end_at,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`}})},onReset:()=>{var t,a,n;b(null);const e=((n=(a=(t=l.shop_group_relations)==null?void 0:t[0])==null?void 0:a.business_unit)==null?void 0:n.id)||null;g({data:{id_shop:h,id_business_unit:e,page:p,page_size:_,start_at:`${c.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`,end_at:`${c.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`}})},children:({values:e,setFieldValue:t,handleReset:a})=>r(ne,{className:"flex items-center gap-2",children:[s(k,{label:"วันที่เริ่ม",name:"start_at",onChange:n=>{t("start_at",O(n))}}),s(k,{label:"วันที่สิ้นสุด",name:"end_at",onChange:n=>{t("end_at",O(n))}}),s(ie,{placeholder:"หน่วยธุรกิจ",className:"mt-6 pr-6 z-10 w-[200px]",options:S,isSearchable:!0,value:u?S.find(n=>n.value===u):null,onChange:n=>{b(n.value)}}),r("button",{type:"submit",className:"btn btn-primary gap-2 mt-5",disabled:f||!u,children:[f?s(L,{size:"sm"}):s(ee,{}),"ค้นหา"]}),r("button",{type:"reset",className:"btn btn-info gap-2 mt-5",onClick:()=>{a(),t("start_at",""),t("end_at",""),b(null)},disabled:f,children:[f?s(L,{size:"sm"}):s(re,{}),"ล้างค่า"]})]})})}),s("div",{className:"datatables pagination-padding",children:i.length===0?s("div",{className:"text-center text-gray-500",children:"ไม่พบข้อมูล"}):s(te,{className:"whitespace-nowrap table-hover invoice-table",records:i,columns:[{accessor:"id",title:"เลขที่สัญญา",textAlignment:"center",sortable:!1,render:e=>s("div",{className:"flex justify-center text-center font-normal",children:s("a",{className:"flex cursor-pointer active",onClick:()=>$(e),children:e.reference})})},{accessor:"contract_date",title:"วันที่ทำสัญญา",textAlignment:"left",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return Y(t==null?void 0:t.contract_date)}},{accessor:"approved_at",title:"วันที่อนุมัติสัญญา",textAlignment:"left",sortable:!1,render:e=>Y(e==null?void 0:e.contract_approved_date)},{accessor:"contract_status",title:"สถานะสัญญา",textAlignment:"left",sortable:!1,render:e=>(e==null?void 0:e.contract_status)||"-"},{accessor:"business_unit.name",title:"ชื่อธุรกิจ",textAlignment:"left",sortable:!1,render:e=>{var a;const t=i.find(n=>n.id===e.id);return((a=t==null?void 0:t.business_unit)==null?void 0:a.name)||"0"}},{accessor:"asset.name",title:"ชื่อทรัพย์สิน",textAlignment:"left",sortable:!1,render:e=>{var a;const t=i.find(n=>n.id===e.id);return((a=t==null?void 0:t.asset)==null?void 0:a.name)||"0"}},{accessor:"price",title:"ราคาขาย",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.price)||"0")}},{accessor:"down_payment",title:"เงินดาวน์",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.down_payment)||"0")}},{accessor:"principle",title:"ทุนเช่าซื้อ",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.principle)||"0")}},{accessor:"commission",title:"ค่านายหน้า",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.commission)||"0")}},{accessor:"benefit",title:"ผลตอบแทนพิเศษ",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.benefit)||"0")}},{accessor:"amount",title:"รวมเป็นเงิน",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.amount)||"0")}},{accessor:"fee",title:"ค่าทำสัญญา",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.fee)||"0")}},{accessor:"total",title:"คงเหลือให้ร้านค้า",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.total)||"-")}},{accessor:"total",title:"ราคารวมผ่อน",textAlignment:"right",sortable:!1,render:e=>{const t=i.find(a=>a.id===e.id);return d((t==null?void 0:t.total_ins_amount)||"-")}}],highlightOnHover:!0,totalRecords:F,recordsPerPage:_,page:p,onPageChange:e=>T(e),recordsPerPageOptions:E,onRecordsPerPageChange:e=>{T(1),z(e)},paginationText:({from:e,to:t,totalRecords:a})=>`โชว์ ${e} ถึง ${t} ของ ${a} หน้าทั้งหมด`})})]})})]})};export{Te as default};
