import{an as Mt,r,u as Dt,a as Ht,s as jt,c as x,t as Qe,f as o,F as U,j as t,m as Ft,g as E}from"./index-a90aa29c.js";import{c as Bt,a as P,e as We}from"./object-7405de1d.js";import{S as h}from"./sweetalert2.all-ca2d1030.js";import{r as Vt}from"./helpFunction-19eb552d.js";import{a as R}from"./formatNumeric-862380d6.js";/* empty css                      */import{F as qt,a as Gt}from"./formik.esm-c4fd04ca.js";import{_ as Kt}from"./index-f89ea186.js";import{I as k}from"./InputField-d7971719.js";import{S as Ye}from"./SelectField-917481a8.js";import{t as $t}from"./constant-e85f1578.js";import{B as Qt}from"./breadcrumbs-b9914bbc.js";import{R as Wt}from"./index.es-edddd9ad.js";import{a as D}from"./formatDate-4e046265.js";import{s as L}from"./showNotification-b9615e49.js";import{F as Yt}from"./DatePickerTime-6f9990ef.js";import{a as zt}from"./useUploadMutation-785f6dd6.js";import{_ as Xt}from"./lodash-f7ec5310.js";import{P as Zt}from"./preLoading-b2445d9d.js";import{I as Jt}from"./IconEdit-bf2b08f0.js";import{Q as ea}from"./index-2f30bf27.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./flatpickr-2301360e.js";const ta="admin",wa=()=>{const{ctid:H,uuid:j,inid:F}=Mt(),B=H?Number(H):void 0,V=F?Number(F):void 0,N=j||void 0,[ze,S]=r.useState([]);r.useState([{value:"promptpay",label:"promptpay"}]);const[Xe,Ze]=r.useState([]),[Je,aa]=r.useState([{label:"promptpay",value:"promptpay"},{label:"เงินสด",value:"cash"}]),q=Dt(),et=Ht(),G=localStorage.getItem(ta),K=G?JSON.parse(G).role:null,[v,$]=r.useState([]),b=h.mixin($t),[tt,Q]=r.useState(""),[at,O]=r.useState(!1),[nt,p]=r.useState(!0),[W,st]=r.useState([]);K!="admin"&&K!="business_unit"&&q("/");const[c,Y]=r.useState(!1),it=async()=>{Y(!c)},[i,rt]=r.useState({reference:"",status:"",ins_no:""}),[a,z]=r.useState({due_at:"",isReferenceExists:!1,id_invoice:0,id_payment:"",amount:0,discount:0,penalty_fee:0,penalty_fee_limit:0,unlock_fee:0,total:0,reference:"",remaining_ins:0,bank_account_number:"",payment_method:"",remark:"",payed_at:new Date,payment_slip:[],payment_qr:{}}),ot=[{to:"/apps/contract/list",label:"สัญญา"},{to:!0,label:"แก้ไข"},{label:"รับชำระเงิน",isCurrent:!0}];r.useEffect(()=>{et(jt("รับชำระเงิน"))});const[w,lt]=r.useState(""),[A,ct]=r.useState(""),[C,dt]=r.useState({}),{mutate:mt,isLoading:pt}=x(E.contractClosePreview,{onSuccess:e=>{var n,s,l,d,u,y,f,T,_,g,J,ee,te,ae,ne,se,ie,re,oe,le,ce,de,me,pe,ue,_e,he,ye,be,fe,ge,ve,xe,Ee,ke,Se,Ae,Ne,Ce,Ie,Te,Pe,Re,we,Ue,Le,Oe,Me,De,He,je,Fe,Be,Ve,qe,Ge,Ke,$e;rt({reference:(n=e.data)==null?void 0:n.reference,status:(s=e.data)==null?void 0:s.status,ins_no:(l=e.data)==null?void 0:l.ins_no}),(u=(d=e.data)==null?void 0:d.payment)!=null&&u.reference?(z({...a,due_at:(y=e.data)==null?void 0:y.due_at,...((f=e.data)==null?void 0:f.payment_method)=="cash"&&{bank_account_number:e.data.bank_account_number},id_invoice:(T=e.data)==null?void 0:T.id_invoice,id_payment:(_=e.data)==null?void 0:_.id_payment,amount:(g=e.data)==null?void 0:g.payment.amount,discount:(J=e.data)==null?void 0:J.payment.discount,penalty_fee:(ee=e.data)==null?void 0:ee.payment.penalty_fee,penalty_fee_limit:((te=e.data)==null?void 0:te.penalty_fee_limit)??0,unlock_fee:(ae=e.data)==null?void 0:ae.payment.unlock_fee,total:(ne=e.data)==null?void 0:ne.payment.total,reference:(se=e.data)==null?void 0:se.payment.reference,...((re=(ie=e.data)==null?void 0:ie.payment)==null?void 0:re.payment_method)=="cash"&&{bank_account_number:(oe=e.data)==null?void 0:oe.payment.bank_account_number},...((ce=(le=e.data)==null?void 0:le.payment)==null?void 0:ce.payment_method)!="cash"&&{bank_account_number:"promptpay"},payment_method:(de=e.data)==null?void 0:de.payment.payment_method,remark:(me=e.data)==null?void 0:me.payment.remark,payed_at:(pe=e.data)!=null&&pe.payment.payed_at?D((ue=e.data)==null?void 0:ue.payment.payed_at):new Date,remaining_ins:(_e=e.data)==null?void 0:_e.payment.remaining_ins,isReferenceExists:!0,payment_slip:(he=e.data)==null?void 0:he.payment_slip}),(ye=e.data)!=null&&ye.payment_qr&&(dt(e.data.payment_qr),ct((be=e.data.payment_qr)==null?void 0:be.image),lt((fe=e.data.payment_qr)==null?void 0:fe.expiredate)),((ve=(ge=e.data)==null?void 0:ge.payment)==null?void 0:ve.payment_method)!="cash"?((xe=e.data.payment)==null?void 0:xe.payment_gateway)=="tqr"?S([{value:"promptpay",label:"Thai Qr"}]):S([{value:"promptpay",label:"Pay Solution"}]):S((Ee=e.data)==null?void 0:Ee.business_unit_banks.map(m=>({value:`${m.bank.name} - ${m.bank_account_number}`,label:`${m.bank.name} - ${m.bank_account_number}`}))),st((ke=e.data)==null?void 0:ke.history)):e.statusCode===400||e.code===400?L("พบข้อผิดพลาด ไม่สามารถโหลดข้อมูลได้!","error"):(z({...a,...((Se=e.data)==null?void 0:Se.payment_method)=="cash"&&{bank_account_number:e.data.bank_account_number},amount:(Ne=(Ae=e.data)==null?void 0:Ae.payment)==null?void 0:Ne.amount,discount:(Ie=(Ce=e.data)==null?void 0:Ce.payment)==null?void 0:Ie.discount,penalty_fee:(Pe=(Te=e.data)==null?void 0:Te.payment)==null?void 0:Pe.penalty_fee,penalty_fee_limit:((Re=e.data)==null?void 0:Re.penalty_fee_limit)??0,unlock_fee:(Ue=(we=e.data)==null?void 0:we.payment)==null?void 0:Ue.unlock_fee,total:(Oe=(Le=e.data)==null?void 0:Le.payment)==null?void 0:Oe.total,reference:(Me=e.data)==null?void 0:Me.payment.reference,bank_account_number:(De=e.data)==null?void 0:De.payment.bank_account_number,payment_method:(je=(He=e.data)==null?void 0:He.payment)==null?void 0:je.payment_method,remark:(Be=(Fe=e.data)==null?void 0:Fe.payment)==null?void 0:Be.remark,remaining_ins:(Ve=e.data)==null?void 0:Ve.payment.remaining_ins,payed_at:((Ge=(qe=e.data)==null?void 0:qe.payment)==null?void 0:Ge.payed_at)??new Date,isReferenceExists:!1}),S((Ke=e.data)==null?void 0:Ke.business_unit_banks.map(m=>({value:`${m.bank.name} - ${m.bank_account_number}`,label:`${m.bank.name} - ${m.bank_account_number}`}))),Ze(($e=e.data)==null?void 0:$e.business_unit_banks.map(m=>({value:`${m.bank.name} - ${m.bank_account_number}`,label:`${m.bank.name} - ${m.bank_account_number}`})))),p(!1)},onError:e=>{L(e.message,"error"),p(!1)}}),{mutate:ut}=x(E.paymentCheckStatus,{onSuccess:e=>{var n,s;((n=e.data)==null?void 0:n.status)=="cancel"?h.fire({icon:"error",title:"ยกเลิกชำระเงิน",padding:"10px 20px"}).then(()=>{setTimeout(()=>{window.location.reload()},3e3)}):((s=e.data)==null?void 0:s.status)=="complete"&&h.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px"}).then(()=>{window.location.reload()})},onError:e=>{L(e.message,"error"),p(!1)}});r.useEffect(()=>{if(C!=null&&C.id_payment){const e=setInterval(async()=>{try{ut({data:{id_contract:N,type:"close_contract"}})}catch(n){console.error("Error checking payment status:",n)}},1e4);return()=>clearInterval(e)}},[C]);const _t=Bt().shape({payed_at:P().nullable().required("กรุณาใส่เลือกวันที่"),bank_account_number:P().required("กรุณาใส่ข้อมูลให้ครบ"),amount:P().required("กรุณาใส่ข้อมูลให้ครบ"),...(a==null?void 0:a.penalty_fee_limit)>0?{penalty_fee:We().max(a==null?void 0:a.penalty_fee_limit,`ค่าดำเนินการล่าช้าไม่เกิน ${a==null?void 0:a.penalty_fee_limit} บาท/ครั้ง`).required("กรุณาใส่ข้อมูลให้ครบ")}:{penalty_fee:We().required("กรุณาใส่ข้อมูลให้ครบ")},unlock_fee:P().required("กรุณาใส่ข้อมูลให้ครบ"),discount:P().required("กรุณาใส่ข้อมูลให้ครบ")}),ht=async e=>{const n=await Vt(e);$(n)},{mutate:X,isLoading:yt}=x(E.contractMakePaymentClose,{onSuccess:async e=>{if(e.statusCode===400||e.code===400)p(!1),h.fire({icon:"error",title:e.message,padding:"10px 20px"});else{const n=e.data.id;try{await Z(n),p(!1),h.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px"}).then(()=>{q("/apps/contract/"+B+"/"+N)})}catch(s){console.error("Error uploading images:",s)}}},onError:e=>{p(!1),h.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),{mutateAsync:bt,isLoading:ft}=x(E.contractAddSlip),Z=async e=>{const n=[];v.forEach(l=>{Xt.isUndefined(l==null?void 0:l.id)&&n.push(xt({data:{file:l.file,type:"payment"}}))});const s=[];n.length>0&&(await Promise.all(n)).forEach(d=>{(d==null?void 0:d.code)!=="error"?s.push(bt({data:{id_payment:e,image_url:d.data.file_name}})):b.fire({icon:"error",title:"เพิ่มไฟล์ผิดพลาดกรุณาใช้ไฟล์ที่เป็นรูปเท่านั้น",padding:"10px 20px"})}),s.length>0&&await Promise.all(s)},gt=(e,n,s)=>{e.setFieldValue(s,n.value)},vt=(e,n,s)=>{e.setFieldValue(s,n.value),console.log("event.value",n.value),n.value=="promptpay"?(S([{value:"promptpay",label:"promptpay"}]),e.setFieldValue("bank_account_number","promptpay")):S(Xe)},{mutateAsync:xt,isLoading:Et}=zt({onSuccess:e=>{},onError:e=>{}}),kt=async e=>{var u;if(((u=a==null?void 0:a.payment_slip)==null?void 0:u.length)+(v==null?void 0:v.length)>10)return b.fire({icon:"error",title:"รูปภาพเกิน 10 รูป",padding:"10px 20px"}),!1;const s=new Date(e.payed_at);s.setHours(s.getHours()+7);const l=s.toISOString(),d={id_payment:e.id_payment,id_invoice:e.id_invoice,reference:e.reference,bank_account_number:e.bank_account_number,amount:Number(e.amount),penalty_fee:Number(e.penalty_fee),unlock_fee:Number(e.unlock_fee),discount:Number(e.discount),payed_at:l,type:"close_contract"};h.fire({title:"ยืนยันการแก้ไขข้อมูล",text:"คุณต้องการแก้ไขข้อมูลการชำระเงินรายการนี้ใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:Qe.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",reverseButtons:!0,html:`
                <label for="password" style="display: block; text-align: left; font-size: 1rem; margin-top: 10px; color: #000000 color: #000000;">รหัสผ่านผู้ใช้งาน:</label>
                <input id="password" type="password" type="text" class="swal2-input" style="margin: 0 !important; width: 100%; font-size: 1rem; color: #000000;" placeholder="รหัสผ่านผู้ใช้งาน สำหรับยืนยันการแก้ไข">`,preConfirm:()=>{var f;const y=(f=document==null?void 0:document.getElementById("password"))==null?void 0:f.value;return y?{password:y}:(h.showValidationMessage("กรุณากรอกข้อมูลให้ครบทุกช่อง"),!1)}}).then(y=>{if(y.isConfirmed){p(!0);const{password:f}=y.value;St({data:{...d,password:f}}),Y(!1)}})},{mutate:St,isLoading:At}=x(E.updatePayment,{onSuccess:async e=>{if(e.statusCode!==400){const n=e.data.id;try{await Z(n),p(!1),h.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px"}).then(()=>{window.location.reload()})}catch(s){console.error("Error uploading images:",s)}}else p(!1),b.fire({icon:"error",title:e.message,padding:"10px 20px"})},onError:e=>{b.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),Nt=r.useCallback((e,n)=>{if(n)kt(e);else{const s=new Date(e.payed_at);s.setHours(s.getHours()+7);const l=s.toISOString(),d={id_contract:N,remark:e.remark,reference:e.reference,bank_account_number:e.bank_account_number,amount:Number(e.amount),payed_at:l,penalty_fee:Number(e.penalty_fee),unlock_fee:Number(e.unlock_fee),discount:Number(e.discount)};h.fire({title:"ยืนยันการชำระเงิน",text:"คุณต้องการชำระเงินรายการนี้ใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:Qe.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",reverseButtons:!0}).then(u=>{u.isConfirmed&&(p(!0),v.length>0?X({data:d}):(p(!1),b.fire({icon:"error",title:"กรุณาเพิ่มรูปหลักฐานการชำระเงินอย่างน้อย 1 รูป",padding:"10px 20px"})))})}},[X,v]),Ct=()=>{b.fire({icon:"error",title:"รูปภาพเกิน 10 รูป",padding:"10px 20px"})};r.useEffect(()=>{p(!0),mt({data:{id_contract:N,id_installment:V}})},[B,V]);const I=[],[M,It]=r.useState({});Object.keys(M).forEach(e=>{M[e]&&I.push(o("span",{children:[M[e]," ",e," "]},e))}),r.useEffect(()=>{if(!w)return;const e=()=>{const s=+new Date(w)-+new Date;let l={};return s>0&&(l={days:Math.floor(s/(1e3*60*60*24)),hours:Math.floor(s/(1e3*60*60)%24),minutes:Math.floor(s/1e3/60%60),seconds:Math.floor(s/1e3%60)}),l},n=setInterval(()=>{It(e())},1e3);return()=>clearInterval(n)},[w]);const Tt=()=>{const e=document.createElement("a");e.href=A,e.download="qr_code.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)},Pt=async e=>{const n={id_contract:N,invoice_type:"close_contract",amount:+e.amount,penalty_fee:+(e==null?void 0:e.penalty_fee),unlock_fee:+(e==null?void 0:e.unlock_fee),discount:Number(e.discount),remark:(e==null?void 0:e.remark)??""};Rt({data:n})},{mutate:Rt,isLoading:wt}=x(E.getPaymentClose,{onSuccess:async e=>{e.statusCode===400||e.code===400?window.location.reload():setTimeout(()=>{window.location.reload()},2e3)},onError:e=>{b.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),{mutate:Ut,isLoading:Lt}=x(E.cancelQrcode,{onSuccess:async e=>{e.statusCode===400||e.code===400?L(e.message,"error"):window.location.reload()},onError:e=>{b.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),Ot=async()=>{p(!0),Ut({data:{id_payment:C.id_payment}})};return o(U,{children:[(nt||yt||wt||Lt||ft||At||Et||pt)&&t(Zt,{}),o("div",{className:"flex items-center justify-between flex-wrap",children:[t(Qt,{items:ot}),a.isReferenceExists&&(a==null?void 0:a.payment_method)=="cash"&&!c&&t("div",{className:"flex",children:o("a",{className:"hover:text-info cursor-pointer btn btn-primary mr-1",onClick:()=>it(),children:[t(Jt,{className:"w-4.5 h-4.5"}),"   แก้ไข"]})})]}),at&&t(Wt,{mainSrc:tt,onCloseRequest:()=>O(!1)}),t("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:t(qt,{initialValues:a,onSubmit:e=>Nt(e,c),enableReinitialize:!0,autoComplete:"off",validationSchema:_t,children:e=>(r.useEffect(()=>{const n=e.values.penalty_fee?+e.values.penalty_fee:0,s=e.values.unlock_fee?+e.values.unlock_fee:0,l=a.isReferenceExists?a==null?void 0:a.amount:(a==null?void 0:a.amount)*(a==null?void 0:a.remaining_ins),d=e.values.discount?+e.values.discount:0,u=n+s+l-d;e.setFieldValue("total",u)},[e.values.penalty_fee,e.values.unlock_fee,e.values.discount,e.setFieldValue]),o(Gt,{onSubmit:e.handleSubmit,className:"space-y-5 dark:text-white custom-select",children:[t("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"รับชำระเงิน"}),t("div",{className:"grid grid-cols-6 gap-4",children:o("div",{className:"col-start-1 col-end-3",children:[t("label",{htmlFor:"",children:"เลขที่สัญญา"}),t("input",{disabled:!0,type:"text",value:i==null?void 0:i.reference,className:"form-input disabled:bg-[#eee] "})]})}),o("div",{className:"table-responsive pt-10",children:[t("div",{className:"text-md font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"รายการ"}),o("table",{className:"table-striped table-hover",children:[t("thead",{children:o("tr",{children:[t("th",{className:"text-left",style:{width:"50px"},children:"งวดที่"}),t("th",{className:"text-center",style:{width:"100px"},children:"จำนวนคงเหลือทั้งสิ้น"}),t("th",{className:"text-center",style:{width:"100px"},children:"ค่าดำเนินการล่าช้า"}),t("th",{className:"text-center",style:{width:"100px"},children:"ค่าปลดล๊อค"}),t("th",{className:"text-center",style:{width:"100px"},children:"ส่วนลด"}),t("th",{className:"text-center",style:{width:"100px"},children:"รวม"})]})}),t("tbody",{children:o("tr",{children:[t("td",{className:"text-left",children:i==null?void 0:i.ins_no}),t("td",{className:"text-center",children:a.isReferenceExists?R((a==null?void 0:a.amount)||0):`${R((a==null?void 0:a.amount)||0)} * ${R((a==null?void 0:a.remaining_ins)||0)} = ${R((a==null?void 0:a.amount)*(a==null?void 0:a.remaining_ins)||0)}`}),t("td",{children:t(k,{label:"",name:"penalty_fee",disabled:!!a.isReferenceExists&&!c,onKeyPress:n=>{/[0-9]/.test(n.key)||n.preventDefault()}})}),t("td",{children:t(k,{label:"",name:"unlock_fee",disabled:!!a.isReferenceExists&&!c,onKeyPress:n=>{/[0-9]/.test(n.key)||n.preventDefault()}})}),t("td",{children:t(k,{label:"",name:"discount",disabled:!!a.isReferenceExists&&!c,onKeyPress:n=>{/[0-9]/.test(n.key)||n.preventDefault()}})}),t("td",{children:t(k,{label:"",name:"total",disabled:!0})})]})}),t("tfoot",{children:o("tr",{children:[t("td",{colSpan:5,className:"text-right font-bold py-4",children:"จำนวนเงินทั้งสิ้น"}),t("td",{className:"text-center font-bold",children:R(e.values.total)+" บาท"})]})})]})]}),o(U,{children:[o("div",{className:"input-flex-row",children:[t(k,{label:"หมายเลขอ้างอิง",name:"reference",disabled:(!!a.isReferenceExists||e.values.payment_method=="promptpay")&&!c}),t(Yt,{require:!0,label:"วันที่และเวลาที่ชำระ",name:"payed_at",selected:e.values.payed_at,onChange:n=>{const s=n[0],l=Ft(s).toISOString();e.setFieldValue("payed_at",l)},disabled:(!!a.isReferenceExists||e.values.payment_method=="promptpay")&&!c})]}),o("div",{className:"input-flex-row",children:[t(Ye,{require:!0,label:"ช่องทางชำระเงิน",id:"payment_method",name:"payment_method",placeholder:"กรุณาเลือก",options:Je,isSearchable:!1,onChange:n=>{vt(e,n,"payment_method")},disabled:!!a.isReferenceExists&&!c}),t(Ye,{require:!0,label:"โอนเข้าบัญชีธนาคาร",id:"bank_account_number",name:"bank_account_number",placeholder:"กรุณาเลือก",options:ze,isSearchable:!1,onChange:n=>{gt(e,n,"bank_account_number")},disabled:(!!a.isReferenceExists||e.values.payment_method=="promptpay")&&!c})]}),t("div",{className:"input-flex-row",children:t(k,{label:"ยอดชำระเงิน",name:"total",type:"text",disabled:!0})}),e.values.payment_method!="promptpay"&&t("div",{className:"flex flex-row mt-6 gap-4",children:t("div",{className:"upload-container w-full",children:o("div",{className:"custom-file-container","data-upload-id":"firstImage",children:[o("div",{className:"label-container",children:[t("p",{children:"หลักฐานการโอนเงิน "}),(!a.isReferenceExists||c)&&t("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>{$([])},children:"×"})]}),t("div",{}),t("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input hidden",accept:"image/*"}),t("input",{type:"hidden",name:"MAX_FILE_SIZE1",value:"10485760"}),t("div",{children:t(Kt,{multiple:!0,value:v,onChange:ht,onError:Ct,maxNumber:10,children:({imageList:n,onImageUpload:s,onImageRemoveAll:l,onImageUpdate:d,onImageRemove:u,isDragging:y,dragProps:f})=>{var T;return o("div",{className:"upload__image-wrapper",children:[(!a.isReferenceExists||c)&&t("button",{className:"custom-file-container__custom-file__custom-file-control",onClick:s,type:"button",children:"เลือกไฟล์..."}),t("div",{className:"grid gap-4 sm:grid-cols-3 grid-cols-1 pt-[70px]",children:(T=a==null?void 0:a.payment_slip)==null?void 0:T.map((_,g)=>t("div",{className:"custom-file-container__image-preview relative",children:t("img",{src:_.image_url,alt:"img",className:"m-auto pointer",onClick:()=>{Q(_.image_url),O(!0)}})},g))}),t("div",{className:"grid gap-4 sm:grid-cols-3 grid-cols-1 pt-[70px]",children:n.map((_,g)=>o("div",{className:"custom-file-container__image-preview relative",children:[(_==null?void 0:_.id)===void 0&&t("button",{type:"button",className:"custom-file-container__image-clear bg-dark-light dark:bg-dark dark:text-white-dark rounded-full block w-fit p-1 absolute top-0 left-0 z-10",title:"Clear Image",onClick:()=>{u(g)},children:"×"}),t("div",{className:"custom-file-container__image-preview relative",children:t("img",{src:_.dataURL,alt:"img",className:"m-auto pointer",onClick:()=>{Q(_.dataURL),O(!0)}})},g)]},g))})]})}})})]})})}),t("div",{className:"input-flex"}),t("div",{className:"mt-6",children:t(k,{label:"หมายเหตุ",name:"remark",as:"textarea",rows:"5",className:"form-textarea ltr:rounded-l-none rtl:rounded-r-none resize-none","default-value":"-",disabled:!!a.isReferenceExists})}),t("div",{className:"i",children:(a==null?void 0:a.payment_qr)&&A&&((i==null?void 0:i.status)!=="complete"?o(U,{children:[t("div",{className:"flex text-center justify-center font-normal",children:t("div",{className:`badge ${(i==null?void 0:i.status)==="complete"?"badge-outline-success":(i==null?void 0:i.status)==="pending"?"badge-outline-warning":"badge-outline-danger"}`,children:(i==null?void 0:i.status)==="complete"?"สำเร็จ":(i==null?void 0:i.status)==="pending"?"รอชำระ":"ยกเลิก"})}),t("div",{className:"border-[#ebedf2] dark:border-[#1b2e4b]",children:t("div",{className:"my-4",children:A&&I.length?t("img",{src:A,alt:"QR Code",className:"w-full max-w-xs mx-auto"}):t("div",{children:w})})}),o("div",{className:"text-center",children:[t("div",{className:"py-2",children:"เวลานับถอยหลัง"}),t("div",{children:I.length&&I})]}),t("br",{}),A&&I.length&&o("div",{className:"text-center",children:[t("button",{type:"button",className:"bg-blue-600 text-white py-2 px-4 rounded mr-2.5",onClick:Tt,children:"บันทึกรูป"}),t("button",{type:"button",className:"bg-red-600 text-white py-2 px-4 rounded mg",onClick:Ot,children:"ยกเลิก"})]})]}):t(U,{children:" "}))}),e.values.payment_method!="cash"&&(i==null?void 0:i.status)!="complete"&&!A&&e.values.payment_method!==void 0&&t("div",{className:"flex justify-center items-center mt-8",children:t("button",{type:"button",className:"btn btn-primary ltr:ml-4 rtl:mr-4",onClick:()=>Pt(e.values),children:" สร้าง QR CODE "})}),e.values.payment_method=="cash"&&((i==null?void 0:i.status)!="complete"||c)&&t("div",{className:"flex justify-center items-center mt-8",children:t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:c?"แก้ไขข้อมูล":"บันทึกข้อมูล"})})]})]}))})}),o("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:[t("h5",{className:"text-lg font-semibold mb-4",children:"ประวัติการทำรายการ"}),t("div",{className:"datatables pagination-padding",children:t(ea,{className:"whitespace-nowrap table-hover invoice-table",records:W,columns:[{accessor:"id",title:"ลำดับ",textAlignment:"center",sortable:!1,render:(e,n)=>t("p",{children:W.length-n})},{accessor:"reference",title:"Reference",textAlignment:"center",sortable:!1},{accessor:"amount",title:"ค่างวด",textAlignment:"center",sortable:!1},{accessor:"penalty_fee",title:"ค่าดำเนินการล่าช้า",textAlignment:"center",sortable:!1},{accessor:"unlock_fee",title:"ค่าปลดล็อค",textAlignment:"center",sortable:!1},{accessor:"discount",title:"ส่วนลด",textAlignment:"center",sortable:!1},{accessor:"total",title:"ชำระทั้งสิ้น",textAlignment:"center",sortable:!1},{accessor:"bank_account_number",title:"บัญชีธนาคาร",textAlignment:"center",sortable:!1},{accessor:"payed_at",title:"วันที่ชำระ",textAlignment:"center",sortable:!1,render:e=>t("p",{children:D(e==null?void 0:e.payed_at)})},{accessor:"admin_name",title:"ผู้ดำเนินการ (ปรับปรุง)",textAlignment:"center",sortable:!1},{accessor:"created_at",title:"วันที่ - เวลา",textAlignment:"center",sortable:!1,render:e=>t("p",{children:D(e==null?void 0:e.created_at)})}],minHeight:160,highlightOnHover:!0})})]})]})};export{wa as default};
