import{an as E,ao as P,i as q,r as s,c as o,f as a,F as H,j as e,g as n}from"./index-a90aa29c.js";import{Q as b}from"./index-2f30bf27.js";import{a as f}from"./formatDate-4e046265.js";import{B as U}from"./breadcrumbs-b9914bbc.js";import{I as A}from"./InputField-d7971719.js";import{S as v}from"./SelectField-917481a8.js";import{F as B,a as L}from"./formik.esm-c4fd04ca.js";import{I as M}from"./IconX-54a3093e.js";import{s as O}from"./showNotification-b9615e49.js";import{I as z}from"./IconEdit-bf2b08f0.js";import{q as c,_ as x}from"./transition-d4ca4cfa.js";import"./floating-ui.dom-0aeb9e8a.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./lodash-f7ec5310.js";import"./sweetalert2.all-ca2d1030.js";import"./keyboard-f171a3e5.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const ce=()=>{const{id:d}=E(),[g,G]=P(),_=q(t=>t.dataStore.credit_level),l=g.get("id_customer"),[m,i]=s.useState(!1),y=[{to:"/apps/customer/list",label:"ลูกค้า"},{to:"/apps/customer/edit/"+l,label:"ลูกค้า"},{label:"ระดับเครดิต",isCurrent:!0}],[N,C]=s.useState([]),[F,S]=s.useState([]),[w,k]=s.useState([]),[u,I]=s.useState({id:null,id_business_unit:"",credit_level:"",note:null}),{mutate:p}=o(n.customerCreditFindOne,{onSuccess:t=>{const r=t.data;S([r]),C(t.data.history),I(t.data)},onError:()=>{console.error("Failed to fetch bu data")}}),{mutate:T}=o(n.customerCreditCreateAndUpdate,{onSuccess:t=>{t.code==200&&t.statusCode==200&&O("เพิ่มข้อมูลสำเร็จ","success")},onError:t=>{}}),{mutate:j}=o(n.contractFilter,{onSuccess:t=>{const r=t.data.business_unit.map(h=>({value:h.id,label:h.name}));k(r)},onError:()=>{console.error("Failed to fetch bu data")}}),D=async t=>{const r={...t,id_customer:l};await T({data:r}),p({data:{id_business_unit:Number(d),id_customer:l}}),i(!1)};return s.useEffect(()=>{p({data:{id_business_unit:Number(d),id_customer:l}}),j({})},[]),a(H,{children:[e(U,{items:y}),a("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[a("div",{className:"flex flex-col gap-2",children:[a("div",{className:"flex justify-between",children:[e("h5",{className:"px-4 text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"รายละเอียด ระดับเครดิต"}),a("a",{className:"hover:text-info cursor-pointer btn btn-primary mr-1",onClick:()=>i(!0),children:[e(z,{className:"w-4.5 h-4.5"}),"   แก้ไข"]})]}),e("div",{className:"datatables pagination-padding",children:e(b,{className:"whitespace-nowrap table-hover invoice-table",records:F,columns:[{accessor:"id",title:"ลำดับ",sortable:!1,textAlignment:"center",render:(t,r)=>e("div",{children:r+1})},{accessor:"business_unit_name",title:"หน่วยธุรกิจ",sortable:!1},{accessor:"credit_level",title:"ระดับเครดิต",sortable:!1},{accessor:"admin_name",title:"ผู้ดำเนินการ",sortable:!1},{accessor:"created_at",title:"วันที่ - เวลา",sortable:!1,render:t=>e("p",{children:f(t==null?void 0:t.created_at)})}],minHeight:160,highlightOnHover:!0})})]}),a("div",{className:"flex flex-col gap-2 mt-20",children:[e("h5",{className:"px-4 text-[16px] ltr:sm:text-left rtl:sm:text-right text-center",children:"ประวัติ"}),e("div",{className:"datatables pagination-padding",children:e(b,{className:"whitespace-nowrap table-hover invoice-table",records:N,columns:[{accessor:"id",title:"ลำดับ",sortable:!1,textAlignment:"center",render:(t,r)=>e("div",{children:r+1})},{accessor:"note",title:"รายละเอียด",sortable:!1,render:t=>e("p",{children:t.note||"-"})},{accessor:"admin_name",title:"ผู้ดำเนินการ",sortable:!1},{accessor:"created_at",title:"วันที่ เวลา",sortable:!1,render:t=>e("p",{children:f(t==null?void 0:t.created_at)})}],minHeight:160,highlightOnHover:!0})})]})]}),e(c,{appear:!0,show:m,as:s.Fragment,children:a(x,{as:"div",open:m,onClose:()=>i(!1),className:"relative z-[51]",children:[e(c.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0 bg-[black]/60"})}),e("div",{className:"fixed inset-0 overflow-y-auto",children:e("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:e(c.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:a(x.Panel,{className:"panel border-0 p-0 rounded-lg w-full max-w-lg text-black dark:text-white-dark",children:[a("div",{children:[e("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>i(!1),children:e(M,{})}),e("div",{className:"text-lg font-medium  dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"แก้ไขข้อมูล"})]}),e(B,{initialValues:u,onSubmit:D,enableReinitialize:!0,autoComplete:"off",children:a(L,{className:"px-4 flex flex-col gap-3 custom-select",children:[e(v,{require:!0,placeholder:"กรุณาเลือก",isSearchable:!0,label:"หน่วยธุรกิจ",options:w,name:"id_business_unit",id:"id_business_unit"}),e(v,{require:!0,label:"ระดับเครดิต (แอดมิน)",id:"credit_level",name:"credit_level",options:_,placeholder:"กรุณาเลือก",isSearchable:!0}),u.id&&e(A,{require:!0,label:"เหตุผลการแก้ไข",name:"note"}),e("div",{className:" pb-5",children:a("div",{className:"flex justify-end items-center mt-8",children:[e("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{i(!1)},children:"ยกเลิก"}),e("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"ยืนยัน"})]})})]})})]})})})})]})})]})};export{ce as default};
