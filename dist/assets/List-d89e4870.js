import{an as Y,a as B,u as z,r as s,s as X,c as y,f as o,j as t,g as A}from"./index-a90aa29c.js";import{Q}from"./index-2f30bf27.js";import{I as Z}from"./IconPlus-4c7e79c8.js";import{I as $}from"./IconEdit-bf2b08f0.js";import{b as J}from"./formatNumeric-862380d6.js";import{t as ee}from"./constant-e85f1578.js";import{P as x}from"./config-8de56c22.js";import{F as P,a as I}from"./formik.esm-c4fd04ca.js";import{I as p}from"./InputField-d7971719.js";import{I as te}from"./IconX-54a3093e.js";import{S as se}from"./SelectField-917481a8.js";import{c as ae,a as m}from"./object-7405de1d.js";import{S as re}from"./sweetalert2.all-ca2d1030.js";import{P as ie}from"./preLoading-b2445d9d.js";import{q as v,_ as C}from"./transition-d4ca4cfa.js";const Te=()=>{const N="admin";let{id:r}=Y();const R=B();z();const _=localStorage.getItem(N);(_?JSON.parse(_).role:null)=="shop"&&(r=_?JSON.parse(_).id_shop:null),s.useEffect(()=>{R(X("รายการพนักงาน"))});const[E,ne]=s.useState({name:"",username:"",password:"",phone_number:"",email:"",is_active:!0}),u=re.mixin(ee),[a,S]=s.useState(E),[D,U]=s.useState([]),[h,l]=s.useState(1),[i,O]=s.useState(x[0]),[L,M]=s.useState(0),[k,w]=s.useState({columnAccessor:"",direction:"asc"}),H=e=>{S({id:e==null?void 0:e.id,name:e==null?void 0:e.name,username:e==null?void 0:e.username,phone_number:e==null?void 0:e.phone_number,email:e==null?void 0:e.email,line_id:e==null?void 0:e.line_id,is_active:e==null?void 0:e.is_active}),d(!0)},j=ae().shape({name:m().required("กรุณาใส่ข้อมูลให้ครบ"),username:m().required("กรุณาใส่ข้อมูลให้ครบ"),...!(a!=null&&a.id)&&{password:m().required("กรุณาใส่ข้อมูลให้ครบ")},phone_number:m().required("กรุณาใส่ข้อมูลให้ครบ").length(10,"กรุณาใส่ข้อมูลให้ครบ 10 เลข"),email:m().email("กรุณาใส่อีเมลที่ถูกต้อง").required("กรุณาใส่ข้อมูลให้ครบ")}),[le,g]=s.useState({}),{mutate:c,isLoading:q}=y(A.shopUserFindAll,{onSuccess:e=>{U(e.data.list),M(e.data.total)},onError:()=>{console.error("Failed to fetch bu data")}});s.useEffect(()=>{c({data:{id_shop:r,page:h,page_size:i}})},[h,i]),s.useEffect(()=>{},[i]),s.useEffect(()=>{},[h]);const[T,d]=s.useState(!1),F=s.useCallback(e=>{e!=null&&e.id?K({data:{...e,id_shop:r}}):V({data:{...e,id_shop:r}}),d(!1)},[]),{mutate:V,isLoading:G}=y(A.shopUserCreate,{onSuccess:e=>{e.statusCode===200||e.code===200?(u.fire({icon:"success",title:"เพิ่มข้อมูลสำเร็จ",padding:"10px 20px"}),l(1),c({data:{page:1,page_size:i,query:"",id_shop:r}}),g({query:""})):u.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),{mutate:K,isLoading:W}=y(A.shopUserUpdate,{onSuccess:e=>{e.statusCode===200||e.code===200?(u.fire({icon:"success",title:"แก้ไขข้อมูลสำเร็จ",padding:"10px 20px"}),l(1),c({data:{page:1,page_size:i,query:"",id_shop:r}}),g({query:""})):u.fire({icon:"error",title:e.message,padding:"10px 20px"})}});return o("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[(q||G||W)&&t(ie,{}),o("div",{className:"invoice-table ",children:[o("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:[t("div",{className:"flex items-center gap-2",children:o("button",{type:"button",className:"btn bg-[#002a42] text-white w-full border-0 uppercase shadow-[0_10px_20px_-10px_rgba(67,97,238,0.44)]",onClick:()=>{d(!0)},children:[t(Z,{}),"เพิ่มพนักงาน"]})}),t("div",{className:"flex flex-row ltr:ml-auto rtl:mr-auto gap-5",children:t(P,{initialValues:{query:""},onSubmit:e=>{l(1),c({data:{page:1,page_size:i,query:e.query,id_shop:r}}),g({...e})},children:({setFieldValue:e,handleReset:n,values:f})=>t(I,{children:t("div",{className:"flex flex-wrap sm:flex-row flex-col sm:items-center sm:gap-3 gap-4 w-full sm:w-auto",children:o("div",{className:"flex gap-4",children:[t("div",{className:"relative",children:t("input",{type:"text",id:"query",name:"query",placeholder:"ค้นหา",className:"form-input py-2 ltr:pr-11 rtl:pl-11 peer",value:f.query,onChange:b=>{e("query",b.target.value)}})}),t("button",{type:"submit",className:"btn btn-primary w-[100px] gap-2",children:"ค้นหา"}),t("button",{type:"reset",className:"btn btn-info gap-2 w-[100px]",onClick:()=>{const b={query:""};l(1),g({...b}),c({data:{id_shop:r,page:1,page_size:i,...b}})},children:"ล้างค่า"})]})})})})})]}),t("div",{className:"datatables pagination-padding",children:t(Q,{className:"whitespace-nowrap table-hover invoice-table",records:D,columns:[{accessor:"id",title:"ลำดับ",sortable:!1,textAlignment:"center",render:(e,n)=>t("div",{children:n+1})},{accessor:"name",title:"ชื่อพนักงาน",sortable:!1,render:e=>t("div",{className:"flex items-center justify-start font-normal",children:t("div",{children:e.name})})},{accessor:"email",title:"อีเมล",sortable:!1,render:e=>t("div",{className:"flex items-center justify-start font-normal",children:t("div",{children:e.email})})},{accessor:"phone_number",title:"เบอร์โทรศัพท์",sortable:!1,render:({phone_number:e})=>t("div",{className:"flex items-center justify-start font-normal",children:t("div",{children:e?J(e):"-"})})},{accessor:"line_id",title:"Line ID",sortable:!1,render:({line_id:e})=>t("div",{className:"flex items-center justify-start font-normal",children:t("div",{children:e||"-"})})},{accessor:"is_active",title:"เปิดปิดการใช้งาน",textAlignment:"center",sortable:!1,render:({is_active:e})=>t("span",{className:`badge ${e?"badge-outline-success":"badge-outline-danger"}`,children:e?"เปิดใช้งาน":"ปิดใช้งาน"})},{accessor:"action",title:"Actions",textAlignment:"center",sortable:!1,render:e=>t("div",{className:"flex gap-4 items-center w-max mx-auto",children:t("a",{className:"flex cursor-pointer active",onClick:()=>H(e),children:t($,{})})})}],page:h,totalRecords:L,recordsPerPage:i,highlightOnHover:!0,onPageChange:e=>l(e),recordsPerPageOptions:x,onRecordsPerPageChange:e=>{l(1),O(e)},sortStatus:k,onSortStatusChange:w,paginationText:({from:e,to:n,totalRecords:f})=>`โชว์ ${e} ถึง ${n} ของ ${f} หน้าทั้งหมด`})})]}),t(v,{appear:!0,show:T,as:s.Fragment,children:o(C,{as:"div",open:T,className:"relative z-[51]",onClose:()=>{S(E),d(!1)},children:[t(v.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(v.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:o(C.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",style:{minHeight:"500px"},children:[t("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>d(!1),children:t(te,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:a!=null&&a.id?"แก้ไขข้อมูลพนักงาน":"เพิ่มพนักงาน"}),t("div",{className:"p-5",children:t(P,{initialValues:a,onSubmit:F,enableReinitialize:!0,autoComplete:"off",validationSchema:j,children:e=>o(I,{className:"space-y-5 dark:text-white custom-select",children:[t(p,{require:!0,label:"ชื่อผู้ใช้งาน",name:"username",type:"text",placeholder:"กรุณาใส่ข้อมูล",disabled:!!(a!=null&&a.id)}),t(p,{require:!(a!=null&&a.id),label:"รหัสผ่าน",name:"password",type:"password",placeholder:"กรุณาใส่ข้อมูล"}),t(p,{require:!0,label:"ชื่อ-นามสกุล",name:"name",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),t(p,{require:!0,label:"เบอร์โทรติดต่อ",name:"phone_number",type:"text",maxLength:10,onKeyPress:n=>{/[0-9]/.test(n.key)||n.preventDefault()}}),t(p,{require:!0,label:"E-mail",name:"email",type:"email",placeholder:"กรุณาใส่ข้อมูล"}),t(p,{label:"LINE ID",name:"line_id",type:"text",placeholder:"กรุณาใส่ข้อมูล"}),t(se,{label:"สถานะการใช้งาน",id:"is_active",name:"is_active",options:[{label:"เปิด",value:!0},{label:"ปิด",value:!1}],placeholder:"กรุณาเลือก"}),t("div",{className:"flex justify-center items-center mt-8",children:t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"บันทึกข้อมูล"})})]})})})]})})})})]})})]})};export{Te as L};
