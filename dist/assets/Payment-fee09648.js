import{an as $t,r as i,u as Wt,a as zt,s as Qt,c as v,t as K,f as r,F as U,j as t,m as Yt,g as N}from"./index-a90aa29c.js";import{c as Xt,a as F,e as $}from"./object-7405de1d.js";import{S as p}from"./sweetalert2.all-ca2d1030.js";import{r as Zt}from"./helpFunction-19eb552d.js";import{a as et}from"./formatNumeric-862380d6.js";import{F as Jt}from"./DatePicker-5cf5930a.js";/* empty css                      */import{F as ea,a as ta}from"./formik.esm-c4fd04ca.js";import{_ as aa}from"./index-f89ea186.js";import{I as A}from"./InputField-d7971719.js";import{S as tt}from"./SelectField-917481a8.js";import{t as na}from"./constant-e85f1578.js";import{B as sa}from"./breadcrumbs-b9914bbc.js";import{R as ra}from"./index.es-edddd9ad.js";import{a as W}from"./formatDate-4e046265.js";import{s as C}from"./showNotification-b9615e49.js";import{F as ia}from"./DatePickerTime-6f9990ef.js";import{a as oa}from"./useUploadMutation-785f6dd6.js";import{_ as la}from"./lodash-f7ec5310.js";import{P as ca}from"./preLoading-b2445d9d.js";import{I as da}from"./IconEdit-bf2b08f0.js";import{Q as ma}from"./index-2f30bf27.js";import{I as pa}from"./IconX-54a3093e.js";import{q as z,_ as at}from"./transition-d4ca4cfa.js";import"./_defineProperty-6dbd93ca.js";import"./_baseIsEqual-06123cd3.js";import"./isObjectLike-b76e75a8.js";import"./isSymbol-15555f2d.js";import"./flatpickr-2301360e.js";import"./react-select.esm-b46d9623.js";import"./createSuper-98fcd92d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./keyboard-f171a3e5.js";import"./use-is-mounted-22b05dcc.js";import"./bugs-a60d55c3.js";const ua="admin",Ya=()=>{const{ctid:Q,uuid:Y,inid:X}=$t(),[m,nt]=i.useState({admin_name:"",created_at:"",reason_cancel:"",payment_slip:[]}),L=Q?Number(Q):void 0,I=X?Number(X):void 0,k=Y||void 0,[st,S]=i.useState([]);i.useState([{value:"promptpay",label:"promptpay"}]);const[rt,it]=i.useState([]),[ot,_a]=i.useState([{label:"promptpay",value:"promptpay"},{label:"เงินสด",value:"cash"}]),[Z,j]=i.useState(!1),D=Wt(),lt=zt(),J=localStorage.getItem(ua),ee=J?JSON.parse(J).role:null,[E,te]=i.useState([]),b=p.mixin(na),[ct,B]=i.useState(""),[dt,M]=i.useState(!1),[mt,c]=i.useState(!0),[ae,pt]=i.useState([]);ee!="admin"&&ee!="business_unit"&&D("/");const[u,V]=i.useState(!1),[o,ut]=i.useState({reference:"",status:"",ins_no:""}),[s,ne]=i.useState({due_at:"",isReferenceExists:!1,id_invoice:0,id_payment:"",amount:0,discount:0,penalty_fee:0,penalty_fee_limit:0,unlock_fee:0,total:0,reference:"",bank_account_number:"",payment_method:"",remark:"",payed_at:new Date,payment_slip:[],payment_qr:{}}),_t=[{to:"/apps/contract/list",label:"สัญญา"},{to:!0,label:"แก้ไข"},{label:"รับชำระเงิน",isCurrent:!0}];i.useEffect(()=>{lt(Qt("รับชำระเงิน"))});const[O,ht]=i.useState(""),[w,yt]=i.useState(""),[T,ft]=i.useState({}),{mutate:bt,isLoading:gt}=v(N.contractGetPayment,{onSuccess:e=>{var n,a,l,d,f,h,g,G,R,y,x,oe,le,ce,de,me,pe,ue,_e,he,ye,fe,be,ge,xe,ve,Ne,ke,Ee,Ae,Se,we,Ce,Ie,Te,Pe,Re,Ue,Le,De,Me,Oe,He,Fe,je,Be,Ve,qe,Ge,Ke,$e,We,ze,Qe,Ye,Xe,Ze,Je;if(ut({reference:(n=e.data)==null?void 0:n.reference,status:(a=e.data)==null?void 0:a.status,ins_no:(l=e.data)==null?void 0:l.ins_no}),(d=e.data)!=null&&d.history&&pt((f=e.data)==null?void 0:f.history),(g=(h=e.data)==null?void 0:h.payment)!=null&&g.reference){const _=new Date((G=e.data)==null?void 0:G.payment.payed_at);_.setHours(_.getHours()-7),ne({...s,due_at:(R=e.data)==null?void 0:R.due_at,...((y=e.data)==null?void 0:y.payment_method)=="cash"&&{bank_account_number:e.data.bank_account_number},id_invoice:(x=e.data)==null?void 0:x.id_invoice,id_payment:(oe=e.data)==null?void 0:oe.id_payment,amount:(le=e.data)==null?void 0:le.payment.amount,discount:(ce=e.data)==null?void 0:ce.payment.discount,penalty_fee:(de=e.data)==null?void 0:de.payment.penalty_fee,penalty_fee_limit:((me=e.data)==null?void 0:me.penalty_fee_limit)??0,unlock_fee:(pe=e.data)==null?void 0:pe.payment.unlock_fee,total:(ue=e.data)==null?void 0:ue.payment.total,reference:(_e=e.data)==null?void 0:_e.payment.reference,...((ye=(he=e.data)==null?void 0:he.payment)==null?void 0:ye.payment_method)=="cash"&&{bank_account_number:(fe=e.data)==null?void 0:fe.payment.bank_account_number},...((ge=(be=e.data)==null?void 0:be.payment)==null?void 0:ge.payment_method)!="cash"&&{bank_account_number:"promptpay"},payment_method:(ve=(xe=e.data)==null?void 0:xe.payment)==null?void 0:ve.payment_method,remark:(Ne=e.data)==null?void 0:Ne.payment.remark,payed_at:_??new Date,isReferenceExists:!0,payment_slip:(ke=e.data)==null?void 0:ke.payment_slip}),(Ee=e.data)!=null&&Ee.payment_qr&&(ft(e.data.payment_qr),yt((Ae=e.data.payment_qr)==null?void 0:Ae.image),ht((Se=e.data.payment_qr)==null?void 0:Se.expiredate)),((Ce=(we=e.data)==null?void 0:we.payment)==null?void 0:Ce.payment_method)!="cash"?((Ie=e.data.payment)==null?void 0:Ie.payment_gateway)=="tqr"?S([{value:"promptpay",label:"Thai Qr"}]):S([{value:"promptpay",label:"Pay Solution"}]):S((Te=e.data)==null?void 0:Te.business_unit_banks.map(H=>({value:`${H.bank.name} - ${H.bank_account_number}`,label:`${H.bank.name} - ${H.bank_account_number}`})))}else e.statusCode===400||e.code===400?C("พบข้อผิดพลาด ไม่สามารถโหลดข้อมูลได้!","error"):(ne({...s,...((Pe=e.data)==null?void 0:Pe.payment_method)=="cash"&&{bank_account_number:e.data.bank_account_number},due_at:(Re=e.data)==null?void 0:Re.due_at,amount:(Le=(Ue=e.data)==null?void 0:Ue.payment)==null?void 0:Le.amount,discount:(Me=(De=e.data)==null?void 0:De.payment)==null?void 0:Me.discount,penalty_fee:(He=(Oe=e.data)==null?void 0:Oe.payment)==null?void 0:He.penalty_fee,penalty_fee_limit:((Fe=e.data)==null?void 0:Fe.penalty_fee_limit)??0,unlock_fee:(Be=(je=e.data)==null?void 0:je.payment)==null?void 0:Be.unlock_fee,total:(qe=(Ve=e.data)==null?void 0:Ve.payment)==null?void 0:qe.total,reference:(Ge=e.data)==null?void 0:Ge.payment.reference,bank_account_number:(Ke=e.data)==null?void 0:Ke.payment.bank_account_number,payment_method:(We=($e=e.data)==null?void 0:$e.payment)==null?void 0:We.payment_method,remark:(Qe=(ze=e.data)==null?void 0:ze.payment)==null?void 0:Qe.remark,payed_at:((Xe=(Ye=e.data)==null?void 0:Ye.payment)==null?void 0:Xe.payed_at)??new Date,isReferenceExists:!1}),S((Ze=e.data)==null?void 0:Ze.business_unit_banks.map(_=>({value:`${_.bank.name} - ${_.bank_account_number}`,label:`${_.bank.name} - ${_.bank_account_number}`}))),it((Je=e.data)==null?void 0:Je.business_unit_banks.map(_=>({value:`${_.bank.name} - ${_.bank_account_number}`,label:`${_.bank.name} - ${_.bank_account_number}`}))));c(!1)},onError:e=>{C(e.message,"error"),c(!1)}}),{mutate:xt}=v(N.paymentCheckStatus,{onSuccess:e=>{var n,a;e.statusCode===400||e.code===400?p.fire({icon:"error",title:"ยกเลิกชำระเงิน",padding:"10px 20px"}).then(()=>{window.location.reload()}):((n=e.data)==null?void 0:n.status)=="cancel"?p.fire({icon:"error",title:"ยกเลิกชำระเงิน",padding:"10px 20px"}).then(()=>{window.location.reload()}):((a=e.data)==null?void 0:a.status)=="complete"&&p.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px"}).then(()=>{window.location.reload()})},onError:e=>{C(e.message,"error"),c(!1)}});i.useEffect(()=>{if(T!=null&&T.id_payment){const e=setInterval(async()=>{try{xt({data:{id_contract:k,id_installment:I}})}catch(n){console.error("Error checking payment status:",n)}},1e4);return()=>clearInterval(e)}},[T]);const vt=Xt().shape({payed_at:F().nullable().required("กรุณาใส่เลือกวันที่"),bank_account_number:F().required("กรุณาใส่ข้อมูลให้ครบ"),amount:F().required("กรุณาใส่ข้อมูลให้ครบ"),...(s==null?void 0:s.penalty_fee_limit)>0?{penalty_fee:$().max(s==null?void 0:s.penalty_fee_limit,`ค่าดำเนินการล่าช้าต้องไม่เกิน ${s==null?void 0:s.penalty_fee_limit} บาท/ครั้ง`).required("กรุณาใส่ข้อมูลให้ครบ")}:{penalty_fee:$().required("กรุณาใส่ข้อมูลให้ครบ")},unlock_fee:F().required("กรุณาใส่ข้อมูลให้ครบ"),discount:$().max((s==null?void 0:s.amount)-1).required("กรุณาใส่ข้อมูลให้ครบ")}),Nt=async e=>{const n=await Zt(e);te(n)},{mutate:se,isLoading:kt}=v(N.contractMakePayment,{onSuccess:async e=>{if(e.statusCode===400||e.code===400)c(!1),p.fire({icon:"error",title:e.message,padding:"10px 20px"});else{const n=e.data.id;try{await re(n),c(!1),p.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px"}).then(()=>{D("/apps/contract/"+L+"/"+k)})}catch(a){console.error("Error uploading images:",a)}}},onError:e=>{c(!1),p.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),{mutateAsync:Et,isLoading:At}=v(N.contractAddSlip),re=async e=>{const n=[];E.forEach(l=>{la.isUndefined(l==null?void 0:l.id)&&n.push(Ct({data:{file:l.file,type:"payment"}}))});const a=[];n.length>0&&(await Promise.all(n)).forEach(d=>{(d==null?void 0:d.code)!=="error"?a.push(Et({data:{id_payment:e,image_url:d.data.file_name}})):b.fire({icon:"error",title:"เพิ่มไฟล์ผิดพลาดกรุณาใช้ไฟล์ที่เป็นรูปเท่านั้น",padding:"10px 20px"})}),a.length>0&&await Promise.all(a)},St=(e,n,a)=>{e.setFieldValue(a,n.value)},wt=(e,n,a)=>{e.setFieldValue(a,n.value),n.value=="promptpay"?(S([{value:"promptpay",label:"promptpay"}]),e.setFieldValue("bank_account_number","promptpay")):S(rt)},{mutateAsync:Ct,isLoading:It}=oa({onSuccess:e=>{},onError:e=>{}}),Tt=i.useCallback((e,n)=>{if(n)qt(e);else{const a=new Date(e.payed_at);a.setHours(a.getHours()+7);const l=a.toISOString(),d={id_contract:k,id_installment:Number(I),remark:e.remark,reference:e.reference,bank_account_number:e.bank_account_number,amount:Number(e.amount),payed_at:l,penalty_fee:Number(e.penalty_fee),unlock_fee:Number(e.unlock_fee),discount:Number(e.discount)};p.fire({title:"ยืนยันการชำระเงิน",text:"คุณต้องการชำระเงินรายการนี้ใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:K.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",reverseButtons:!0}).then(f=>{f.isConfirmed&&(c(!0),E.length>0?se({data:d}):(c(!1),b.fire({icon:"error",title:"กรุณาเพิ่มรูปหลักฐานการชำระเงินอย่างน้อย 1 รูป",padding:"10px 20px"})))})}},[se,E]),Pt=()=>{b.fire({icon:"error",title:"รูปภาพเกิน 10 รูป",padding:"10px 20px"})};i.useEffect(()=>{c(!0),bt({data:{id_contract:k,id_installment:I}})},[L,I]);const P=[],[q,Rt]=i.useState({});Object.keys(q).forEach(e=>{q[e]&&P.push(r("span",{children:[q[e]," ",e," "]},e))}),i.useEffect(()=>{if(!O)return;const e=()=>{const a=+new Date(O)-+new Date;let l={};return a>0&&(l={days:Math.floor(a/(1e3*60*60*24)),hours:Math.floor(a/(1e3*60*60)%24),minutes:Math.floor(a/1e3/60%60),seconds:Math.floor(a/1e3%60)}),l},n=setInterval(()=>{Rt(e())},1e3);return()=>clearInterval(n)},[O]);const Ut=()=>{const e=document.createElement("a");e.href=w,e.download="qr_code.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)},Lt=async e=>{c(!0);const n={id_contract:k,id_installment:I,invoice_type:"pay_installment",penalty_fee:+(e==null?void 0:e.penalty_fee),unlock_fee:+(e==null?void 0:e.unlock_fee),discount:Number(e.discount),remark:(e==null?void 0:e.remark)??""};await Dt({data:n})},{mutate:Dt,isLoading:Mt}=v(N.getPayment,{onSuccess:async e=>{e.statusCode===400||e.code===400?(C(e.message,"error"),c(!1)):setTimeout(()=>{window.location.reload()},2e3)},onError:e=>{C(e.message,"error")}}),{mutate:Ot,isLoading:Ht}=v(N.updatePayment,{onSuccess:async e=>{if(e.statusCode!==400){const n=e.data.id;try{await re(n),c(!1),p.fire({icon:"success",title:"ชำระเงินสำเร็จ",padding:"10px 20px"}).then(()=>{window.location.reload()})}catch(a){console.error("Error uploading images:",a)}}else c(!1),b.fire({icon:"error",title:e.message,padding:"10px 20px"})},onError:e=>{b.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),{mutate:Ft,isLoading:ie}=v(N.cancelPaymentCash,{onSuccess:async e=>{if(e.statusCode!==400)try{c(!1),p.fire({icon:"success",title:"ยกเลิกชำระเงินสำเร็จ",padding:"10px 20px"}).then(()=>{D("/apps/contract/"+L+"/"+k)})}catch(n){console.error("Error uploading images:",n)}else c(!1),b.fire({icon:"error",title:e.message,padding:"10px 20px"})},onError:e=>{b.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),{mutate:jt}=v(N.cancelQrcode,{onSuccess:async e=>{e.statusCode===400||e.code===400?C(e.message,"error"):window.location.reload()},onError:e=>{b.fire({icon:"error",title:e.message,padding:"10px 20px"})}}),Bt=async()=>{c(!0),jt({data:{id_payment:T.id_payment}})},Vt=async()=>{V(!u)},qt=async e=>{var f;if(((f=s==null?void 0:s.payment_slip)==null?void 0:f.length)+(E==null?void 0:E.length)>10)return b.fire({icon:"error",title:"รูปภาพเกิน 10 รูป",padding:"10px 20px"}),!1;const a=new Date(e.payed_at);a.setHours(a.getHours()+7);const l=a.toISOString(),d={id_payment:e.id_payment,id_invoice:e.id_invoice,reference:e.reference,bank_account_number:e.bank_account_number,amount:Number(e.amount),penalty_fee:Number(e.penalty_fee),unlock_fee:Number(e.unlock_fee),discount:Number(e.discount),payed_at:l,type:"pay_installment"};p.fire({title:"ยืนยันการแก้ไขข้อมูล",text:"คุณต้องการแก้ไขข้อมูลการชำระเงินรายการนี้ใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:K.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",reverseButtons:!0,html:`
                <label for="password" style="display: block; text-align: left; font-size: 1rem; margin-top: 10px; color: #000000 color: #000000;">รหัสผ่านผู้ใช้งาน:</label>
                <input id="password" type="password" type="text" class="swal2-input" style="margin: 0 !important; width: 100%; font-size: 1rem; color: #000000;" placeholder="รหัสผ่านผู้ใช้งาน สำหรับยืนยันการแก้ไข">`,preConfirm:()=>{var g;const h=(g=document==null?void 0:document.getElementById("password"))==null?void 0:g.value;return h?{password:h}:(p.showValidationMessage("กรุณากรอกข้อมูลให้ครบทุกช่อง"),!1)}}).then(h=>{if(h.isConfirmed){c(!0);const{password:g}=h.value;Ot({data:{...d,password:g}}),V(!1)}})},Gt=async e=>{s.id_payment?p.fire({title:"ยกเลิกการชำระเงิน",text:"คุณต้องการยกเลิกการชำระเงินรายการนี้ใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:K.color.themePrimary,cancelButtonColor:"#d33",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",reverseButtons:!0,html:`<label for="reason_cancel" style="display: block; text-align: left; margin-bottom: 10px; font-size: 1rem; margin-top: 10px; color: #000000;">เหตุผลการยกเลิก:</label>
                    <input id="reason_cancel" type="text" class="swal2-input" style="margin: 0 !important; width: 100%; font-size: 1rem; color: #000000;" placeholder="โปรดระบุ">
                    <label for="password" style="display: block; text-align: left; font-size: 1rem; margin-top: 10px; color: #000000 color: #000000;">รหัสผ่านผู้ใช้งาน:</label>
                    <input id="password" type="password" type="text" class="swal2-input" style="margin: 0 !important; width: 100%; font-size: 1rem; color: #000000;" placeholder="รหัสผ่านผู้ใช้งาน สำหรับยืนยันการแก้ไข">`,preConfirm:()=>{document==null||document.getElementById("password");const n=document==null?void 0:document.getElementById("reason_cancel"),a=document==null?void 0:document.getElementById("password");return!n.value||!a.value?(p.showValidationMessage("กรุณากรอกข้อมูลให้ครบทุกช่อง"),!1):{reason_cancel:n.value,password:a.value}}}).then(n=>{if(n.isConfirmed){c(!0);const{password:a,reason_cancel:l}=n.value,d={id_payment:s.id_payment,password:a,reason_cancel:l};Ft({data:{...d}}),V(!1)}}):D("/apps/contract/"+L+"/"+k)},Kt=(e=null)=>{if(e.is_deleted&&(j(!0),e!=null&&e.cancel_details)){const n=e==null?void 0:e.cancel_details;nt({admin_name:n.admin_name,created_at:n.created_at,reason_cancel:n.reason_cancel,payment_slip:(e==null?void 0:e.payment_slip)??[]})}};return r(U,{children:[(mt||kt||ie||Mt||ie||At||Ht||It||gt)&&t(ca,{}),r("div",{className:"flex items-center justify-between flex-wrap",children:[t(sa,{items:_t}),s.isReferenceExists&&(s==null?void 0:s.payment_method)=="cash"&&!u&&t("div",{className:"flex",children:r("a",{className:"hover:text-info cursor-pointer btn btn-primary mr-1",onClick:()=>Vt(),children:[t(da,{className:"w-4.5 h-4.5"}),"   แก้ไข"]})})]}),dt&&t(ra,{mainSrc:ct,onCloseRequest:()=>M(!1)}),t(z,{appear:!0,show:Z,as:i.Fragment,children:r(at,{as:"div",open:Z,onClose:()=>{j(!1)},className:"relative z-[51]",children:[t(z.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t("div",{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(z.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:r(at.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",style:{maxWidth:"40rem"},children:[t("button",{type:"button",onClick:()=>{j(!1)},className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:t(pa,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px] text-center",children:"ข้อมูลการยกเลิก"}),t("div",{className:"p-5",children:t("div",{className:"p-5",children:r("div",{className:"mb-5 space-y-1",children:[r("div",{className:"flex items-center justify-between",children:[t("p",{className:"text-[#515365] font-semibold",children:"เหตุผลการยกเลิก "}),t("p",{className:"text-base",children:t("span",{className:"font-semibold",children:(m==null?void 0:m.reason_cancel)??""})})]}),r("div",{className:"flex items-center justify-between",children:[t("p",{className:"text-[#515365] font-semibold",children:"ผู้ดำเนินการ"}),t("p",{className:"text-base",children:t("span",{className:"font-semibold",children:(m==null?void 0:m.admin_name)??"-"})})]}),r("div",{className:"flex items-center justify-between",children:[t("p",{className:"text-[#515365] font-semibold",children:"วันที่ยกเลิก"}),t("p",{className:"text-base",children:t("span",{className:"font-semibold",children:W((m==null?void 0:m.created_at)??"-")})})]}),t("p",{className:"text-[#515365] font-semibold",children:"หลักฐานการโอนเงิน"}),Array.isArray(m==null?void 0:m.payment_slip)&&m.payment_slip.length>0?t("div",{className:"grid gap-4 sm:grid-cols-3 grid-cols-1",children:m.payment_slip.map((e,n)=>t("div",{className:"custom-file-container__image-preview relative",children:t("img",{src:e.image_url,alt:"img",className:"m-auto pointer",onClick:()=>{B(e.image_url),M(!0)}})},n))}):t(U,{children:"-"})]})})})]})})})})]})}),t("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:t(ea,{initialValues:s,onSubmit:e=>Tt(e,u),enableReinitialize:!0,autoComplete:"off",validationSchema:vt,children:e=>{var n;return i.useEffect(()=>{const a=e.values.penalty_fee?+e.values.penalty_fee:0,l=e.values.unlock_fee?+e.values.unlock_fee:0,d=e.values.amount,f=e.values.discount?+e.values.discount:0,h=a+l+d-f;e.setFieldValue("total",h)},[e.values.penalty_fee,e.values.unlock_fee,e.values.discount,e.setFieldValue]),r(ta,{onSubmit:e.handleSubmit,className:"space-y-5 dark:text-white custom-select",children:[t("div",{className:"text-lg font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"รับชำระเงิน"}),r("div",{className:"grid grid-cols-6 gap-4",children:[r("div",{className:"col-start-1 col-end-3",children:[t("label",{htmlFor:"",children:"เลขที่สัญญา"}),t("input",{disabled:!0,type:"text",value:o.reference,className:"form-input disabled:bg-[#eee] "})]}),t("div",{className:"col-end-7 col-span-2",children:t(Jt,{label:"วันที่ครบกำหนด",name:"due_at",disabled:!0})})]}),r("div",{className:"table-responsive pt-10",children:[t("div",{className:"text-md font-semibold ltr:sm:text-left rtl:sm:text-right text-center",children:"รายการ"}),r("table",{className:"table-striped table-hover",children:[t("thead",{children:r("tr",{children:[t("th",{className:"text-left",style:{width:"50px"},children:"งวดที่"}),t("th",{className:"text-center",style:{width:"100px"},children:"ผ่อนงวดละ"}),t("th",{className:"text-center",style:{width:"100px"},children:"ค่าดำเนินการล่าช้า"}),t("th",{className:"text-center",style:{width:"100px"},children:"ค่าปลดล๊อค"}),t("th",{className:"text-center",style:{width:"100px"},children:"ส่วนลด"}),t("th",{className:"text-center",style:{width:"100px"},children:"รวม"})]})}),t("tbody",{children:r("tr",{children:[t("td",{className:"text-left",children:o==null?void 0:o.ins_no}),t("td",{className:"text-center",children:et((s==null?void 0:s.amount)||0)}),t("td",{children:t(A,{label:"",name:"penalty_fee",disabled:!!s.isReferenceExists&&!u,onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()}})}),t("td",{children:t(A,{label:"",name:"unlock_fee",disabled:!!s.isReferenceExists&&!u,onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()}})}),t("td",{children:t(A,{label:"",name:"discount",disabled:!!s.isReferenceExists&&!u,onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()}})}),t("td",{children:t(A,{label:"",name:"total",disabled:!0})})]})}),t("tfoot",{children:r("tr",{children:[t("td",{colSpan:5,className:"text-right font-bold py-4",children:"จำนวนเงินทั้งสิ้น"}),t("td",{className:"text-center font-bold",children:et(e.values.total)+" บาท"})]})})]})]}),r(U,{children:[r("div",{className:"input-flex-row",children:[t(A,{label:"หมายเลขอ้างอิง",name:"reference",disabled:(!!s.isReferenceExists||e.values.payment_method=="promptpay")&&!u}),t(ia,{require:!0,label:"วันที่และเวลาที่ชำระ",name:"payed_at",selected:(n=e.values)==null?void 0:n.payed_at,onChange:a=>{const l=a[0],d=Yt(l).toISOString();e.setFieldValue("payed_at",d)},disabled:(!!s.isReferenceExists||e.values.payment_method=="promptpay")&&!u})]}),r("div",{className:"input-flex-row",children:[t(tt,{require:!0,label:"ช่องทางชำระเงิน",id:"payment_method",name:"payment_method",placeholder:"กรุณาเลือก",options:ot,isSearchable:!1,onChange:a=>{wt(e,a,"payment_method")},disabled:!!s.isReferenceExists}),t(tt,{require:!0,label:"โอนเข้าบัญชีธนาคาร",id:"bank_account_number",name:"bank_account_number",placeholder:"กรุณาเลือก",options:st,isSearchable:!1,onChange:a=>{St(e,a,"bank_account_number")},disabled:(!!s.isReferenceExists||e.values.payment_method=="promptpay")&&!u})]}),t("div",{className:"input-flex-row",children:t(A,{label:"ยอดชำระเงิน",name:"total",type:"text",disabled:!0})}),t("div",{className:"flex flex-row mt-6 gap-4",children:t("div",{className:"upload-container w-full",children:r("div",{className:"custom-file-container","data-upload-id":"firstImage",children:[r("div",{className:"label-container",children:[t("p",{children:"หลักฐานการโอนเงิน "}),(!s.isReferenceExists||u)&&t("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>{te([])},children:"×"})]}),t("div",{}),t("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input hidden",accept:"image/*"}),t("input",{type:"hidden",name:"MAX_FILE_SIZE1",value:"10485760"}),t("div",{children:t(aa,{multiple:!0,value:E,onChange:Nt,onError:Pt,maxNumber:10,children:({imageList:a,onImageUpload:l,onImageRemoveAll:d,onImageUpdate:f,onImageRemove:h,isDragging:g,dragProps:G})=>{var R;return r("div",{className:"upload__image-wrapper",children:[(!s.isReferenceExists||u)&&t("button",{className:"custom-file-container__custom-file__custom-file-control",onClick:l,type:"button",children:"เลือกไฟล์..."}),t("div",{className:"grid gap-4 sm:grid-cols-3 grid-cols-1 pt-[70px]",children:(R=s==null?void 0:s.payment_slip)==null?void 0:R.map((y,x)=>t("div",{className:"custom-file-container__image-preview relative",children:t("img",{src:y.image_url,alt:"img",className:"m-auto pointer",onClick:()=>{B(y.image_url),M(!0)}})},x))}),t("div",{className:"grid gap-4 sm:grid-cols-3 grid-cols-1 pt-[70px]",children:a.map((y,x)=>r("div",{className:"custom-file-container__image-preview relative",children:[(y==null?void 0:y.id)===void 0&&t("button",{type:"button",className:"custom-file-container__image-clear bg-dark-light dark:bg-dark dark:text-white-dark rounded-full block w-fit p-1 absolute top-0 left-0 z-10",title:"Clear Image",onClick:()=>{h(x)},children:"×"}),t("div",{className:"custom-file-container__image-preview relative",children:t("img",{src:y.dataURL,alt:"img",className:"m-auto pointer",onClick:()=>{B(y.dataURL),M(!0)}})},x)]},x))})]})}})})]})})}),t("div",{className:"input-flex"}),t("div",{className:"mt-6",children:t(A,{label:"หมายเหตุ",name:"remark",as:"textarea",rows:"5",className:"form-textarea ltr:rounded-l-none rtl:rounded-r-none resize-none","default-value":"-",disabled:!!s.isReferenceExists})}),t("div",{className:"i",children:(s==null?void 0:s.payment_qr)&&w&&((o==null?void 0:o.status)!=="complete"?r(U,{children:[t("div",{className:"flex text-center justify-center font-normal",children:t("div",{className:`badge ${(o==null?void 0:o.status)==="complete"?"badge-outline-success":(o==null?void 0:o.status)==="pending"?"badge-outline-warning":"badge-outline-danger"}`,children:(o==null?void 0:o.status)==="complete"?"สำเร็จ":(o==null?void 0:o.status)==="pending"?"รอชำระ":"ยกเลิก"})}),t("div",{className:"border-[#ebedf2] dark:border-[#1b2e4b]",children:t("div",{className:"my-4",children:w&&P.length?t("img",{src:w,alt:"QR Code",className:"w-full max-w-xs mx-auto"}):t("div",{children:O})})}),r("div",{className:"text-center",children:[t("div",{className:"py-2",children:"เวลานับถอยหลัง"}),t("div",{children:P.length&&P})]}),t("br",{}),w&&P.length&&r("div",{className:"text-center",children:[t("button",{type:"button",className:"bg-blue-600 text-white py-2 px-4 rounded mr-2.5",onClick:Ut,children:"บันทึกรูป"}),t("button",{type:"button",className:"bg-red-600 text-white py-2 px-4 rounded mg",onClick:Bt,children:"ยกเลิก"})]})]}):t(U,{}))}),e.values.payment_method!="cash"&&(o==null?void 0:o.status)!="complete"&&!w&&e.values.payment_method!==void 0&&t("div",{className:"flex justify-center items-center mt-8",children:t("button",{type:"button",className:"btn btn-primary ltr:ml-4 rtl:mr-4",onClick:()=>Lt(e.values),children:"สร้าง QR CODE"})}),e.values.payment_method=="cash"&&((o==null?void 0:o.status)!="complete"||u)&&r("div",{className:"flex justify-center items-center mt-8",children:[t("button",{type:"button",onClick:Gt,className:"btn bg-red-500 text-white border-none shadow-lg shadow-red-500/10 ltr:ml-4 rtl:mr-4",children:s.id_payment?"ยกเลิกชำระเงิน":"กลับ"}),t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:u?"แก้ไขข้อมูล":"บันทึกข้อมูล"})]})]})]})}})}),r("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:[t("h5",{className:"text-lg font-semibold mb-4",children:"ประวัติการทำรายการ"}),t("div",{className:"datatables pagination-padding",children:t(ma,{className:"whitespace-nowrap table-hover invoice-table",records:ae,columns:[{accessor:"id",title:"ลำดับ",textAlignment:"center",sortable:!1,render:(e,n)=>t("p",{children:ae.length-n})},{accessor:"reference",title:"Reference",textAlignment:"center",sortable:!1,render:e=>t("a",{className:"flex cursor-pointer active",onClick:()=>Kt(e),children:t("div",{children:e.reference||"-"})})},{accessor:"amount",title:"ค่างวด",textAlignment:"center",sortable:!1},{accessor:"penalty_fee",title:"ค่าดำเนินการล่าช้า",textAlignment:"center",sortable:!1},{accessor:"unlock_fee",title:"ค่าปลดล็อค",textAlignment:"center",sortable:!1},{accessor:"discount",title:"ส่วนลด",textAlignment:"center",sortable:!1},{accessor:"total",title:"ชำระทั้งสิ้น",textAlignment:"center",sortable:!1},{accessor:"bank_account_number",title:"บัญชีธนาคาร",textAlignment:"center",sortable:!1},{accessor:"payed_at",title:"วันที่ชำระ",textAlignment:"center",sortable:!1,render:e=>t("p",{children:W(e==null?void 0:e.payed_at)})},{accessor:"admin_name",title:"ผู้ดำเนินการ (ปรับปรุง)",textAlignment:"center",sortable:!1},{accessor:"created_at",title:"วันที่ - เวลา",textAlignment:"center",sortable:!1,render:e=>t("p",{children:W(e==null?void 0:e.created_at)})},{accessor:"deleted_at",title:"สถานะ",textAlignment:"center",sortable:!1,render:e=>t("span",{className:`badge ${e.is_deleted==0?"badge-outline-success":"badge-outline-danger"}`,children:e.is_deleted?"ยกเลิก":"ปกติ"})}],minHeight:160,highlightOnHover:!0})})]})]})};export{Ya as default};
