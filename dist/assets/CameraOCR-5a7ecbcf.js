import{r as t,j as n,f as l,F as Q}from"./index-a90aa29c.js";import{S as q}from"./sweetalert2.all-ca2d1030.js";import{t as G}from"./constant-e85f1578.js";const ee=({onSubmit:N,onClose:R})=>{const A=q.mixin(G),[p,f]=t.useState(!0),[g,$]=t.useState(null),[C,J]=t.useState("environment"),[b,W]=t.useState(!1),r=t.useRef(null),m=t.useRef(null),d=t.useRef(null),y=t.useRef(null),h=t.useRef(null),s=t.useRef(null),T=t.useRef(null),[c,U]=t.useState({left:0,top:0,videoWidth:0,videoHeight:0,cropWidth:0,cropHeight:0}),H=t.useCallback(()=>{const i={video:{width:{min:1280,ideal:1920},height:{min:720,ideal:1080},facingMode:C},audio:!1};navigator.mediaDevices.getUserMedia(i).then(o=>{d.current=o,r.current&&(r.current.srcObject=o,r.current.onloadedmetadata=()=>{if(r.current){r.current.play(),r.current.clientWidth,r.current.clientHeight;const e=window.innerWidth>600?(window.innerWidth-600)/3:30,a=s.current.clientWidth-e*2;s.current.style.width=`${a}px`,y.current.style.borderTop=`${window.innerWidth>600?60:e}px solid #fff`,y.current.style.height=`${r.current.clientHeight-(window.innerWidth>600?60:e)}px`,h.current.style.borderLeft=`${e}px solid #fff`,h.current.style.borderRight=`${e+2}px solid #fff`,h.current.style.borderBottom=`${window.innerHeight-s.current.clientHeight-(window.innerWidth>600?60:e)}px solid #fff`,U({left:e,top:0,videoWidth:r.current.clientWidth,videoHeight:r.current.clientHeight,cropWidth:s.current.clientWidth,cropHeight:s.current.clientHeight}),f(!0);return}})}).catch(o=>{A.fire({icon:"error",title:"ไม่สามารถเข้าถึงกล้องได้ กรุณาเปิดสิทธิ์การเข้าถึงกล้องในเบราว์เซอร์",padding:"10px 20px"}),R(!0),f(!1)})},[C]),z=async()=>{if(!r.current||!m.current)return;const i=r.current,o=m.current,e=o.getContext("2d");if(!e)return;const a=i.videoWidth,M=i.videoHeight,F=a/c.videoWidth,j=M/c.videoHeight,X=c.left*F,Y=c.top*j,x=c.cropWidth*F,w=c.cropHeight*j;o.width=x,o.height=w,e.drawImage(i,X,Y,x,w,0,0,x,w),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";const I=o.toDataURL("image/jpeg",1),B=I.split(",")[1],S=I.split(",")[0].split(":")[1].split(";")[0],v=atob(B),D=new Array(v.length);for(let u=0;u<v.length;u++)D[u]=v.charCodeAt(u);const O=new Uint8Array(D),V=new Blob([O],{type:S}),P=new File([V],`${Date.now()}.jpeg`,{type:S});W(!0),$(P??null)},E=async()=>{if(!g)return;const i=new FileReader;i.onload=o=>{var a;const e=(a=o.target)==null?void 0:a.result;N({file:g,dataURL:e})},i.readAsDataURL(g)},k=()=>{d.current&&(d.current.getTracks().forEach(i=>i.stop()),d.current=null)},L=()=>{k(),f(!1)};return t.useEffect(()=>(p?H():L(),()=>k()),[p,H]),n("div",{children:p&&l("div",{style:{overflow:"hidden"},children:[n("div",{className:"d-flex justify-content-center align-items-center bg-dark",style:{zIndex:100,height:"100vh",backgroundColor:"#FFF",display:b?"none":"block"},children:l("div",{ref:y,className:"position-relative",style:{position:"relative",width:"100%",backgroundColor:"#FFF"},children:[n("video",{ref:r,style:{zIndex:1,position:"absolute",top:0,left:0,right:0,width:"100%",objectFit:"contain"},playsInline:!0,muted:!0}),l("div",{ref:h,style:{zIndex:2,position:"absolute",top:0,left:0,right:0,width:"100%"},children:[n("img",{ref:s,src:"/assets/images/frame-crop.png",style:{width:"100%"}}),l("div",{style:{justifyContent:"center",display:"flex",position:"absolute",width:"100%",marginTop:"30px",gap:16},children:[n("button",{className:"btn btn-danger",style:{width:"70px",height:"70px",borderRadius:"999px",borderWidth:0},onClick:()=>R(!1),children:"กลับ"}),n("button",{className:"btn btn-primary",style:{backgroundColor:"rgba(0, 0, 0, 0.7)",width:"70px",height:"70px",borderRadius:"999px",borderWidth:0},onClick:z,children:"ถ่าย"})]})]})]})}),n("div",{ref:T,className:"previewImg",style:{zIndex:200,display:b?"flex":"none",width:"100%",textAlign:"center",justifyContent:"center",alignItems:"center"},children:n("canvas",{ref:m,style:{maxWidth:"100%",borderRadius:"20px"}})}),b&&n(Q,{children:l("div",{style:{justifyContent:"center",display:"flex",width:"100%",marginTop:"30px",gap:16},children:[n("button",{className:"btn btn-primary",style:{backgroundColor:"rgba(0, 0, 0, 0.7)",width:"70px",height:"70px",borderRadius:"999px",borderWidth:0},onClick:()=>{W(!1)},children:"ถ่ายใหม่"}),n("button",{className:"btn btn-primary",style:{width:"70px",height:"70px",borderRadius:"999px",borderWidth:0},onClick:E,children:"ยืนยัน"})]})})]})})};export{ee as C};
