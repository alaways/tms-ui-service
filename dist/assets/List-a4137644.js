import{a as te,u as se,r as n,i as ae,c as U,s as re,f as l,j as t,L as oe,ap as ne,am as ie,g as L}from"./index-a90aa29c.js";import{u as b,w as le}from"./xlsx-9a117414.js";import{b as ce,c as de}from"./formatNumeric-862380d6.js";import{b as A}from"./formatDate-4e046265.js";import{Q as pe}from"./index-2f30bf27.js";import{S as f}from"./react-select.esm-b46d9623.js";import{I as _e}from"./IconPlus-4c7e79c8.js";import{I as me}from"./IconEye-eb8ead5b.js";import{P as he}from"./preLoading-b2445d9d.js";import{F as ue,a as ge}from"./formik.esm-c4fd04ca.js";import{c as O}from"./constant-e85f1578.js";import{D as w}from"./DateRangeAntd-92e3cf4d.js";import"./floating-ui.dom-0aeb9e8a.js";import"./createSuper-98fcd92d.js";import"./buddhistEra-a2d9672b.js";import"./index-8d8bdff8.js";const Le=()=>{var D;const y="admin",v=te(),k=se(),[E,M]=n.useState([]),[H,S]=n.useState(!1),j=(D=JSON.parse(localStorage.getItem(y)??"{}"))==null?void 0:D.acc,m=localStorage.getItem(y),p=m?JSON.parse(m).role:null,G=m?JSON.parse(m).id_shop:null,T=[10,20,30,50,100],[_,h]=n.useState(1),[i,V]=n.useState(T[0]),[z,K]=n.useState(0),[B,F]=n.useState([]),[x,W]=n.useState(!1);n.useEffect(()=>{W(!0)},[]);const u=ae(e=>e.dataStore.credit_level),{mutate:Y}=U(L.shopFindAll,{onSuccess:e=>{F(e.data.list.map(s=>({value:s.id,label:s.name})))},onError:()=>{}}),[N,P]=n.useState({}),q=[{label:"ทั้งหมด",value:"all"},{label:"ลงทะเบียน",value:"regis"},{label:"ไม่ได้ลงทะเบียน",value:"unregis"}],{mutateAsync:c,isLoading:$}=U(L.customerFindAll,{onSuccess:e=>{M(e.data.list),K(e.data.total)},onError:()=>{}}),X=async(e,s)=>{if(!H){S(!0);const a={query:s.search,page:_,page_size:i,...s.id_shop.value&&{id_shop:s.id_shop.value},...s.credit_level.value&&{credit_level:s.credit_level.value},...s.shop_credit_level.value&&{shop_credit_level:s.shop_credit_level.value},...s.line_regis.value&&{line_regis:s.line_regis.value}},g=(await c({data:a})).data.list.map(r=>({created_at:r.created_at?A(r==null?void 0:r.created_at):"อนุมัติ-",shop_name:r.shop_name,name:r.name,phone_number:r.phone_number,line_id:r.line_id,citizen_id:r.citizen_id,credit_level:r.credit_level,shop_credit_level:r.shop_credit_level,approval_status:r.approval_status,line_uuid:r.line_uuid})),C=b.json_to_sheet(g,{header:O.map(r=>r.id)}),R=b.book_new();b.book_append_sheet(R,C,"Sheet1");const J=O.map(r=>r.displayName);b.sheet_add_aoa(C,[J],{origin:"A1"});const Q=le(R,{bookType:"xlsx",type:"array"}),Z=new Blob([Q],{type:"application/octet-stream"}),d=document.createElement("a"),ee=URL.createObjectURL(Z);d.setAttribute("href",ee),d.setAttribute("download",`${e}.xlsx`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),S(!1)}},I=e=>{v(ne(e)),v(ie("preview")),k("/apps/customer/edit/"+e.id)};return n.useEffect(()=>{v(re("รายการลูกค้า")),Y({}),c({data:{page:1,page_size:i}})},[]),n.useEffect(()=>{x&&c({data:{page:1,page_size:i,...N}})},[i]),n.useEffect(()=>{x&&c({data:{page:_,page_size:i,...N}})},[_]),l("div",{children:[$&&t(he,{}),l("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[t("div",{className:"flex items-center justify-between flex-wrap gap-4 mb-4.5 px-5 ",children:t("h2",{className:"text-xl",children:"ลูกค้า"})}),l("div",{className:"flex flex-col items-start flex-wrap gap-4 mb-4.5 px-5 ",children:[j&&t("div",{className:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4 w-full sm:w-auto",children:t("div",{className:"flex gap-3",children:l(oe,{to:"/apps/customer/add",className:"btn btn-primary gap-2",children:[t(_e,{}),"เพิ่มลูกค้า"]})})}),t(ue,{initialValues:{credit_level:"",shop_credit_level:"",id_shop:"",query:"",line_regis:"",created_at:null,updated_at:null},onSubmit:e=>{var s,a,o,g;console.log(e),h(1),c({data:{page:1,page_size:i,credit_level:(s=e.credit_level)==null?void 0:s.value,shop_credit_level:(a=e.shop_credit_level)==null?void 0:a.value,id_shop:(o=e.id_shop)==null?void 0:o.value,line_regis:(g=e.line_regis)==null?void 0:g.value,query:e.query,...e.created_at&&{created_at:e.created_at[0],created_at_end:e.created_at[1]},...e.updated_at&&{updated_at:e.updated_at[0],updated_at_end:e.updated_at[1]}}}),P({...e,...e.created_at&&{created_at:e.created_at[0],created_at_end:e.created_at[1]},...e.updated_at&&{updated_at:e.updated_at[0],updated_at_end:e.updated_at[1]}})},children:({setFieldValue:e,handleReset:s,values:a})=>t(ge,{className:"w-full",children:l("div",{className:"flex flex-col gap-3 w-full",children:[l("div",{className:"flex flex-col sm:flex-row gap-4",children:[t(f,{id:"credit_level",name:"credit_level",value:a.credit_level,placeholder:"เครดิต (bu)",className:"z-10 flex-1 dropdown-custom",options:u,isSearchable:!0,onChange:o=>{e("credit_level",o)}}),t(f,{id:"shop_credit_level",name:"shop_credit_level",value:a.shop_credit_level,placeholder:"เครดิต (ร้านค้า)",className:"z-10 flex-1 dropdown-custom",options:u,isSearchable:!0,onChange:o=>{e("shop_credit_level",o)}}),!G&&t(f,{id:"id_shop",name:"id_shop",value:a.id_shop,placeholder:"ร้านค้า",className:"z-10 flex-1 dropdown-custom",options:B,isSearchable:!0,onChange:o=>{e("id_shop",o)}}),t(f,{id:"line_regis",name:"line_regis",value:a.line_regis,placeholder:"ลงทะเบียนแจ้งเตือน",className:"z-10 flex-1 dropdown-custom",options:q,isSearchable:!0,onChange:o=>{e("line_regis",o)}})]}),l("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-4",children:[t(w,{name:"created_at",placeholder:["เริ่มวันที่สร้าง","ถึงวันที่"]}),t(w,{name:"updated_at",placeholder:["เริ่มวันที่แก้ไข","ถึงวันที่"]}),t("div",{className:"relative",children:t("input",{type:"text",id:"query",name:"query",placeholder:"ค้นหา",className:"form-input py-2 ltr:pr-11 rtl:pl-11 peer",value:a.query,onChange:o=>{e("query",o.target.value)}})}),l("div",{className:"flex gap-4",children:[t("button",{type:"submit",className:"btn btn-primary w-[100px] gap-2",children:"ค้นหา"}),t("button",{type:"reset",className:"btn btn-info gap-2 w-[100px]",onClick:()=>{const o={credit_level:"",shop_credit_level:"",id_shop:"",query:"",line_regis:"",created_at:null,updated_at:null};h(1),P({...o}),c({data:{page:1,page_size:i,...o}})},children:"ล้างค่า"}),(p==="admin"||p==="business_unit")&&t("button",{type:"button",className:"btn btn-success gap-2 w-[100px]",onClick:()=>{X(`customer_${new Date().toLocaleString()}`,a)},children:"Export"})]})]})]})})})]}),t("div",{className:"datatables pagination-padding",children:E.length===0?t("div",{className:"my-10 text-center text-gray-500",children:"ไม่พบข้อมูล"}):t(pe,{className:"whitespace-nowrap table-hover invoice-table",records:E,columns:[{accessor:"index",title:"ลำดับ",textAlignment:"center",render:(e,s)=>{const a=s+1+(_-1)*i;return t("div",{children:a})}},{accessor:"created_at",title:"วันที่สร้าง",textAlignment:"left",sortable:!1,render:({created_at:e})=>t("div",{className:"flex items-center font-normal",children:t("div",{children:A(e)})})},...p!=="shop"?[{accessor:"updated_at",title:"วันที่แก้ไข",sortable:!1,render:e=>t("div",{className:"flex items-center font-normal",children:t("div",{children:A(e==null?void 0:e.updated_at)})})},{accessor:"shop_name",title:"ร้านค้า",sortable:!1,render:e=>t("div",{className:"flex items-center font-normal",children:l("div",{children:[" ",(e==null?void 0:e.shop_name)||"-"]})})}]:[],{accessor:"name",title:"ชื่อ-นามสกุล",textAlignment:"left",sortable:!1,render:e=>p=="shop"?t("div",{className:"flex items-center font-normal",children:t("a",{className:"flex",children:t("div",{children:e.title+" "+e.name})})}):t("div",{className:"flex items-center font-normal",children:t("a",{className:"flex cursor-pointer active",onClick:()=>I(e),children:t("div",{children:e.title+" "+e.name})})})},...p!=="shop"?[{accessor:"phone_number",title:"เบอร์โทรศัพท์ลูกค้า",sortable:!1,render:e=>t("div",{className:"flex items-center font-normal",children:t("div",{children:ce(e.phone_number??"-")})})},{accessor:"line_id",title:"Line ID",sortable:!1},{accessor:"citizen_id",title:"รหัสบัตรประชาชน",sortable:!1,render:e=>de(e.citizen_id)??"-"},{accessor:"credit_level",title:"ระดับเครดิต (BU)",sortable:!1,render:e=>{var s;return t("div",{className:"flex items-center font-normal",children:t("div",{children:`${((s=u.find(a=>a.value===(e==null?void 0:e.credit_level)))==null?void 0:s.label)||"-"}`})})}},{accessor:"shop_credit_level",title:"ระดับเครดิต (ร้านค้า)",sortable:!1,render:e=>{var s;return t("div",{className:"flex items-center font-normal",children:t("div",{children:`${((s=u.find(a=>a.value===(e==null?void 0:e.shop_credit_level)))==null?void 0:s.label)||"-"}`})})}},{accessor:"approval_status",title:"อนุมัติ",sortable:!1,render:e=>t("span",{className:`badge ${e!=null&&e.approval_status?"badge-outline-success":"badge-outline-danger"}`,children:e!=null&&e.approval_status?"อนุมัติ":"ไม่อนุมัติ"})},{accessor:"action",title:"Actions",sortable:!1,render:e=>t("div",{className:"flex gap-4 items-center w-max mx-auto",children:t("a",{className:"flex cursor-pointe active",onClick:()=>I(e),children:t(me,{})})})}]:[]],minHeight:200,highlightOnHover:!0,page:_,totalRecords:z,recordsPerPage:i,recordsPerPageOptions:T,onPageChange:e=>h(e),onRecordsPerPageChange:e=>{h(1),V(e)},paginationText:({from:e,to:s,totalRecords:a})=>`โชว์ ${e} ถึง ${s} ของ ${a} หน้าทั้งหมด`})})]})]})};export{Le as default};
