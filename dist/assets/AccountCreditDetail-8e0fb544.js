import{an as W,ao as X,r as a,h as D,c as z,f as m,F as Z,j as n,N as Q,g as q}from"./index-a90aa29c.js";import{F as $}from"./formik.esm-c4fd04ca.js";import{B as J}from"./breadcrumbs-b9914bbc.js";import{u as h,w as ee}from"./xlsx-9a117414.js";import{F as I}from"./DatePicker-5cf5930a.js";import{c as l,b as u}from"./formatDate-4e046265.js";import{Q as se}from"./index-2f30bf27.js";import{P as R}from"./config-8de56c22.js";import{n as t}from"./formatNumeric-862380d6.js";import{u as te}from"./useShopMutation-084b0c2e.js";import{s as v}from"./constant-e85f1578.js";import"./flatpickr-2301360e.js";import"./floating-ui.dom-0aeb9e8a.js";const ne=[{to:"/apps/report/account-creditor",label:"บัญชีเจ้าหนี้ร้านเค้า"},{label:"รายละเอียดเจ้าหนี้ร้านค้า",isCurrent:!0}],re="admin",Te=()=>{const{id:A}=W(),[c,oe]=X(),b=c.get("id_business_unit"),C="https://dev-tms-admin.gsrental.cn:7443/api/v1",T=localStorage.getItem(re),U=T?JSON.parse(T).access_token:null;a.useState(!1);const[O,y]=a.useState(!1),[g,M]=a.useState(),[_,S]=a.useState({start_at:c.get("start_at")?c.get("start_at"):l(`${D.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`),end_at:c.get("end_at")?c.get("end_at"):l(`${D.tz(new Date,"Asia/Bangkok").format("YYYY-MM-DD")}T00:00:00.000Z`),...b&&{id_business_unit:+b}}),[N,L]=a.useState([]),[d,f]=a.useState(1),[E,x]=a.useState(R[0]),[k,H]=a.useState(0),{mutate:w}=z(q.getCommissionDetailPV,{onSuccess:e=>{L(e.data.list),H(e.data.total)},onError:()=>{console.error("Failed to fetch data comission")}}),{mutate:j}=te({onSuccess:e=>{M(e.data)},onError:()=>{console.error("Failed to fetch data comission")}}),V=async()=>{const e=new Headers;e.append("Content-Type","application/json"),e.append("Authorization",`Bearer ${U}`);const i=JSON.stringify({id_shop:A,start_at:_.start_at,end_at:_.end_at,page_size:5e4,page:d}),r={method:"POST",headers:e,body:i,redirect:"follow"};return fetch(C+"/shop/pv/get-commission-detail",r).then(o=>o.json()).then(o=>o.data).catch(o=>[])},G=async e=>{if(!O){y(!0);const i=await V(),r=h.json_to_sheet(i.list.map((s,ae)=>{var P;return{reference:s.reference,contract_date:u(s==null?void 0:s.contract_date),approved_at:u(s==null?void 0:s.contract_approved_date),asset_name:((P=s==null?void 0:s.asset)==null?void 0:P.name)||"0",asset_price:t((s==null?void 0:s.price)||"0"),down_payment:t((s==null?void 0:s.down_payment)||"0"),principle:t((s==null?void 0:s.principle)||"0"),commission:t((s==null?void 0:s.commission)||"0"),benefit:t((s==null?void 0:s.benefit)||"0"),amount:t((s==null?void 0:s.amount)||"0"),fee:t((s==null?void 0:s.fee)||"0"),total:t((s==null?void 0:s.total)||"-")}}),{header:v.map(s=>s.id)}),o=h.book_new();h.book_append_sheet(o,r,"Sheet1");const B=v.map(s=>s.displayName);h.sheet_add_aoa(r,[B],{origin:"A1"});const Y=ee(o,{bookType:"xlsx",type:"array"}),F=new Blob([Y],{type:"application/octet-stream"}),p=document.createElement("a"),K=URL.createObjectURL(F);p.setAttribute("href",K),p.setAttribute("download",e+".xlsx"),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),y(!1)}};return a.useEffect(()=>{const e={page:d,page_size:E,id_shop:A,..._};w({data:e})},[d,E,_]),a.useEffect(()=>{j({data:{id:A}})},[]),m(Z,{children:[n(J,{items:ne}),m("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b] mt-3 px-10",children:[n("div",{className:"",children:m("h5",{className:"mt-3 text-xl font-semibold ltr:sm:text-left rtl:sm:text-right text-center flex flex-row justify-between",children:["รายละเอียดเจ้าหนี้ร้านค้า : ",g==null?void 0:g.name]})}),n("div",{className:"pt-4 custom-select",children:n($,{initialValues:_,onSubmit:()=>{},children:({setFieldValue:e,handleReset:i})=>m("div",{className:"flex flex-wrap items-center gap-3",children:[n("label",{children:"การทำรายการที่ผ่านมา"}),n("div",{className:"max-w-[200px]",children:n(I,{name:"start_at",onChange:r=>{e("start_at",l(r)),S(o=>({...o,start_at:l(r)}))}})}),n("div",{className:"max-w-[200px]",children:n(I,{name:"end_at",onChange:r=>{e("end_at",l(r)),S(o=>({...o,end_at:l(r)}))}})}),n("button",{type:"submit",className:"btn btn-primary gap-2",onClick:()=>G(`shop_report_${new Date().toLocaleString()}`),children:"Export"})]})})}),n("div",{className:"datatables pagination-padding",children:n(se,{className:"whitespace-nowrap table-hover invoice-table",records:N,columns:[{accessor:"index",title:"เลขที่สัญญา",textAlignment:"center",sortable:!1,render:e=>n(Q,{to:"/apps/contract/"+(e==null?void 0:e.contract_id)+"/"+(e==null?void 0:e.contract_uuid),className:"flex justify-center text-center font-normal",children:n("a",{className:"flex cursor-pointer active",children:e.reference})})},{accessor:"pv_no",title:"เลขที่ PV",textAlignment:"center",sortable:!1},{accessor:"created_at",title:"วันที่ทำสัญญา",textAlignment:"center",sortable:!1,render:e=>n("p",{children:u(e==null?void 0:e.contract_date)})},{accessor:"approved_at",title:"วันที่อนุมัติสัญญา",textAlignment:"left",sortable:!1,render:e=>u(e==null?void 0:e.contract_approved_date)},{accessor:"contract_status",title:"สถานะสัญญา",textAlignment:"left",sortable:!1,render:e=>(e==null?void 0:e.contract_status)||"-"},{accessor:"asset.name",title:"ชื่อทรัพย์สิน",textAlignment:"left",sortable:!1,render:e=>{var i;return((i=e==null?void 0:e.asset)==null?void 0:i.name)||"0"}},{accessor:"price",title:"ราคาขาย",textAlignment:"right",sortable:!1,render:e=>t((e==null?void 0:e.price)||"0")},{accessor:"down_payment",title:"เงินดาวน์",textAlignment:"right",sortable:!1,render:e=>t((e==null?void 0:e.down_payment)||"0")},{accessor:"principle",title:"ทุนเช่าซื้อ",textAlignment:"right",sortable:!1,render:e=>t((e==null?void 0:e.principle)||"0")},{accessor:"commission",title:"ค่านายหน้า",textAlignment:"right",sortable:!1,render:e=>t((e==null?void 0:e.commission)||"0")},{accessor:"benefit",title:"ผลตอบแทนพิเศษ",textAlignment:"right",sortable:!1,render:e=>t((e==null?void 0:e.benefit)||"0")},{accessor:"amount",title:"รวมเป็นเงิน",textAlignment:"right",sortable:!1,render:e=>t((e==null?void 0:e.amount)||"0")},{accessor:"fee",title:"ค่าทำสัญญา",textAlignment:"right",sortable:!1,render:e=>t((e==null?void 0:e.fee)||"0")},{accessor:"total",title:"คงเหลือให้ร้านค้า",textAlignment:"right",sortable:!1,render:e=>t((e==null?void 0:e.total)||"-")}],minHeight:200,page:d,highlightOnHover:!0,totalRecords:k,recordsPerPage:E,onPageChange:e=>f(e),recordsPerPageOptions:R,onRecordsPerPageChange:e=>{f(1),x(e)},paginationText:({from:e,to:i,totalRecords:r})=>`โชว์ ${e} ถึง ${i} ของ ${r} หน้าทั้งหมด`})})]})]})};export{Te as default};
